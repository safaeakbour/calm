{"status": {"state": "ACTIVE", "message_list": [], "description": "", "resources": {"service_definition_list": [{"singleton": false, "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "732fdc22-118d-4328-b426-462067aff8b0", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Configure", "uuid": "7db32523-83c5-423d-b6f2-c8895fae290a"}], "name": "7de8078e_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "df4d1f04-1559-4e17-bf37-02b3d0ebe52c"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Configure", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}/\nsudo chmod +r ${ETCD_CERT_PATH}/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - apiserver\n    - --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=true\n    - --insecure-port=0\n    - --secure-port=443\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=3\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=/var/lib/audit.log\n    - --authorization-mode=RBAC\n    - --bind-address=0.0.0.0\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --runtime-config=rbac.authorization.k8s.io/v1alpha1\n    - --etcd-cafile=${ETCD_CERT_PATH}/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}/encryption-config.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}/kubernetes-key.pem\n    - --kubelet-https=true\n    - --service-account-key-file=${KUBE_CERT_PATH}/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}/ca.pem\n    - --v=2\n    ports:\n    - containerPort: 443\n      hostPort: 443\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /etc/ssl/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true  \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: /healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: /healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-scheduler.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "7db32523-83c5-423d-b6f2-c8895fae290a"}], "description": "", "name": "39d74fe7_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "7de8078e_dag", "uuid": "df4d1f04-1559-4e17-bf37-02b3d0ebe52c"}, "message_list": [], "variable_list": [], "uuid": "d28a648a-b9fd-4a6f-a2af-d05db381ae3a"}, "message_list": [], "name": "action_create"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "beb94dca-e434-4ba6-a7a3-86d652e170a3", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "04a99dae_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "4499a18d-cbe9-4d00-8fe8-23dab2924a1a"}], "description": "", "name": "b00241d6_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "04a99dae_dag", "uuid": "4499a18d-cbe9-4d00-8fe8-23dab2924a1a"}, "message_list": [], "variable_list": [], "uuid": "a5999398-fee7-49e7-8af2-7c82fe537838"}, "message_list": [], "name": "action_delete"}, {"description": "System action for starting an application", "type": "system", "uuid": "78da7e6b-e6d3-4f56-8f55-58aa64eabae1", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Start", "uuid": "bb95a5d4-6dd1-4388-8677-f6720bd3a1e5"}, {"kind": "app_task", "name": "StartFlanneld", "uuid": "fb66c4df-952f-4082-9645-b30a4b610210"}, {"kind": "app_task", "name": "KubeDns", "uuid": "ccb9f0b4-203f-413d-b3ed-4453d68fe934"}, {"kind": "app_task", "name": "VolumePlugin", "uuid": "c8384aca-3323-441f-8347-ead3b954a3af"}, {"kind": "app_task", "name": "Dashboard", "uuid": "3862a9b4-05f7-4f5d-ba52-6faa2665a72b"}, {"kind": "app_task", "name": "Helm", "uuid": "10e4c8cf-d042-4c48-bda5-59012953e522"}, {"kind": "app_task", "name": "Calico", "uuid": "b9a52aac-112e-46c8-954c-8aa84ff780cd"}], "name": "40001146_dag", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "VolumePlugin", "uuid": "c8384aca-3323-441f-8347-ead3b954a3af"}, "edge_type": "user_defined", "type": "", "uuid": "95c88951-bbae-40f9-90e0-8786658dcaa8", "to_task_reference": {"kind": "app_task", "name": "Dashboard", "uuid": "3862a9b4-05f7-4f5d-ba52-6faa2665a72b"}}, {"from_task_reference": {"kind": "app_task", "name": "Dashboard", "uuid": "3862a9b4-05f7-4f5d-ba52-6faa2665a72b"}, "edge_type": "user_defined", "type": "", "uuid": "95c88951-bbae-40f9-90e0-8786658dcaa8", "to_task_reference": {"kind": "app_task", "name": "Helm", "uuid": "10e4c8cf-d042-4c48-bda5-59012953e522"}}, {"from_task_reference": {"kind": "app_task", "name": "Helm", "uuid": "10e4c8cf-d042-4c48-bda5-59012953e522"}, "edge_type": "user_defined", "type": "", "uuid": "95c88951-bbae-40f9-90e0-8786658dcaa8", "to_task_reference": {"kind": "app_task", "name": "Calico", "uuid": "b9a52aac-112e-46c8-954c-8aa84ff780cd"}}, {"from_task_reference": {"kind": "app_task", "name": "Start", "uuid": "bb95a5d4-6dd1-4388-8677-f6720bd3a1e5"}, "edge_type": "user_defined", "type": "", "uuid": "95c88951-bbae-40f9-90e0-8786658dcaa8", "to_task_reference": {"kind": "app_task", "name": "StartFlanneld", "uuid": "fb66c4df-952f-4082-9645-b30a4b610210"}}, {"from_task_reference": {"kind": "app_task", "name": "StartFlanneld", "uuid": "fb66c4df-952f-4082-9645-b30a4b610210"}, "edge_type": "user_defined", "type": "", "uuid": "95c88951-bbae-40f9-90e0-8786658dcaa8", "to_task_reference": {"kind": "app_task", "name": "KubeDns", "uuid": "ccb9f0b4-203f-413d-b3ed-4453d68fe934"}}, {"from_task_reference": {"kind": "app_task", "name": "KubeDns", "uuid": "ccb9f0b4-203f-413d-b3ed-4453d68fe934"}, "edge_type": "user_defined", "type": "", "uuid": "95c88951-bbae-40f9-90e0-8786658dcaa8", "to_task_reference": {"kind": "app_task", "name": "VolumePlugin", "uuid": "c8384aca-3323-441f-8347-ead3b954a3af"}}], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "0d459994-6177-4bb3-a7a0-0ac0ac2fcb3b"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Start", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\nsudo systemctl start kube-etcd docker kubelet iscsid\nsudo systemctl enable kube-etcd docker kubelet iscsid\nexport PATH=$PATH:/opt/bin\n\nmkdir CA\nmv ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\ncp /opt/kube-ssl/admin*.pem CA/\nwhile [[ $(curl --key CA/admin-key.pem --cert CA/admin.pem --cacert CA/ca.pem https://@@{address}@@/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n\tsleep 5\ndone\n\nkubectl config set-cluster kubernetes-the-hard-way  --certificate-authority=$HOME/CA/ca.pem  --embed-certs=true --server=https://@@{address}@@\nkubectl config set-credentials admin  --client-certificate=$HOME/CA/admin.pem  --client-key=$HOME/CA/admin-key.pem\nkubectl config set-context kubernetes-the-hard-way  --cluster=kubernetes-the-hard-way  --user=admin\nkubectl config use-context kubernetes-the-hard-way", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "bb95a5d4-6dd1-4388-8677-f6720bd3a1e5"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "StartFlanneld", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nsleep 10\nexport PATH=$PATH:/opt/bin\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"10.200.0.0/16\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: extensions/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.9.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.9.0-amd64\n        command: [ \"/opt/bin/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | tee kube-flannel.yml\nkubectl create -f kube-flannel.yml\nsleep 30", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "fb66c4df-952f-4082-9645-b30a4b610210"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "KubeDns", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nmkdir kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io/cluster-service: \"true\"\n    addonmanager.kubernetes.io/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io/cluster-service: \"true\"\n    kubernetes.io/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_CLUSTER_DNS}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io/cluster-service: \"true\"\n    addonmanager.kubernetes.io/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io/critical-pod:\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.4\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: /healthcheck/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: /readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: /kube-dns-config\n      - name: dnsmasq\n        image: gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.4\n        livenessProbe:\n          httpGet:\n            path: /healthcheck/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=/etc/k8s/dns/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=/cluster.local./127.0.0.1#10053\n        - --server=/in-addr.arpa/127.0.0.1#10053\n        - --server=/ip6.arpa/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: /etc/k8s/dns/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.4\n        livenessProbe:\n          httpGet:\n            path: /metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | tee kubedns/kube-dns.yaml\n      \nkubectl create -f kubedns/kube-dns.yaml", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "ccb9f0b4-203f-413d-b3ed-4453d68fe934"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "VolumePlugin", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nmkdir volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PRISM_USERNAME}@@:@@{PRISM_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: silver \n  namespace: kube-system\nprovisioner: nutanix/abs\nparameters:\n     prismEndPoint: @@{PRISM_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PRISM_DATA_SERVICE_IP}@@:3260\n     user: @@{PRISM_USERNAME}@@\n     password: @@{PRISM_PASSWORD}@@\n     secretName: ntnx-secret\n     storageContainer: @@{CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | tee volume_plugin/nutanix-provisioner.yaml\n\nsed -i \"s/<SECRET>/${NTNX_SECRET}/\" volume_plugin/nutanix-provisioner.yaml\nkubectl create -f volume_plugin/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix/abs\" | tee -a volume_plugin/ntnx-secret.yaml\nsed -i \"s/<SECRET>/${NTNX_SECRET}/\" volume_plugin/ntnx-secret.yaml\nkubectl create -f volume_plugin/ntnx-secret.yaml", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "c8384aca-3323-441f-8347-ead3b954a3af"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Dashboard", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nmkdir Dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: extensions/v1beta1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      initContainers:\n      - name: kubernetes-dashboard-init\n        image: gcr.io/google_containers/kubernetes-dashboard-init-amd64:v1.0.1\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: /certs\n      containers:\n      - name: kubernetes-dashboard\n        image: gcr.io/google_containers/kubernetes-dashboard-amd64:v1.7.1\n        ports:\n        - containerPort: 9090\n          protocol: TCP\n        args:\n          - --tls-key-file=/certs/dashboard.key\n          - --tls-cert-file=/certs/dashboard.crt\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http://my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: /certs\n          readOnly: true\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: /\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | tee Dashboard/kubernetes-dashboard.yaml\nkubectl create -f Dashboard/kubernetes-dashboard.yaml", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "3862a9b4-05f7-4f5d-ba52-6faa2665a72b"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Helm", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | tee helm.yaml\n  \nkubectl create -f helm.yaml\nhelm init --service-account helm", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "10e4c8cf-d042-4c48-bda5-59012953e522"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Calico", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nETCD_SERVER_PORT=2379\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\nkubectl apply -f https://docs.projectcalico.org/v2.6/getting-started/kubernetes/installation/rbac.yaml\n\n#ETCD_KEY=$(python -c 'import base64; import sys; print base64.b64encode(sys.argv[1])' \"$(cat /etc/kubernetes/ssl/kubernetes-key.pem)\")\n#ETCD_CERT=$(python -c 'import base64; import sys; print base64.b64encode(sys.argv[1])' \"$(cat /etc/kubernetes/ssl/kubernetes.pem)\")\n#ETCD_CA=$(python -c 'import base64; import sys; print base64.b64encode(sys.argv[1])' \"$(cat /etc/kubernetes/ssl/ca.pem)\")\n\necho '# Calico Version v2.6.2\n\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  etcd_endpoints: \"<ETCD_SERVERS>\"\n  calico_backend: \"none\"\n  cni_network_config: |-\n    {\n        \"name\": \"k8s-pod-network\",\n        \"cniVersion\": \"0.1.0\",\n        \"type\": \"flannel\",\n         \"delegate\": {\n            \"type\": \"calico\",\n            \"etcd_endpoints\": \"__ETCD_ENDPOINTS__\",\n            \"etcd_key_file\": \"__ETCD_KEY_FILE__\",\n            \"etcd_cert_file\": \"__ETCD_CERT_FILE__\",\n            \"etcd_ca_cert_file\": \"__ETCD_CA_CERT_FILE__\",\n            \"log_level\": \"info\",\n            \"mtu\": 1500,\n            \"policy\": {\n               \"type\": \"k8s\",\n               \"k8s_api_root\": \"https://__KUBERNETES_SERVICE_HOST__:__KUBERNETES_SERVICE_PORT__\",\n               \"k8s_auth_token\": \"__SERVICEACCOUNT_TOKEN__\"\n           },\n           \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n           }\n        }\n    }\n  etcd_ca: \"/calico-secrets/etcd-ca\"\n  etcd_cert: \"/calico-secrets/etcd-cert\"\n  etcd_key: \"/calico-secrets/etcd-key\"\n\n---\n\napiVersion: v1\nkind: Secret\ntype: Opaque\nmetadata:\n  name: calico-etcd-secrets\n  namespace: kube-system\ndata:\n  etcd-key: \"<ETCD_KEY>\"\n  etcd-cert: \"<ETCD_CERT>\"\n  etcd-ca: \"<ETCD_CA>\"\n---\n\nkind: DaemonSet\napiVersion: extensions/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io/critical-pod: \"\"\n        scheduler.alpha.kubernetes.io/tolerations: |\n          [{\"key\": \"dedicated\", \"value\": \"master\", \"effect\": \"NoSchedule\" },\n           {\"key\":\"CriticalAddonsOnly\", \"operator\":\"Exists\"}]\n    spec:\n      hostNetwork: true\n      serviceAccountName: calico-node\n\n      terminationGracePeriodSeconds: 0\n      containers:\n\n        - name: calico-node\n          image: quay.io/calico/node:v2.6.2\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: ETCD_CA_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_ca\n            - name: ETCD_KEY_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_key\n            - name: ETCD_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_cert\n            - name: IP\n              value: \"\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: /liveness\n              port: 9099\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: /readiness\n              port: 9099\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: /lib/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: /var/run/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: /calico-secrets\n              name: etcd-certs\n        - name: install-cni\n          image: quay.io/calico/cni:v1.11.0\n          command: [\"/install-cni.sh\"]\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n          volumeMounts:\n            - mountPath: /host/opt/cni/bin\n              name: cni-bin-dir\n            - mountPath: /host/etc/cni/net.d\n              name: cni-net-dir\n            - mountPath: /calico-secrets\n              name: etcd-certs\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: /lib/modules\n        - name: var-run-calico\n          hostPath:\n            path: /var/run/calico\n        - name: cni-bin-dir\n          hostPath:\n            path: /opt/cni/bin\n        - name: cni-net-dir\n          hostPath:\n            path: /etc/cni/net.d\n        - name: etcd-certs\n          secret:\n            secretName: calico-etcd-secrets\n\n---\n\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: calico-kube-controllers\n  namespace: kube-system\n  labels:\n    k8s-app: calico-kube-controllers\n  annotations:\n    scheduler.alpha.kubernetes.io/critical-pod: \"\"\n    scheduler.alpha.kubernetes.io/tolerations: |\n      [{\"key\": \"dedicated\", \"value\": \"master\", \"effect\": \"NoSchedule\" },\n       {\"key\":\"CriticalAddonsOnly\", \"operator\":\"Exists\"}]\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      name: calico-kube-controllers\n      namespace: kube-system\n      labels:\n        k8s-app: calico-kube-controllers\n    spec:\n      hostNetwork: true\n      serviceAccountName: calico-kube-controllers\n      containers:\n        - name: calico-kube-controllers\n          image: quay.io/calico/kube-controllers:v1.0.0\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n            - name: ETCD_CA_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_ca\n            - name: ETCD_KEY_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_key\n            - name: ETCD_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_cert\n          volumeMounts:\n            - mountPath: /calico-secrets\n              name: etcd-certs\n      volumes:\n        - name: etcd-certs\n          secret:\n            secretName: calico-etcd-secrets\n\n---\n\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: calico-policy-controller\n  namespace: kube-system\n  labels:\n    k8s-app: calico-policy\nspec:\n  replicas: 0\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      name: calico-policy-controller\n      namespace: kube-system\n      labels:\n        k8s-app: calico-policy\n    spec:\n      hostNetwork: true\n      serviceAccountName: calico-kube-controllers\n      containers:\n        - name: calico-policy-controller\n          image: quay.io/calico/kube-controllers:v1.0.0\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-kube-controllers\n  namespace: kube-system\n\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system' | tee calico.yaml\n  \nsed -i \"s#<ETCD_SERVERS>#${ETCD_SERVERS}#\" calico.yaml\nsed -i \"s/<ETCD_KEY>/${ETCD_KEY}/\" calico.yaml\nsed -i \"s/<ETCD_CERT>/${ETCD_CERT}/\" calico.yaml\nsed -i \"s/<ETCD_CA>/${ETCD_CA}/\" calico.yaml\n", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "b9a52aac-112e-46c8-954c-8aa84ff780cd"}], "description": "", "name": "05c2f01a_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "40001146_dag", "uuid": "0d459994-6177-4bb3-a7a0-0ac0ac2fcb3b"}, "message_list": [], "variable_list": [], "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "32fd38ed-8451-41e1-9805-9b4b5328e0b3", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "68e6d6cf_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "ba54a348-c3a0-4764-875f-7ab8f4b64464"}], "description": "", "name": "49e3a785_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "68e6d6cf_dag", "uuid": "ba54a348-c3a0-4764-875f-7ab8f4b64464"}, "message_list": [], "variable_list": [], "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}, "message_list": [], "name": "action_stop"}, {"description": "System action for restarting an application", "type": "system", "uuid": "76f5f44b-bfb8-4e5a-847a-efcaaf6e9064", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "928d779e_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "706634cb-6510-4587-85b1-6f6b55663250"}], "description": "", "name": "9bfe1a06_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "928d779e_dag", "uuid": "706634cb-6510-4587-85b1-6f6b55663250"}, "message_list": [], "variable_list": [], "uuid": "4852660b-02d7-440d-a494-4ef7c3142417"}, "message_list": [], "name": "action_restart"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "22ab81aa-028e-4cc4-bd0e-2a9a6e67e6ba", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Service_Element_Delete_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "a401881b-b58d-4363-aa23-2347bdd8478f"}], "name": "SYS_GEN__DAG_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "7e80461b-5f9e-4940-96b6-cf1a42a8ba73"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Service_Element_Delete_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "a401881b-b58d-4363-aa23-2347bdd8478f"}], "description": "", "name": "SYS_GEN__Runbook_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "7e80461b-5f9e-4940-96b6-cf1a42a8ba73"}, "message_list": [], "variable_list": [], "uuid": "59a30bab-b0f4-4159-82ca-96708920121f"}, "message_list": [], "name": "action_soft_delete"}], "depends_on_list": [], "name": "Kubernetes_Master", "state": "ACTIVE", "port_list": [], "editables": {}, "tier": "", "message_list": [], "variable_list": [], "description": ""}, {"singleton": false, "uuid": "ed198317-51d3-491a-85cf-34968aaedbee", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "b924ef34-6cf0-4406-b1be-a53964db1f58", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "9dfbf446_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "9fadf8e0-9652-4703-a66c-d9561722e324"}], "description": "", "name": "925ba7c0_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "9dfbf446_dag", "uuid": "9fadf8e0-9652-4703-a66c-d9561722e324"}, "message_list": [], "variable_list": [], "uuid": "ce426880-342a-4995-9d9c-c9dec8c586c4"}, "message_list": [], "name": "action_create"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "e8ec5df4-d5e8-4cac-a8d4-978efcb97dee", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "141edbbe_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a0e13dd8-f651-4b8b-a7a3-f49a13c31692"}], "description": "", "name": "28e74b96_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "141edbbe_dag", "uuid": "a0e13dd8-f651-4b8b-a7a3-f49a13c31692"}, "message_list": [], "variable_list": [], "uuid": "0ab86c44-ee03-4d60-ae33-3bc75165ee6a"}, "message_list": [], "name": "action_delete"}, {"description": "System action for starting an application", "type": "system", "uuid": "55db31c4-3bb0-44fe-b003-00b68075662f", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Start", "uuid": "e0d8d185-32d1-4cce-9e43-3642dc2eeb0b"}], "name": "c4ac1e52_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "8c83a44a-1778-4551-91ff-716f7e87225c"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Start", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nsudo systemctl start kubelet iscsid\nsudo systemctl enable kubelet iscsid", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "e0d8d185-32d1-4cce-9e43-3642dc2eeb0b"}], "description": "", "name": "af446214_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "c4ac1e52_dag", "uuid": "8c83a44a-1778-4551-91ff-716f7e87225c"}, "message_list": [], "variable_list": [], "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "235b0daa-8f4b-4499-87b2-11273c9fa736", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "35667c90_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "5c7dbefa-57cd-4a8e-9ee2-6302f83e6602"}], "description": "", "name": "bbfee442_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "35667c90_dag", "uuid": "5c7dbefa-57cd-4a8e-9ee2-6302f83e6602"}, "message_list": [], "variable_list": [], "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}, "message_list": [], "name": "action_stop"}, {"description": "System action for restarting an application", "type": "system", "uuid": "d34771b2-c434-461f-88a6-4d9e47c5ad16", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "78a2de6b_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "ac1534e4-9cb6-4b69-af8c-2db933c74653"}], "description": "", "name": "4db0601a_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "78a2de6b_dag", "uuid": "ac1534e4-9cb6-4b69-af8c-2db933c74653"}, "message_list": [], "variable_list": [], "uuid": "db146a39-95e1-4db5-a06b-a72b8880a8b8"}, "message_list": [], "name": "action_restart"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "a2c1a047-ccdd-4aba-9542-e2cc28d74f55", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Service_Element_Delete_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f9dd1e7b-29bd-4cc1-96b7-01a10bb7ef41"}], "name": "SYS_GEN__DAG_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e882c972-071e-4050-955d-f023957f8433"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Service_Element_Delete_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "f9dd1e7b-29bd-4cc1-96b7-01a10bb7ef41"}], "description": "", "name": "SYS_GEN__Runbook_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "e882c972-071e-4050-955d-f023957f8433"}, "message_list": [], "variable_list": [], "uuid": "8bf1f321-c96c-485d-bf06-13a230fc1e23"}, "message_list": [], "name": "action_soft_delete"}], "depends_on_list": [], "name": "Kubernetes_Minion", "state": "ACTIVE", "port_list": [], "editables": {}, "tier": "", "message_list": [], "variable_list": [], "description": ""}], "substrate_definition_list": [{"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "d18ef0a3-8b55-47f3-a731-2c31fe59d9d2", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "d79f817b-35e6-4233-a610-c634cb13bb47"}, {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SC_Centos_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "5f5a192b-7746-4644-97c1-995a204d43b0"}], "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "d79f817b-35e6-4233-a610-c634cb13bb47"}, "edge_type": "inherent", "type": "", "uuid": "adcce37f-7401-45aa-ae69-80a0d1a671f7", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SC_Centos_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "5f5a192b-7746-4644-97c1-995a204d43b0"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "5081e258-8e6f-4fdf-99ab-d76ae4fe1aa2"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Provision_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"name": "Centos-K8SC@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "cbc0c43a-5b92-49b2-9851-5a10041b6d1b"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "#cloud-config\nusers:\n  - name: kube\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CentOS-7-x86_64-GenericCloud-1801-01", "uuid": "2be2cb61-1220-4b9a-a8ad-1893565f00d4"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "timeout_secs": "", "type": "PROVISION_NUTANIX", "variable_list": [], "uuid": "d79f817b-35e6-4233-a610-c634cb13bb47"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__check_login_for_K8SC_Centos_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "5f5a192b-7746-4644-97c1-995a204d43b0"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "5081e258-8e6f-4fdf-99ab-d76ae4fe1aa2"}, "message_list": [], "variable_list": [], "uuid": "3be99ca4-d9b1-49f2-9c91-95650be3d84d"}, "message_list": [], "name": "action_create"}, {"description": "System action for powering on an application", "type": "system", "uuid": "f640d6b7-3239-4a0c-a18d-8bb7b16a143d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "a198858b-6eb5-456a-ae3b-5780ba6ee41c"}, {"kind": "app_task", "name": "check_login_for_K8SC_Centos_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "9ac84e84-b44f-4a6b-8d7e-4681bfc4500c"}], "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "a198858b-6eb5-456a-ae3b-5780ba6ee41c"}, "edge_type": "inherent", "type": "", "uuid": "2cc15c42-95e7-4f5f-bd20-8fbbf2023334", "to_task_reference": {"kind": "app_task", "name": "check_login_for_K8SC_Centos_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "9ac84e84-b44f-4a6b-8d7e-4681bfc4500c"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c7f2f087-0c19-4232-8b31-0c39f999fe3b"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOn_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "a198858b-6eb5-456a-ae3b-5780ba6ee41c"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "check_login_for_K8SC_Centos_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "9ac84e84-b44f-4a6b-8d7e-4681bfc4500c"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "c7f2f087-0c19-4232-8b31-0c39f999fe3b"}, "message_list": [], "variable_list": [], "uuid": "cb021452-5a34-4e77-aea5-39f448d78160"}, "message_list": [], "name": "action_poweron"}, {"description": "System action for suspending an application", "type": "system", "uuid": "7d75bfd3-2a06-431d-a4ce-05ef94866376", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "53748aaf-5286-4ef5-80cd-912752fc236f"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "53748aaf-5286-4ef5-80cd-912752fc236f"}, "message_list": [], "variable_list": [], "uuid": "ae734aea-8375-4b64-a933-5dfa4407c906"}, "message_list": [], "name": "action_suspend"}, {"description": "System action for modifying an application", "type": "system", "uuid": "0e62eb33-e345-44c0-821e-81a3af7ca123", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "4a9d8b22-df45-42b9-ac77-4b45575fc6ff"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "4a9d8b22-df45-42b9-ac77-4b45575fc6ff"}, "message_list": [], "variable_list": [], "uuid": "e18da376-e119-4b89-ab16-d346ac749368"}, "message_list": [], "name": "action_modify"}, {"description": "System action for powering off an application", "type": "system", "uuid": "35567b6f-023d-4cac-8a0a-71d67ea70d6c", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOff_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "1cd138b7-ef91-4a75-900a-db8641e50ee6"}], "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e69eea13-6b1b-4a95-9d52-b0b6983fda86"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOff_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "1cd138b7-ef91-4a75-900a-db8641e50ee6"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "e69eea13-6b1b-4a95-9d52-b0b6983fda86"}, "message_list": [], "variable_list": [], "uuid": "f9d4337c-75c3-4c91-9cf2-852712ecdc61"}, "message_list": [], "name": "action_poweroff"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "92ee561c-f46c-4d2c-8167-a867191f9dd6", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Delete_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "bd42ac3b-16aa-4ec2-80ab-c61b92491cf1"}], "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "dab1573b-c196-4aa1-806d-25824ef32598"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Delete_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_NUTANIX", "variable_list": [], "uuid": "bd42ac3b-16aa-4ec2-80ab-c61b92491cf1"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "dab1573b-c196-4aa1-806d-25824ef32598"}, "message_list": [], "variable_list": [], "uuid": "84a21642-2518-409e-bcaa-81ef0d89ee5d"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "23cfbbed-23e1-41cf-b961-f5683052bc25", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Substrate_Element_Delete_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "4f264953-5729-4758-b166-d9d127824793"}], "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "9fdf2f2a-7977-4653-a399-1e1ee2fbcf73"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Substrate_Element_Delete_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "4f264953-5729-4758-b166-d9d127824793"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "9fdf2f2a-7977-4653-a399-1e1ee2fbcf73"}, "message_list": [], "variable_list": [], "uuid": "117187f5-fffd-4889-81c4-3feeac5b283a"}, "message_list": [], "name": "action_soft_delete"}], "type": "AHV_VM", "name": "K8SC_Centos", "state": "ACTIVE", "readiness_probe": {"connection_type": "SSH", "disable_readiness_probe": false, "timeout_secs": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@", "connection_port": 22, "login_credential_local_reference": {"kind": "app_credential", "name": "KUBE", "uuid": "95632617-86a6-4eec-9df7-e731de24225e"}}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"device_type": true, "disk_address": {"adapter_type": true}}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "message_list": [], "create_spec": {"name": "Centos-K8SC@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "cbc0c43a-5b92-49b2-9851-5a10041b6d1b"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "#cloud-config\nusers:\n  - name: kube\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CentOS-7-x86_64-GenericCloud-1801-01", "uuid": "2be2cb61-1220-4b9a-a8ad-1893565f00d4"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "variable_list": [], "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, {"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "588f4874-24cb-4c18-a971-e65f3e2d7935", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "250cf5c7-0c4b-44f0-b222-ef916142130d"}, {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SM_Centos_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "c7ede65a-fc1b-490d-bddf-997e0d6e18d1"}], "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "250cf5c7-0c4b-44f0-b222-ef916142130d"}, "edge_type": "inherent", "type": "", "uuid": "11dfc7d7-234c-4ac6-be98-d2d9359d2f0e", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SM_Centos_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "c7ede65a-fc1b-490d-bddf-997e0d6e18d1"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "611b5e5d-e5f1-4905-b12f-abbfac35bb1e"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Provision_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"name": "Centos-K8SM@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "cbc0c43a-5b92-49b2-9851-5a10041b6d1b"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "#cloud-config\nusers:\n  - name: kube\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CentOS-7-x86_64-GenericCloud-1801-01", "uuid": "2be2cb61-1220-4b9a-a8ad-1893565f00d4"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "timeout_secs": "", "type": "PROVISION_NUTANIX", "variable_list": [], "uuid": "250cf5c7-0c4b-44f0-b222-ef916142130d"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__check_login_for_K8SM_Centos_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "c7ede65a-fc1b-490d-bddf-997e0d6e18d1"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "611b5e5d-e5f1-4905-b12f-abbfac35bb1e"}, "message_list": [], "variable_list": [], "uuid": "cfdab38b-b74c-437d-a6da-014d8e7d9600"}, "message_list": [], "name": "action_create"}, {"description": "System action for powering on an application", "type": "system", "uuid": "f2cd9b0b-c7eb-4899-84a2-07488045a7b6", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "1967d001-dc9e-4d7f-a9e1-a21db5362e2c"}, {"kind": "app_task", "name": "check_login_for_K8SM_Centos_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "43c95f81-3572-437c-9392-ee2aa2bb8b60"}], "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "1967d001-dc9e-4d7f-a9e1-a21db5362e2c"}, "edge_type": "inherent", "type": "", "uuid": "f1fe7827-e8ff-412c-ad1d-1e77be9ba784", "to_task_reference": {"kind": "app_task", "name": "check_login_for_K8SM_Centos_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "43c95f81-3572-437c-9392-ee2aa2bb8b60"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "41b78dad-4110-435c-a000-298f75f1f9af"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOn_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "1967d001-dc9e-4d7f-a9e1-a21db5362e2c"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "check_login_for_K8SM_Centos_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "43c95f81-3572-437c-9392-ee2aa2bb8b60"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "41b78dad-4110-435c-a000-298f75f1f9af"}, "message_list": [], "variable_list": [], "uuid": "3724ade2-498b-4615-9de1-94204d9f285e"}, "message_list": [], "name": "action_poweron"}, {"description": "System action for suspending an application", "type": "system", "uuid": "e4a60399-8867-40e2-9c5e-7b5978274c8d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a9e2521d-358d-4ca5-ad90-f148239cf28e"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "a9e2521d-358d-4ca5-ad90-f148239cf28e"}, "message_list": [], "variable_list": [], "uuid": "5ef0be33-89ae-45b0-aae4-44c13577512b"}, "message_list": [], "name": "action_suspend"}, {"description": "System action for modifying an application", "type": "system", "uuid": "df466053-05da-4858-ad8a-7881f212dc48", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "7fb36926-74bb-461b-a444-7095a29a6cab"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "7fb36926-74bb-461b-a444-7095a29a6cab"}, "message_list": [], "variable_list": [], "uuid": "ab6a3ba3-5b4b-431d-a4bc-c94b6b5a23cf"}, "message_list": [], "name": "action_modify"}, {"description": "System action for powering off an application", "type": "system", "uuid": "f83b82a8-f775-45f7-b40f-18bed44c4e50", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOff_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "b07f03a3-2ed2-4d6b-b9bc-6284319a124a"}], "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "2bd4019a-26bf-4dd4-a478-5e947b740d63"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOff_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "b07f03a3-2ed2-4d6b-b9bc-6284319a124a"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "2bd4019a-26bf-4dd4-a478-5e947b740d63"}, "message_list": [], "variable_list": [], "uuid": "7a22b3d2-0e89-48ee-b513-c6cb909d40d0"}, "message_list": [], "name": "action_poweroff"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "c058c1f3-0b68-4e56-9111-8daaf8b8766f", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Delete_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "cdd37b44-de0d-4d98-9838-4a082fa960ba"}], "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e02f8607-86d2-414e-88d1-1e3ab584d936"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Delete_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_NUTANIX", "variable_list": [], "uuid": "cdd37b44-de0d-4d98-9838-4a082fa960ba"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "e02f8607-86d2-414e-88d1-1e3ab584d936"}, "message_list": [], "variable_list": [], "uuid": "19824998-1e56-4738-9111-2b55c2f85a7b"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "f570c76b-ca07-4ee6-942f-4b951058d695", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Substrate_Element_Delete_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "1f9059fc-984f-4b1a-9364-82069222f920"}], "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "1066a0d3-d363-496a-b9e5-433148c66728"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Substrate_Element_Delete_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "1f9059fc-984f-4b1a-9364-82069222f920"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "1066a0d3-d363-496a-b9e5-433148c66728"}, "message_list": [], "variable_list": [], "uuid": "c5b7466c-c856-403b-9cf6-7c9252720608"}, "message_list": [], "name": "action_soft_delete"}], "type": "AHV_VM", "name": "K8SM_Centos", "state": "ACTIVE", "readiness_probe": {"connection_type": "SSH", "disable_readiness_probe": false, "timeout_secs": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@", "connection_port": 22, "login_credential_local_reference": {"kind": "app_credential", "name": "KUBE", "uuid": "95632617-86a6-4eec-9df7-e731de24225e"}}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"device_type": true, "disk_address": {"adapter_type": true}}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "message_list": [], "create_spec": {"name": "Centos-K8SM@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "cbc0c43a-5b92-49b2-9851-5a10041b6d1b"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "#cloud-config\nusers:\n  - name: kube\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CentOS-7-x86_64-GenericCloud-1801-01", "uuid": "2be2cb61-1220-4b9a-a8ad-1893565f00d4"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "variable_list": [], "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, {"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "2be3fbd5-e36a-4f68-a67b-ef156535fafc", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "87d3b8e2-54de-41d3-82b2-5bd6c651eae1"}, {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SC_Core_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "660cf12c-29d1-4910-adb8-306ce3046a1c"}], "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "87d3b8e2-54de-41d3-82b2-5bd6c651eae1"}, "edge_type": "inherent", "type": "", "uuid": "836ec51e-515d-46b5-a7fa-ab0c2466614f", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SC_Core_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "660cf12c-29d1-4910-adb8-306ce3046a1c"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "ab47f1e5-cbdf-400e-b2fc-5f04728c86c8"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Provision_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"name": "Core-K8SC@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "1d7c2d16-d673-4837-a5ea-42295392e1d4"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "{\n  \"ignition\": {\n    \"version\": \"2.0.0\"\n  },\n  \"passwd\": {\n    \"users\": [{\n      \"name\": \"kube\",\n      \"sshAuthorizedKeys\": [\n        \"@@{INSTANCE_PUBLIC_KEY}@@\"\n      ],\n      \"create\": {\n        \"groups\": [\n          \"sudo\",\n          \"docker\"\n        ]\n      }\n    }]\n  },\n  \"storage\": {\n    \"files\": [{\n      \"contents\": {\n        \"source\": \"data:,controller@@{calm_array_index}@@\"\n      },\n      \"filesystem\": \"root\",\n      \"mode\": 420,\n      \"path\": \"/etc/hostname\"\n    }]\n  }\n}"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CoreOs", "uuid": "a00950f0-7d75-4044-a9f5-646d665fe704"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "timeout_secs": "", "type": "PROVISION_NUTANIX", "variable_list": [], "uuid": "87d3b8e2-54de-41d3-82b2-5bd6c651eae1"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__check_login_for_K8SC_Core_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "60", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "660cf12c-29d1-4910-adb8-306ce3046a1c"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "ab47f1e5-cbdf-400e-b2fc-5f04728c86c8"}, "message_list": [], "variable_list": [], "uuid": "164954b6-f172-454f-b438-88d39f52e998"}, "message_list": [], "name": "action_create"}, {"description": "System action for powering on an application", "type": "system", "uuid": "f577da47-a479-4caf-a996-21d081cd8092", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "c2874c5f-5837-4dce-9b05-988ab89ab90a"}, {"kind": "app_task", "name": "check_login_for_K8SC_Core_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "820fd318-3ac2-4dce-b87f-edc2d9b8da0c"}], "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "c2874c5f-5837-4dce-9b05-988ab89ab90a"}, "edge_type": "inherent", "type": "", "uuid": "25f996a7-569d-4e18-a435-c42b758f4fd6", "to_task_reference": {"kind": "app_task", "name": "check_login_for_K8SC_Core_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "820fd318-3ac2-4dce-b87f-edc2d9b8da0c"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "63ee39c8-38cf-4ce2-94a8-575df440dd5d"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOn_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "c2874c5f-5837-4dce-9b05-988ab89ab90a"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "check_login_for_K8SC_Core_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "60", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "820fd318-3ac2-4dce-b87f-edc2d9b8da0c"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "63ee39c8-38cf-4ce2-94a8-575df440dd5d"}, "message_list": [], "variable_list": [], "uuid": "fda6dc44-6df2-4e0f-8cd5-483e317bb165"}, "message_list": [], "name": "action_poweron"}, {"description": "System action for suspending an application", "type": "system", "uuid": "c6f1583e-d046-43fb-ba2a-0a94d79ac412", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "5f128323-d8be-4955-9e7a-aa58ff7a1420"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "5f128323-d8be-4955-9e7a-aa58ff7a1420"}, "message_list": [], "variable_list": [], "uuid": "557b506d-1f02-47c8-a8c2-52a7102e911b"}, "message_list": [], "name": "action_suspend"}, {"description": "System action for modifying an application", "type": "system", "uuid": "442a2296-21d1-4da1-ba65-236e8b9d11b0", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "5d561178-3c8e-4671-8c6d-ab34d734234a"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "5d561178-3c8e-4671-8c6d-ab34d734234a"}, "message_list": [], "variable_list": [], "uuid": "90a81ed4-faf0-4dce-b206-bf36491326f7"}, "message_list": [], "name": "action_modify"}, {"description": "System action for powering off an application", "type": "system", "uuid": "944061b8-9b14-476c-bc78-14cbca87e238", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOff_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "cf30f87f-1c46-495c-b6a6-1a77b875de56"}], "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "dccc11f2-97ba-4ace-a479-99c52c2d1443"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOff_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "cf30f87f-1c46-495c-b6a6-1a77b875de56"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "dccc11f2-97ba-4ace-a479-99c52c2d1443"}, "message_list": [], "variable_list": [], "uuid": "3f997f3d-efc8-49e5-a2ac-5f3f3a8ca120"}, "message_list": [], "name": "action_poweroff"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "6e25b502-0a7e-48b7-9f23-6366022c72bc", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Delete_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "ecd0bbd4-b00d-4170-b49a-15fb26ca91ec"}], "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "5314acea-ab04-4a2f-861d-85b2e9440fd1"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Delete_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_NUTANIX", "variable_list": [], "uuid": "ecd0bbd4-b00d-4170-b49a-15fb26ca91ec"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "5314acea-ab04-4a2f-861d-85b2e9440fd1"}, "message_list": [], "variable_list": [], "uuid": "1db390cb-e26a-492c-94ff-f476e8f7466f"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "43efe1fd-b08d-44a6-91e5-e7209a951b4f", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Substrate_Element_Delete_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "7eb3162e-072f-4ba7-8db6-52aa1c8a882e"}], "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "100c2af3-0b71-45c0-b2ba-156647091a2c"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Substrate_Element_Delete_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "7eb3162e-072f-4ba7-8db6-52aa1c8a882e"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "100c2af3-0b71-45c0-b2ba-156647091a2c"}, "message_list": [], "variable_list": [], "uuid": "cd9ff04f-74f4-4942-ab25-1b4f982abaec"}, "message_list": [], "name": "action_soft_delete"}], "type": "AHV_VM", "name": "K8SC_Core", "state": "ACTIVE", "readiness_probe": {"connection_type": "SSH", "disable_readiness_probe": false, "connection_port": 22, "timeout_secs": "60", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"disk_address": {"adapter_type": true}, "device_type": true}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "message_list": [], "create_spec": {"name": "Core-K8SC@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "1d7c2d16-d673-4837-a5ea-42295392e1d4"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "{\n  \"ignition\": {\n    \"version\": \"2.0.0\"\n  },\n  \"passwd\": {\n    \"users\": [{\n      \"name\": \"kube\",\n      \"sshAuthorizedKeys\": [\n        \"@@{INSTANCE_PUBLIC_KEY}@@\"\n      ],\n      \"create\": {\n        \"groups\": [\n          \"sudo\",\n          \"docker\"\n        ]\n      }\n    }]\n  },\n  \"storage\": {\n    \"files\": [{\n      \"contents\": {\n        \"source\": \"data:,controller@@{calm_array_index}@@\"\n      },\n      \"filesystem\": \"root\",\n      \"mode\": 420,\n      \"path\": \"/etc/hostname\"\n    }]\n  }\n}"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CoreOs", "uuid": "a00950f0-7d75-4044-a9f5-646d665fe704"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "variable_list": [], "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, {"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "a2d05751-4297-44a9-bbf0-bb7f39c9926b", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "26669724-6808-4448-ba85-a6dee4ad99f5"}, {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SM_Core_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "88dea2f2-81a5-4307-9e0e-b492ac0c0a70"}], "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Provision_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "26669724-6808-4448-ba85-a6dee4ad99f5"}, "edge_type": "inherent", "type": "", "uuid": "0d166ff6-6404-4c25-95cd-4db1bde44e1b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__check_login_for_K8SM_Core_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "88dea2f2-81a5-4307-9e0e-b492ac0c0a70"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e93e4d61-fa7a-4917-abe9-6d242b4dc16a"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Provision_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"name": "Core-K8SM@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "1d7c2d16-d673-4837-a5ea-42295392e1d4"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "{\n  \"ignition\": {\n    \"version\": \"2.0.0\"\n  },\n  \"passwd\": {\n    \"users\": [{\n      \"name\": \"kube\",\n      \"sshAuthorizedKeys\": [\n        \"@@{INSTANCE_PUBLIC_KEY}@@\"\n      ],\n      \"create\": {\n        \"groups\": [\n          \"sudo\",\n          \"docker\"\n        ]\n      }\n    }]\n  },\n  \"storage\": {\n    \"files\": [{\n      \"contents\": {\n        \"source\": \"data:,minion@@{calm_array_index}@@\"\n      },\n      \"filesystem\": \"root\",\n      \"mode\": 420,\n      \"path\": \"/etc/hostname\"\n    }]\n  }\n}"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CoreOs", "uuid": "a00950f0-7d75-4044-a9f5-646d665fe704"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "timeout_secs": "", "type": "PROVISION_NUTANIX", "variable_list": [], "uuid": "26669724-6808-4448-ba85-a6dee4ad99f5"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__check_login_for_K8SM_Core_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "60", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "88dea2f2-81a5-4307-9e0e-b492ac0c0a70"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "e93e4d61-fa7a-4917-abe9-6d242b4dc16a"}, "message_list": [], "variable_list": [], "uuid": "1529baa8-9f32-4055-b130-d28613358c89"}, "message_list": [], "name": "action_create"}, {"description": "System action for powering on an application", "type": "system", "uuid": "4d0c66e8-476f-4dac-9adf-1c578251fc1d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "ba42b602-a78d-46b0-9504-fc8ec61c57eb"}, {"kind": "app_task", "name": "check_login_for_K8SM_Core_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "d42fe79b-94da-417b-a1ea-cfd4b7cdc809"}], "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOn_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "ba42b602-a78d-46b0-9504-fc8ec61c57eb"}, "edge_type": "inherent", "type": "", "uuid": "84cc121e-dcdb-4c26-b52e-945412b71e36", "to_task_reference": {"kind": "app_task", "name": "check_login_for_K8SM_Core_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "d42fe79b-94da-417b-a1ea-cfd4b7cdc809"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a111469a-3a47-4d41-93b2-ee5e8b297ae9"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOn_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "ba42b602-a78d-46b0-9504-fc8ec61c57eb"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "check_login_for_K8SM_Core_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CHECK_LOGIN", "timeout": "60", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "timeout_secs": "", "type": "CHECK_LOGIN", "variable_list": [], "uuid": "d42fe79b-94da-417b-a1ea-cfd4b7cdc809"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "a111469a-3a47-4d41-93b2-ee5e8b297ae9"}, "message_list": [], "variable_list": [], "uuid": "dc8da279-ebd9-46c3-8bb9-8a76f6f3df1c"}, "message_list": [], "name": "action_poweron"}, {"description": "System action for suspending an application", "type": "system", "uuid": "b81077de-4a9d-4f7f-a8d9-a9cdf9845ee7", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "723b65e1-3b88-4e61-b562-9e98d7e6507f"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "723b65e1-3b88-4e61-b562-9e98d7e6507f"}, "message_list": [], "variable_list": [], "uuid": "0a259c98-fa6d-4b59-9324-dd9171e53874"}, "message_list": [], "name": "action_suspend"}, {"description": "System action for modifying an application", "type": "system", "uuid": "82573e74-d579-4dad-bfe8-5901f8af1423", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "7c7bd680-4b92-49d8-b325-ab82f3ae0f62"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "7c7bd680-4b92-49d8-b325-ab82f3ae0f62"}, "message_list": [], "variable_list": [], "uuid": "db348a6f-6eba-4bde-936e-62f7f359f7ce"}, "message_list": [], "name": "action_modify"}, {"description": "System action for powering off an application", "type": "system", "uuid": "4dd80f96-936e-4a19-a0b4-4dc88c8b5b33", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Operation_PowerOff_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "961d6dd6-9b48-4cc1-a8e6-386bd43a1e76"}], "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "62af31dd-fe89-4a39-bc06-207e5e57f0e4"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Operation_PowerOff_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "GENERIC_OPERATION"}, "timeout_secs": "", "type": "VMOPERATION_NUTANIX", "variable_list": [], "uuid": "961d6dd6-9b48-4cc1-a8e6-386bd43a1e76"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "62af31dd-fe89-4a39-bc06-207e5e57f0e4"}, "message_list": [], "variable_list": [], "uuid": "2dde39fa-2790-4436-b897-584ad08bb3ab"}, "message_list": [], "name": "action_poweroff"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "9c6d2a6b-ccdc-46a8-b55a-4793adc495ce", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Nutanix_Delete_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "8c6bd033-2b68-4426-97d9-781ff90a43ad"}], "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "d4fc7ca3-a0bc-43e7-9468-560ffd38754b"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Nutanix_Delete_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_NUTANIX", "variable_list": [], "uuid": "8c6bd033-2b68-4426-97d9-781ff90a43ad"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "d4fc7ca3-a0bc-43e7-9468-560ffd38754b"}, "message_list": [], "variable_list": [], "uuid": "cf4bb8ca-2d92-44a4-a11b-8945d5289200"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "148976b7-8e19-469a-9523-35ab7f0e6fbd", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Substrate_Element_Delete_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "d3520fe9-288d-446e-b9aa-d39dbf1324af"}], "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "dd6c275c-44d8-44d0-be6c-9c6e8f39ac16"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Substrate_Element_Delete_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "d3520fe9-288d-446e-b9aa-d39dbf1324af"}], "description": "", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "dd6c275c-44d8-44d0-be6c-9c6e8f39ac16"}, "message_list": [], "variable_list": [], "uuid": "5549ebeb-99d4-4d05-8bbd-8532092f0db0"}, "message_list": [], "name": "action_soft_delete"}], "type": "AHV_VM", "name": "K8SM_Core", "state": "ACTIVE", "readiness_probe": {"connection_type": "SSH", "disable_readiness_probe": false, "connection_port": 22, "timeout_secs": "60", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@"}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"disk_address": {"adapter_type": true}, "device_type": true}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "message_list": [], "create_spec": {"name": "Core-K8SM@@{calm_array_index}@@", "availability_zone_reference": null, "backup_policy": null, "type": "", "cluster_reference": null, "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "1d7c2d16-d673-4837-a5ea-42295392e1d4"}, "type": ""}], "power_state": "ON", "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "parent_reference": null, "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "{\n  \"ignition\": {\n    \"version\": \"2.0.0\"\n  },\n  \"passwd\": {\n    \"users\": [{\n      \"name\": \"kube\",\n      \"sshAuthorizedKeys\": [\n        \"@@{INSTANCE_PUBLIC_KEY}@@\"\n      ],\n      \"create\": {\n        \"groups\": [\n          \"sudo\",\n          \"docker\"\n        ]\n      }\n    }]\n  },\n  \"storage\": {\n    \"files\": [{\n      \"contents\": {\n        \"source\": \"data:,minion@@{calm_array_index}@@\"\n      },\n      \"filesystem\": \"root\",\n      \"mode\": 420,\n      \"path\": \"/etc/hostname\"\n    }]\n  }\n}"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CoreOs", "uuid": "a00950f0-7d75-4044-a9f5-646d665fe704"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 0, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 1, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 2, "adapter_type": "SCSI"}, "device_type": "DISK"}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "disk_address": {"type": "", "device_index": 3, "adapter_type": "SCSI"}, "device_type": "DISK"}}]}}, "variable_list": [], "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}], "credential_definition_list": [{"username": "kube", "description": "", "secret": {"attrs": {"is_secret_modified": false, "secret_reference": {}}}, "name": "KUBE", "state": "ACTIVE", "editables": {"username": true, "secret": true}, "type": "KEY", "uuid": "95632617-86a6-4eec-9df7-e731de24225e"}], "app_profile_list": [{"deployment_create_list": [{"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "46045985-dbcf-42de-ac5d-c6e2b04e1502", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__DE_Provision_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "eb34bb01-3889-492c-9ef8-b61da53d65a8"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "52c81ccd-5bd3-4db0-a219-267d9f57bb80"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "1a870aa2-79c2-4664-ba8d-a7b7d58cac93"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9e2d9157-4d70-4f94-9a9c-7d94d954ffb6"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "4227fcbd-6668-4dc0-988d-133c65d9d9f6"}], "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9e2d9157-4d70-4f94-9a9c-7d94d954ffb6"}, "edge_type": "inherent", "type": "", "uuid": "f1cb1944-784f-40aa-9d9d-c46636c74e70", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "4227fcbd-6668-4dc0-988d-133c65d9d9f6"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "1a870aa2-79c2-4664-ba8d-a7b7d58cac93"}, "edge_type": "inherent", "type": "", "uuid": "83a75a45-7852-41c5-8e3b-3ea00f375236", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9e2d9157-4d70-4f94-9a9c-7d94d954ffb6"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "eb34bb01-3889-492c-9ef8-b61da53d65a8"}, "edge_type": "inherent", "type": "", "uuid": "4ce707d0-5527-4d41-a878-371ac89e18b3", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "52c81ccd-5bd3-4db0-a219-267d9f57bb80"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "52c81ccd-5bd3-4db0-a219-267d9f57bb80"}, "edge_type": "inherent", "type": "", "uuid": "5128ca8c-0d7c-47a2-b72b-2f8d13430c76", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "1a870aa2-79c2-4664-ba8d-a7b7d58cac93"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c4675d8f-5937-4d3d-bc64-e8568aeca238"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "eb34bb01-3889-492c-9ef8-b61da53d65a8"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "3be99ca4-d9b1-49f2-9c91-95650be3d84d"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "52c81ccd-5bd3-4db0-a219-267d9f57bb80"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "836f40c0-e00c-4e5a-ab61-6e8c8554c54b"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "1a870aa2-79c2-4664-ba8d-a7b7d58cac93"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "39d74fe7_runbook", "uuid": "d28a648a-b9fd-4a6f-a2af-d05db381ae3a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "9e2d9157-4d70-4f94-9a9c-7d94d954ffb6"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "4227fcbd-6668-4dc0-988d-133c65d9d9f6"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "c4675d8f-5937-4d3d-bc64-e8568aeca238"}, "message_list": [], "variable_list": [], "uuid": "9935478f-3242-4a22-b72e-42c22fe9ec1c"}, "message_list": [], "name": "action_create"}, {"description": "System action for starting an application", "type": "system", "uuid": "a7a79650-7f58-4096-8e4c-e7cb23691fda", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "876fcb6d-066c-4f40-9e6a-5710d9840375"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "87744699-16b3-4f8f-8363-5e83fc02aa3e"}], "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "876fcb6d-066c-4f40-9e6a-5710d9840375"}, "edge_type": "inherent", "type": "", "uuid": "bb67310f-f323-43b9-8469-be46a14a061c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "87744699-16b3-4f8f-8363-5e83fc02aa3e"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "d00f5cd9-8e4e-4aa9-84b0-87a18f6e00cf"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "cb021452-5a34-4e77-aea5-39f448d78160"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "876fcb6d-066c-4f40-9e6a-5710d9840375"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "87744699-16b3-4f8f-8363-5e83fc02aa3e"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "d00f5cd9-8e4e-4aa9-84b0-87a18f6e00cf"}, "message_list": [], "variable_list": [], "uuid": "94c1a296-9942-415c-bbf9-152c898baf90"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "1883670f-25b5-4014-82b5-2895fd298e15", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8a78600e-8beb-4629-8b07-9f9a31294ba7"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "18e8de40-a702-44b9-8916-2ac2ef88f0fb"}], "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8a78600e-8beb-4629-8b07-9f9a31294ba7"}, "edge_type": "inherent", "type": "", "uuid": "fd335411-cf7c-4cfe-ac02-a88962a16b2d", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "18e8de40-a702-44b9-8916-2ac2ef88f0fb"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "d3f9d4c5-110c-405a-b41e-9908e2cc410b"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "8a78600e-8beb-4629-8b07-9f9a31294ba7"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "f9d4337c-75c3-4c91-9cf2-852712ecdc61"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "18e8de40-a702-44b9-8916-2ac2ef88f0fb"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "d3f9d4c5-110c-405a-b41e-9908e2cc410b"}, "message_list": [], "variable_list": [], "uuid": "8c4f20cf-6ae5-4235-9679-19a4b5dd993c"}, "message_list": [], "name": "action_stop"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "24f1cb24-b3ed-4da9-bd71-84dfb2d8ff2b", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "d76334b4-029f-45f0-b18f-4a1063dfcd83"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "aea4b548-e773-46fe-a3d7-7f5546d1a63f"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d92f7b32-bea8-4320-be9a-bb4ecd9b42b2"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "eb7a580b-bfa7-49d5-aed6-9cc633f29c28"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "af3afd9c-ff5b-4ad3-a1d3-89bd605da1f5"}], "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "d76334b4-029f-45f0-b18f-4a1063dfcd83"}, "edge_type": "inherent", "type": "", "uuid": "4ccbfa65-e5d2-496a-bb56-6fec00be78b7", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "aea4b548-e773-46fe-a3d7-7f5546d1a63f"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "aea4b548-e773-46fe-a3d7-7f5546d1a63f"}, "edge_type": "inherent", "type": "", "uuid": "5a75b07d-028e-4ba1-92de-61ad7a2233da", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d92f7b32-bea8-4320-be9a-bb4ecd9b42b2"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "eb7a580b-bfa7-49d5-aed6-9cc633f29c28"}, "edge_type": "inherent", "type": "", "uuid": "90e0b4e0-c84e-4caa-bd81-97258894eafa", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "af3afd9c-ff5b-4ad3-a1d3-89bd605da1f5"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d92f7b32-bea8-4320-be9a-bb4ecd9b42b2"}, "edge_type": "inherent", "type": "", "uuid": "da19b488-9a43-45cb-b532-8e6841971a6e", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "eb7a580b-bfa7-49d5-aed6-9cc633f29c28"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "5bf21895-0c0d-4889-a5f1-048bcea436bd"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d76334b4-029f-45f0-b18f-4a1063dfcd83"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "b00241d6_runbook", "uuid": "a5999398-fee7-49e7-8af2-7c82fe537838"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "aea4b548-e773-46fe-a3d7-7f5546d1a63f"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "54a21e6d-8912-4e49-a0b8-31a11f87ca0f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d92f7b32-bea8-4320-be9a-bb4ecd9b42b2"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "84a21642-2518-409e-bcaa-81ef0d89ee5d"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "eb7a580b-bfa7-49d5-aed6-9cc633f29c28"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "af3afd9c-ff5b-4ad3-a1d3-89bd605da1f5"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "5bf21895-0c0d-4889-a5f1-048bcea436bd"}, "message_list": [], "variable_list": [], "uuid": "8af56219-4fb2-4469-bda6-5311e103b5c9"}, "message_list": [], "name": "action_delete"}, {"description": "System action for scaleout", "type": "system", "uuid": "77eef060-3a39-4f56-9192-e3372fbfa933", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scaleout_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "461efcbc-6ae4-488d-a1d9-98c24d7feb2c"}], "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "633afaff-fcb5-4695-b395-e54fcc8bb55b"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scaleout_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEOUT"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "461efcbc-6ae4-488d-a1d9-98c24d7feb2c"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "633afaff-fcb5-4695-b395-e54fcc8bb55b"}, "message_list": [], "variable_list": [], "uuid": "5c5d0ea0-50d4-4309-8196-e0193070f651"}, "message_list": [], "name": "action_scaleout"}, {"description": "System action for scalein", "type": "system", "uuid": "7b4fcd15-b6ab-46c8-85e4-d62e7a019caa", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scalein_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "ef5cca88-9265-4c01-a323-dd643c89a30c"}], "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "d0c7652a-3a87-433c-b60d-3689f2a1e33f"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scalein_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEIN"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "ef5cca88-9265-4c01-a323-dd643c89a30c"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "d0c7652a-3a87-433c-b60d-3689f2a1e33f"}, "message_list": [], "variable_list": [], "uuid": "fb07f797-b511-4251-8ea5-930eab421e5c"}, "message_list": [], "name": "action_scalein"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "d357b1e7-62c6-4796-af70-bd9deec9350c", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "4fac0007-2027-4bad-b8a0-e50c552e39c0"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "7313d265-3665-4aa8-a57c-348c26a513b4"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "55babc6d-05ad-4d0c-8717-fe323955c34f"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "13f3164f-2c1c-4dbf-b19d-040458308fda"}], "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "4fac0007-2027-4bad-b8a0-e50c552e39c0"}, "edge_type": "inherent", "type": "", "uuid": "86517298-5541-48d6-98b5-a6a77a42d588", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "7313d265-3665-4aa8-a57c-348c26a513b4"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "55babc6d-05ad-4d0c-8717-fe323955c34f"}, "edge_type": "inherent", "type": "", "uuid": "bb8d8691-00f8-41d6-b0e7-e9599051e00c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "13f3164f-2c1c-4dbf-b19d-040458308fda"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "7313d265-3665-4aa8-a57c-348c26a513b4"}, "edge_type": "inherent", "type": "", "uuid": "1a565d0a-247c-48af-baa7-5fcedd731e81", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "55babc6d-05ad-4d0c-8717-fe323955c34f"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "71750d95-a6f1-41a3-978f-bd6cf23bdf0f"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "59a30bab-b0f4-4159-82ca-96708920121f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "4fac0007-2027-4bad-b8a0-e50c552e39c0"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "7313d265-3665-4aa8-a57c-348c26a513b4"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "117187f5-fffd-4889-81c4-3feeac5b283a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "55babc6d-05ad-4d0c-8717-fe323955c34f"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "13f3164f-2c1c-4dbf-b19d-040458308fda"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "71750d95-a6f1-41a3-978f-bd6cf23bdf0f"}, "message_list": [], "variable_list": [], "uuid": "79f13ab8-1fba-463a-82f7-cc72a0945ce7"}, "message_list": [], "name": "action_soft_delete"}], "message_list": [], "editables": {"min_replicas": true}, "name": "7e23eb76_deployment", "state": "ACTIVE", "max_replicas": "3", "package_local_reference_list": [{"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}], "substrate_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "min_replicas": "3", "variable_list": [], "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, {"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "8779dfb3-d011-42f0-8eec-513f6250f4e0", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__DE_Provision_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "3411fc95-78e3-415f-876d-36304d5c5e4b"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "8a5bea05-9120-4faa-8b6a-c5fbb61464da"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "87a444f8-eb1f-40e9-a643-a408f05b8c28"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "960eb100-96ef-4d34-9b27-12af63c5c80f"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "2949fda7-466f-47ee-afc2-21bcc48fd3ba"}], "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "960eb100-96ef-4d34-9b27-12af63c5c80f"}, "edge_type": "inherent", "type": "", "uuid": "641410f0-25be-46a8-8bbf-581054778d5b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "2949fda7-466f-47ee-afc2-21bcc48fd3ba"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "87a444f8-eb1f-40e9-a643-a408f05b8c28"}, "edge_type": "inherent", "type": "", "uuid": "93165025-74dc-4334-94db-f862cb986923", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "960eb100-96ef-4d34-9b27-12af63c5c80f"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "3411fc95-78e3-415f-876d-36304d5c5e4b"}, "edge_type": "inherent", "type": "", "uuid": "766d313d-101c-4c0e-9007-ed401fecc170", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "8a5bea05-9120-4faa-8b6a-c5fbb61464da"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "8a5bea05-9120-4faa-8b6a-c5fbb61464da"}, "edge_type": "inherent", "type": "", "uuid": "c1120730-b661-47d4-9227-7f14027986a7", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "87a444f8-eb1f-40e9-a643-a408f05b8c28"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a90df025-a586-4f62-bdc3-e6be6447b0f3"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "3411fc95-78e3-415f-876d-36304d5c5e4b"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "cfdab38b-b74c-437d-a6da-014d8e7d9600"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "8a5bea05-9120-4faa-8b6a-c5fbb61464da"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "c191cff3-2e12-4449-afde-c4e2872b9d47"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "87a444f8-eb1f-40e9-a643-a408f05b8c28"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "925ba7c0_runbook", "uuid": "ce426880-342a-4995-9d9c-c9dec8c586c4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "960eb100-96ef-4d34-9b27-12af63c5c80f"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "2949fda7-466f-47ee-afc2-21bcc48fd3ba"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "a90df025-a586-4f62-bdc3-e6be6447b0f3"}, "message_list": [], "variable_list": [], "uuid": "9aa210ed-dae0-430a-9bf2-ff35a5684087"}, "message_list": [], "name": "action_create"}, {"description": "System action for starting an application", "type": "system", "uuid": "d15d7126-5e92-4c56-8429-38ba9e699fd5", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "68123759-9d37-44dd-bb23-85caab208ed6"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "57f00745-868a-447c-a3ac-e370325fdc60"}], "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "68123759-9d37-44dd-bb23-85caab208ed6"}, "edge_type": "inherent", "type": "", "uuid": "b0525c81-2abd-4996-aea0-c5bbfee096bd", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "57f00745-868a-447c-a3ac-e370325fdc60"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "3109d54d-4e7a-45ff-a9ec-2840f9f5daf6"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "3724ade2-498b-4615-9de1-94204d9f285e"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "68123759-9d37-44dd-bb23-85caab208ed6"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "57f00745-868a-447c-a3ac-e370325fdc60"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "3109d54d-4e7a-45ff-a9ec-2840f9f5daf6"}, "message_list": [], "variable_list": [], "uuid": "df431447-b0f8-4bf4-a712-8405abfa62f3"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "4b082ec2-d151-443c-b837-8c680fa6d9a0", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "2a6aa8be-3235-47cc-85aa-89cb6fc7f7a7"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "373591d9-810b-4465-a69e-cdb5f187cbbe"}], "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "2a6aa8be-3235-47cc-85aa-89cb6fc7f7a7"}, "edge_type": "inherent", "type": "", "uuid": "9b4b2b87-d318-43d4-8b07-eab32fb97138", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "373591d9-810b-4465-a69e-cdb5f187cbbe"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "60d430aa-c4cc-4742-aeb8-ac216e6eda11"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "2a6aa8be-3235-47cc-85aa-89cb6fc7f7a7"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "7a22b3d2-0e89-48ee-b513-c6cb909d40d0"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "373591d9-810b-4465-a69e-cdb5f187cbbe"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "60d430aa-c4cc-4742-aeb8-ac216e6eda11"}, "message_list": [], "variable_list": [], "uuid": "84e59183-b01c-470f-8d1e-b1298b22cc29"}, "message_list": [], "name": "action_stop"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "4a2a3439-7e36-4f9b-98da-7e3ec93b5246", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "a9271078-5efe-4731-9dae-7fe3cb9e470a"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6f2d5dda-a794-490d-b75a-83285c5c57ef"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "4d38a7c8-c29c-496e-963c-a2ad90d056c7"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "aad7e06c-0e06-4a5d-9d65-2601c9ab9229"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "a813054d-6f6e-496d-8259-18a00502c27f"}], "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "a9271078-5efe-4731-9dae-7fe3cb9e470a"}, "edge_type": "inherent", "type": "", "uuid": "6245d440-ea19-4802-be9d-35c82f5b93ec", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6f2d5dda-a794-490d-b75a-83285c5c57ef"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6f2d5dda-a794-490d-b75a-83285c5c57ef"}, "edge_type": "inherent", "type": "", "uuid": "f071f936-82d5-4291-bbc1-2dd45afa9a82", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "4d38a7c8-c29c-496e-963c-a2ad90d056c7"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "aad7e06c-0e06-4a5d-9d65-2601c9ab9229"}, "edge_type": "inherent", "type": "", "uuid": "909c01ef-ee97-4dea-b7dd-661885fad48e", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "a813054d-6f6e-496d-8259-18a00502c27f"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "4d38a7c8-c29c-496e-963c-a2ad90d056c7"}, "edge_type": "inherent", "type": "", "uuid": "bc3e29e6-536e-4891-9313-e060b157a27c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "aad7e06c-0e06-4a5d-9d65-2601c9ab9229"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "315654f8-d7e9-434d-93a3-b1a63499d34c"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "a9271078-5efe-4731-9dae-7fe3cb9e470a"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "28e74b96_runbook", "uuid": "0ab86c44-ee03-4d60-ae33-3bc75165ee6a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "6f2d5dda-a794-490d-b75a-83285c5c57ef"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "04b54e48-af42-449f-8530-e718b7d0f383"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "4d38a7c8-c29c-496e-963c-a2ad90d056c7"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "19824998-1e56-4738-9111-2b55c2f85a7b"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "aad7e06c-0e06-4a5d-9d65-2601c9ab9229"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "a813054d-6f6e-496d-8259-18a00502c27f"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "315654f8-d7e9-434d-93a3-b1a63499d34c"}, "message_list": [], "variable_list": [], "uuid": "53edf511-9901-43ea-ab81-532a5e03615b"}, "message_list": [], "name": "action_delete"}, {"description": "System action for scaleout", "type": "system", "uuid": "faae24a8-202a-4727-8555-d7d2004329e8", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scaleout_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "2500e226-000e-4471-be6e-97e3ebed2501"}], "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c019705b-c3e1-40f6-81ba-9df5c0127ba8"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scaleout_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEOUT"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "2500e226-000e-4471-be6e-97e3ebed2501"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "c019705b-c3e1-40f6-81ba-9df5c0127ba8"}, "message_list": [], "variable_list": [], "uuid": "4e15cdb3-6a2f-4bcf-b87a-19b5b803b855"}, "message_list": [], "name": "action_scaleout"}, {"description": "System action for scalein", "type": "system", "uuid": "74b23bfa-99e8-4086-99bd-26a2338b5616", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scalein_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "f5d4d70a-d9b5-41f3-80e4-e91f4c1dc77a"}], "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "70f77dcd-2c58-44d5-a199-e7bf0538b10e"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scalein_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEIN"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "f5d4d70a-d9b5-41f3-80e4-e91f4c1dc77a"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "70f77dcd-2c58-44d5-a199-e7bf0538b10e"}, "message_list": [], "variable_list": [], "uuid": "fe0ad793-adaa-438e-8fd9-e2bf477f7972"}, "message_list": [], "name": "action_scalein"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "dda8314d-97d0-4358-a555-9659a74f9489", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "24ba2708-46ac-4e17-92b5-0142a3d8abda"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "bc5eab7c-6cff-4d70-a918-d1b3cb48e8c5"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "15d9de47-1b31-4fa3-aef7-ce2315129a14"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "1ff3f288-9b8f-4462-ab87-3fb5b19b6e74"}], "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "24ba2708-46ac-4e17-92b5-0142a3d8abda"}, "edge_type": "inherent", "type": "", "uuid": "63de61cc-a448-431e-8bc7-a76be1ca7a75", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "bc5eab7c-6cff-4d70-a918-d1b3cb48e8c5"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "15d9de47-1b31-4fa3-aef7-ce2315129a14"}, "edge_type": "inherent", "type": "", "uuid": "1009afb4-ecd3-4079-aff6-8fd775b8057b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "1ff3f288-9b8f-4462-ab87-3fb5b19b6e74"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "bc5eab7c-6cff-4d70-a918-d1b3cb48e8c5"}, "edge_type": "inherent", "type": "", "uuid": "7069c3cc-a58d-4f6b-9293-4b93c6491932", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "15d9de47-1b31-4fa3-aef7-ce2315129a14"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a79b59dc-98d8-4b5b-aab4-cba78476d8e3"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8bf1f321-c96c-485d-bf06-13a230fc1e23"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "24ba2708-46ac-4e17-92b5-0142a3d8abda"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "bc5eab7c-6cff-4d70-a918-d1b3cb48e8c5"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "c5b7466c-c856-403b-9cf6-7c9252720608"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "15d9de47-1b31-4fa3-aef7-ce2315129a14"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "1ff3f288-9b8f-4462-ab87-3fb5b19b6e74"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "a79b59dc-98d8-4b5b-aab4-cba78476d8e3"}, "message_list": [], "variable_list": [], "uuid": "775456cd-11ab-46eb-b8d3-f5a4bd2c882c"}, "message_list": [], "name": "action_soft_delete"}], "message_list": [], "editables": {"min_replicas": true}, "name": "0fd632f7_deployment", "state": "ACTIVE", "max_replicas": "2", "package_local_reference_list": [{"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}], "substrate_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "min_replicas": "2", "variable_list": [], "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}], "description": "", "action_list": [{"description": "", "type": "user", "uuid": "b182f054-22ac-4c5c-bf98-34d826715a09", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Test", "uuid": "4815551b-8fb0-4524-bfbd-84151b10fd90"}], "name": "fc93ef5a_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "1bf296de-0b89-4782-b940-852e47cb89f3"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Test", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\n\nexport PATH=$PATH:/opt/bin\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nCONTROLLER_IP=\"@@{calm_array_address}@@\"\nWORKER_IP=\"@@{K8SM_Centos.address}@@\"\nMASTER_IP=\"@@{address}@@\"\n\nfunction log_msg() {\n\tlocal logger=$(basename \"$0\")\n\tprintf \"[${logger}] $1\\n\"\n}\n\n\n# SSH to a node ($1), run command ($2)).\nfunction ssh_run_command() {\n\tlocal node=\"$1\"\n\tlocal command=\"$2\"\n\tssh  -oBatchMode=yes -oConnectTimeout=10 -o StrictHostKeyChecking=no \\\n\t\t-o UserKnownHostsFile=/dev/null -q ${node} ${command} 2>&1 | tr -d '\\r\\n'\n}\n\n\nfunction check_ssh_connectivity() {\n\tlog_msg \"  Checking SSH connectivity to each node (from this host)...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to master ${master}\"\n\t\t\tlog_msg \"  Only IPs in ${CONTROLLER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to worker ${worker}\"\n\t\t\tlog_msg \"  Only IPs in ${WORKER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n}\n\nfunction check_system_services() {\n\n\tlog_msg \"  Checking whether expected system services are running on each node...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-etcd service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kube-etcd 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kube-etcd service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\n\tdone\n\n}\n\nfunction check_k8s_healthz_through_lb() {\n\tlog_msg \"  Checking status of /healthz endpoint...\"\n\toutput=$(curl --insecure --max-time 30 https://${MASTER_IP}:443/healthz 2>/dev/null)\n\tif [[ $output != \"ok\" ]]; then\n\t\tlog_msg \"  [FAILED] Master node /healthz is not available\"\n\t\texit 1\n\tfi\n\n}\n\nfunction check_get_nodes() {\n\tlog_msg \"  Running 'kubectl get nodes' a number of times through the master...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 1)\n\tfor i in {1..20}; do\n\t\tcount=$(kubectl get nodes --no-headers 2>/dev/null | grep \"Ready\" | wc -l)\n\t\tlog_msg \"  Running 'kubectl get nodes' count is ${count} out of ${expected_nodes} expected...\"\n\t\tif [ \"$count\" -lt $expected_nodes ]; then\n\t\t\tlog_msg \"  [FAILED] kubectl get nodes reported less healthy nodes than expected\"\n\t\t\tkubectl get nodes\n\t\t\texit 1\n\t\tfi\n\tdone\n}\n\nfunction check_kube-dns() {\n\tlog_msg \"  Checking status of kube-dns pod...\"\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $3}')\n\tlog_msg \"  kube-dns pod status is ${output}\"\n\tif [[ $output != \"Running\" ]]; then\n\t\tlog_msg \"  [FAILED] kube-dns is not running in the cluster\"\n\t\texit 1\n\tfi\n\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $2}')\n\tlog_msg \"  expected kube-dns pod is ${output}\"\n\tif [[ $output != \"3/3\" ]]; then\n\t\tlog_msg \"  [FAILED] expected 3/3 kube-dns pods to be running in the cluster\"\n\t\texit 1\n\tfi\n}\n\nfunction check_nginx_deployment() {\n\tlog_msg \"  Checking an app deployment of nginx exposed as a service...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 2)\n\tkubectl run nginx --image=\"nginx\" --port=80 --replicas=${expected_nodes} 1>/dev/null\n\tkubectl expose deployment nginx --type NodePort 1>/dev/null\n\n\tnodePort=\"UNSET\"\n\tmax_tries=0\n\tuntil [ $nodePort != \"UNSET\" ] || [ $max_tries -eq 10 ]; do\n\t\tnodePort=$(kubectl get svc nginx --output=jsonpath='{range .spec.ports[0]}{.nodePort}')\n\t\tmax_tries=$((max_tries + 1))\n\tdone\n\n\tif [[ $nodePort == \"UNSET\" ]]; then\n\t\tlog_msg \"  [FAILED] could not retrieve the NodePort of the nginx service\"\n\t\texit 1\n\tfi\n\n\t# Avoid possible hang if port is not ready\n\tsleep 10\n    for i in {1..5}; do\n\t    for worker in $(echo ${CONTROLLER_IP},${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\t    output=$(curl --max-time 30 http://$worker:$nodePort 2>/dev/null)\n            if [[ -z \"$output\" ]]; then\n\t\t\t    log_msg \"   [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t\t    exit 1\n            fi\n\t\t    if [[ $output != *\"Welcome to nginx!\"* ]]; then\n\t\t\t    log_msg \"  [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t    \texit 1\n\t    \tfi\n    \tdone\n    done\n    kubectl delete deployment nginx 1>/dev/null\n}\n\nfunction print_success() {\n\tcat <<EOF\n\nThe Kubernetes cluster is up and appears to be healthy.\n$(kubectl cluster-info)\nEOF\n}\n\nlog_msg \"Running some basic checks on Kubernetes cluster....\"\ncheck_ssh_connectivity\ncheck_system_services\ncheck_k8s_healthz_through_lb\ncheck_get_nodes\ncheck_kube-dns\ncheck_nginx_deployment\n\nprint_success\n\nexit 0", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "4815551b-8fb0-4524-bfbd-84151b10fd90"}], "description": "", "name": "ed66499a_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "fc93ef5a_dag", "uuid": "1bf296de-0b89-4782-b940-852e47cb89f3"}, "message_list": [], "variable_list": [], "uuid": "916b787d-5eee-4d42-ac13-05a18265c9bf"}, "message_list": [], "name": "Test"}, {"description": "System action for creating an application", "type": "system", "uuid": "75489e48-3be2-465c-bb9c-f190cb69d0c2", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Centos", "uuid": "6b7aefbc-0cc7-40a7-879b-71e175dca4d2"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__DE_Provision_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "f2e3729e-cbf8-4ff0-971a-ed8be661c3e4"}, {"kind": "app_task", "name": "SYS_GEN__DE_Provision_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "cbddfbc7-2cca-4429-9534-b2689489f0be"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "a8589f03-ca46-4b3b-9828-407e487b7ba4"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "dfd3b01f-7b99-427e-8b8e-5e1f84b25f93"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d6aaad80-3adb-43a7-85da-50841e6126af"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "75f08f20-810c-4292-a550-3c3299403553"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "7166faf1-aa3c-4395-897c-6146315888f1"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "e8b147e7-fd86-4a06-acaf-fb3be12c51b9"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8975c20d-6ea9-4a09-a0b9-51984da13102"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "d54da871-3903-471a-abc0-b822c6f586fd"}], "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "7166faf1-aa3c-4395-897c-6146315888f1"}, "edge_type": "inherent", "type": "", "uuid": "7d1945e1-d4ca-4e3e-b79d-683db07f75b6", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8975c20d-6ea9-4a09-a0b9-51984da13102"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d6aaad80-3adb-43a7-85da-50841e6126af"}, "edge_type": "inherent", "type": "", "uuid": "5221a7e5-8438-4c08-a198-c60a36131112", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "7166faf1-aa3c-4395-897c-6146315888f1"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "f2e3729e-cbf8-4ff0-971a-ed8be661c3e4"}, "edge_type": "inherent", "type": "", "uuid": "73932c83-8215-4f70-9541-085394c91ce6", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "dfd3b01f-7b99-427e-8b8e-5e1f84b25f93"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "dfd3b01f-7b99-427e-8b8e-5e1f84b25f93"}, "edge_type": "inherent", "type": "", "uuid": "24c6f282-2998-44f6-85f2-dbb977464443", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d6aaad80-3adb-43a7-85da-50841e6126af"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "e8b147e7-fd86-4a06-acaf-fb3be12c51b9"}, "edge_type": "inherent", "type": "", "uuid": "d81217cb-f8c5-4880-b7c1-444dca4a3628", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "d54da871-3903-471a-abc0-b822c6f586fd"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "75f08f20-810c-4292-a550-3c3299403553"}, "edge_type": "inherent", "type": "", "uuid": "73032274-c79b-4260-9634-3b8ba2672e8f", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "e8b147e7-fd86-4a06-acaf-fb3be12c51b9"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "cbddfbc7-2cca-4429-9534-b2689489f0be"}, "edge_type": "inherent", "type": "", "uuid": "eedb5118-e847-4ecd-9cd7-b998eee1c8df", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "a8589f03-ca46-4b3b-9828-407e487b7ba4"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "a8589f03-ca46-4b3b-9828-407e487b7ba4"}, "edge_type": "inherent", "type": "", "uuid": "664d1351-ba3e-4637-8b2f-48bd4bda4326", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "75f08f20-810c-4292-a550-3c3299403553"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "a8589f03-ca46-4b3b-9828-407e487b7ba4"}, "edge_type": "dependency", "type": "", "uuid": "ffe9d98f-5952-46f4-b5f4-af0382704835", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d6aaad80-3adb-43a7-85da-50841e6126af"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "dfd3b01f-7b99-427e-8b8e-5e1f84b25f93"}, "edge_type": "dependency", "type": "", "uuid": "6788f3b6-f740-411c-87e4-c392e61a3e66", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "75f08f20-810c-4292-a550-3c3299403553"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "2557d3e8-8739-416c-8f60-b2fb5b6c5984"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "f2e3729e-cbf8-4ff0-971a-ed8be661c3e4"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "cbddfbc7-2cca-4429-9534-b2689489f0be"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "cfdab38b-b74c-437d-a6da-014d8e7d9600"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "a8589f03-ca46-4b3b-9828-407e487b7ba4"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "3be99ca4-d9b1-49f2-9c91-95650be3d84d"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "dfd3b01f-7b99-427e-8b8e-5e1f84b25f93"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "836f40c0-e00c-4e5a-ab61-6e8c8554c54b"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d6aaad80-3adb-43a7-85da-50841e6126af"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "c191cff3-2e12-4449-afde-c4e2872b9d47"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "75f08f20-810c-4292-a550-3c3299403553"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "39d74fe7_runbook", "uuid": "d28a648a-b9fd-4a6f-a2af-d05db381ae3a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "7166faf1-aa3c-4395-897c-6146315888f1"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "925ba7c0_runbook", "uuid": "ce426880-342a-4995-9d9c-c9dec8c586c4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "e8b147e7-fd86-4a06-acaf-fb3be12c51b9"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "8975c20d-6ea9-4a09-a0b9-51984da13102"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d54da871-3903-471a-abc0-b822c6f586fd"}], "description": "", "name": "SYS_GEN__Runbook_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "uuid": "2557d3e8-8739-416c-8f60-b2fb5b6c5984"}, "message_list": [], "variable_list": [], "uuid": "b8ffb5f1-8338-4dc3-a205-0e6471608f05"}, "message_list": [], "name": "action_create"}, {"description": "System action for starting an application", "type": "system", "uuid": "71bc6f66-6f4c-473e-84f0-a7b04dd70867", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Centos", "uuid": "6b7aefbc-0cc7-40a7-879b-71e175dca4d2"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "b0039d8c-e603-4f4c-9446-40c595c22037"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "1386a569-204a-49b5-8125-de797855389c"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "886409ae-9f47-450a-8ba5-41091720f529"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "4dc3b333-b036-4201-a423-f012299e05e0"}], "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "b0039d8c-e603-4f4c-9446-40c595c22037"}, "edge_type": "inherent", "type": "", "uuid": "7c6ae256-2faa-4270-b63d-2db5beafdf8b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "886409ae-9f47-450a-8ba5-41091720f529"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "1386a569-204a-49b5-8125-de797855389c"}, "edge_type": "inherent", "type": "", "uuid": "7cc796fc-5d79-4030-b97b-560b4cabaec6", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "4dc3b333-b036-4201-a423-f012299e05e0"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a4736d86-b3ce-444f-935d-9268ff3ac8ca"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "cb021452-5a34-4e77-aea5-39f448d78160"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "b0039d8c-e603-4f4c-9446-40c595c22037"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "3724ade2-498b-4615-9de1-94204d9f285e"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "1386a569-204a-49b5-8125-de797855389c"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "886409ae-9f47-450a-8ba5-41091720f529"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "4dc3b333-b036-4201-a423-f012299e05e0"}], "description": "", "name": "SYS_GEN__Runbook_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "uuid": "a4736d86-b3ce-444f-935d-9268ff3ac8ca"}, "message_list": [], "variable_list": [], "uuid": "ce1ba68e-f45b-4274-ab5b-bd9c7a704946"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "45d14ba4-d8d2-4fa9-92ef-c7c0e141cc95", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Centos", "uuid": "6b7aefbc-0cc7-40a7-879b-71e175dca4d2"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "d16bd056-dffd-4132-8948-5f88c147e465"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "612c159a-fb7f-4f84-87e2-529e6f509fb3"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "a3f7b2ae-3f3d-44a8-b9c1-74714edb80e8"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "479f4b07-c244-42ec-ab1b-884caf46cfc1"}], "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "d16bd056-dffd-4132-8948-5f88c147e465"}, "edge_type": "inherent", "type": "", "uuid": "c4df42c1-6c46-4646-ab6d-4a3c9c63e245", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "a3f7b2ae-3f3d-44a8-b9c1-74714edb80e8"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "612c159a-fb7f-4f84-87e2-529e6f509fb3"}, "edge_type": "inherent", "type": "", "uuid": "bcc3af17-6f44-44b6-8513-e3cb00d2fef9", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "479f4b07-c244-42ec-ab1b-884caf46cfc1"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "923f71ae-3a02-4807-85ce-716f2bdae057"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d16bd056-dffd-4132-8948-5f88c147e465"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "612c159a-fb7f-4f84-87e2-529e6f509fb3"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "f9d4337c-75c3-4c91-9cf2-852712ecdc61"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "a3f7b2ae-3f3d-44a8-b9c1-74714edb80e8"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "7a22b3d2-0e89-48ee-b513-c6cb909d40d0"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "479f4b07-c244-42ec-ab1b-884caf46cfc1"}], "description": "", "name": "SYS_GEN__Runbook_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "uuid": "923f71ae-3a02-4807-85ce-716f2bdae057"}, "message_list": [], "variable_list": [], "uuid": "b13d1cf8-61cb-4ae4-85ec-3a9928afd26f"}, "message_list": [], "name": "action_stop"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "ff5def3b-7b64-4ed7-badb-38348e44f1fe", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Centos", "uuid": "6b7aefbc-0cc7-40a7-879b-71e175dca4d2"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "d0a8bf2d-c072-41c5-8a5d-284e6900f2ce"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "a2d76f17-844e-45dd-8277-d40f3958c925"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8d5f91f4-d4fd-4c07-8917-d32309904e49"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "10077c37-be67-46ea-8e17-3e27f048151f"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "d94a060e-c6b0-4c15-a85c-f3042d1ddff6"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d3963155-ff29-40d2-ab6a-b1280e7cbc82"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "150286d2-70dc-4bf6-8cbb-89d9aa2fd9c7"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "16936a14-52f9-427e-8fbd-d8e1308ef44e"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "9fe33f11-bafb-4d03-ba33-198e71e98863"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "8ff39ede-0b61-4109-8788-21b95227746b"}], "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "a2d76f17-844e-45dd-8277-d40f3958c925"}, "edge_type": "inherent", "type": "", "uuid": "bbca3e8b-ca64-48c4-bc9f-8020383abce7", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "10077c37-be67-46ea-8e17-3e27f048151f"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "10077c37-be67-46ea-8e17-3e27f048151f"}, "edge_type": "inherent", "type": "", "uuid": "03c6f386-cac5-46e9-86a7-09429a1d8532", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d3963155-ff29-40d2-ab6a-b1280e7cbc82"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "16936a14-52f9-427e-8fbd-d8e1308ef44e"}, "edge_type": "inherent", "type": "", "uuid": "c3982d4e-5fc9-482e-b511-6d5921cdd8be", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "8ff39ede-0b61-4109-8788-21b95227746b"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d3963155-ff29-40d2-ab6a-b1280e7cbc82"}, "edge_type": "inherent", "type": "", "uuid": "1c443021-e691-413b-a2a2-99a8bd20584f", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "16936a14-52f9-427e-8fbd-d8e1308ef44e"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "d0a8bf2d-c072-41c5-8a5d-284e6900f2ce"}, "edge_type": "inherent", "type": "", "uuid": "1e28723e-56fc-48fc-83f7-6841ecf91fa5", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8d5f91f4-d4fd-4c07-8917-d32309904e49"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8d5f91f4-d4fd-4c07-8917-d32309904e49"}, "edge_type": "inherent", "type": "", "uuid": "7502a333-ebdc-46d8-9031-878f157395f3", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "d94a060e-c6b0-4c15-a85c-f3042d1ddff6"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "150286d2-70dc-4bf6-8cbb-89d9aa2fd9c7"}, "edge_type": "inherent", "type": "", "uuid": "c9f156f8-d785-4b9a-8512-a90a9a04f6e2", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "9fe33f11-bafb-4d03-ba33-198e71e98863"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "d94a060e-c6b0-4c15-a85c-f3042d1ddff6"}, "edge_type": "inherent", "type": "", "uuid": "fa627b2c-03ec-4c9a-8df0-44190bffbe23", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "150286d2-70dc-4bf6-8cbb-89d9aa2fd9c7"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "d3963155-ff29-40d2-ab6a-b1280e7cbc82"}, "edge_type": "create_action_edge", "type": "", "uuid": "55afbf65-32f6-4333-9b77-2362050b16e9", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "150286d2-70dc-4bf6-8cbb-89d9aa2fd9c7"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "d94a060e-c6b0-4c15-a85c-f3042d1ddff6"}, "edge_type": "create_action_edge", "type": "", "uuid": "b0c3918b-37a2-4ef1-8f74-5f299f48b000", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "16936a14-52f9-427e-8fbd-d8e1308ef44e"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e6894acb-06eb-43ea-bdce-0343a51740f3"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d0a8bf2d-c072-41c5-8a5d-284e6900f2ce"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "a2d76f17-844e-45dd-8277-d40f3958c925"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "28e74b96_runbook", "uuid": "0ab86c44-ee03-4d60-ae33-3bc75165ee6a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "8d5f91f4-d4fd-4c07-8917-d32309904e49"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "b00241d6_runbook", "uuid": "a5999398-fee7-49e7-8af2-7c82fe537838"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "10077c37-be67-46ea-8e17-3e27f048151f"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "04b54e48-af42-449f-8530-e718b7d0f383"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d94a060e-c6b0-4c15-a85c-f3042d1ddff6"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "54a21e6d-8912-4e49-a0b8-31a11f87ca0f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d3963155-ff29-40d2-ab6a-b1280e7cbc82"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "19824998-1e56-4738-9111-2b55c2f85a7b"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "150286d2-70dc-4bf6-8cbb-89d9aa2fd9c7"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "84a21642-2518-409e-bcaa-81ef0d89ee5d"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "16936a14-52f9-427e-8fbd-d8e1308ef44e"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "9fe33f11-bafb-4d03-ba33-198e71e98863"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "8ff39ede-0b61-4109-8788-21b95227746b"}], "description": "", "name": "SYS_GEN__Runbook_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "uuid": "e6894acb-06eb-43ea-bdce-0343a51740f3"}, "message_list": [], "variable_list": [], "uuid": "789461de-c38e-4329-a47a-5ae2cc8057ea"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "f4f8e392-47c1-4393-b407-b161ad45f15f", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Centos", "uuid": "6b7aefbc-0cc7-40a7-879b-71e175dca4d2"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "bac6d2ed-9fc5-46b4-909e-4da128ce770b"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "669c42de-b91b-426e-af6a-58f467ad52af"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "4f68c7c6-a039-4929-9ef4-207239e503f0"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "1eef5365-84af-4e66-8100-e3f51029e817"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "e358dc98-fb5a-4842-8e88-92b7173a159e"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "988791b3-2d48-4d41-83cb-3a9ac11d3a44"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "63d98b71-90ab-476e-978d-f408272cb8c9"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "4ce43eb6-038e-43f0-b1a6-06d7fce3fdf8"}], "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "bac6d2ed-9fc5-46b4-909e-4da128ce770b"}, "edge_type": "inherent", "type": "", "uuid": "8c7caa64-4c57-4a41-9517-f0dbbb95acc9", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "4f68c7c6-a039-4929-9ef4-207239e503f0"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "e358dc98-fb5a-4842-8e88-92b7173a159e"}, "edge_type": "inherent", "type": "", "uuid": "bafa9c8e-3c61-45f2-a7ae-12911804384c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "uuid": "63d98b71-90ab-476e-978d-f408272cb8c9"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "4f68c7c6-a039-4929-9ef4-207239e503f0"}, "edge_type": "inherent", "type": "", "uuid": "d6515017-b596-4b5b-977a-5e0cce8c5839", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "e358dc98-fb5a-4842-8e88-92b7173a159e"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "669c42de-b91b-426e-af6a-58f467ad52af"}, "edge_type": "inherent", "type": "", "uuid": "b0c1e294-bf70-4f58-9ce2-69db35db822a", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "1eef5365-84af-4e66-8100-e3f51029e817"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "988791b3-2d48-4d41-83cb-3a9ac11d3a44"}, "edge_type": "inherent", "type": "", "uuid": "2420281e-e601-4442-a309-0c5d2fc9b0b5", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "uuid": "4ce43eb6-038e-43f0-b1a6-06d7fce3fdf8"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "1eef5365-84af-4e66-8100-e3f51029e817"}, "edge_type": "inherent", "type": "", "uuid": "406e42ba-ddcc-44a7-b982-656f7fc3ef06", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "988791b3-2d48-4d41-83cb-3a9ac11d3a44"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "4f68c7c6-a039-4929-9ef4-207239e503f0"}, "edge_type": "create_action_edge", "type": "", "uuid": "a225d207-d442-4890-b37d-850111cfd94b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "988791b3-2d48-4d41-83cb-3a9ac11d3a44"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "1eef5365-84af-4e66-8100-e3f51029e817"}, "edge_type": "create_action_edge", "type": "", "uuid": "6d1ddc3a-1dbe-4855-977b-f69f27351bfb", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "e358dc98-fb5a-4842-8e88-92b7173a159e"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "ad24022b-6b66-4bb1-a819-8bb222082b25"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "59a30bab-b0f4-4159-82ca-96708920121f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "bac6d2ed-9fc5-46b4-909e-4da128ce770b"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8bf1f321-c96c-485d-bf06-13a230fc1e23"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "669c42de-b91b-426e-af6a-58f467ad52af"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "4f68c7c6-a039-4929-9ef4-207239e503f0"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "1eef5365-84af-4e66-8100-e3f51029e817"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos", "uuid": "5816faaf-e798-4c33-be99-f4d9f9bbd9f0"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_5816faaf_e798_4c33_be99_f4d9f9bbd9f0", "uuid": "117187f5-fffd-4889-81c4-3feeac5b283a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "e358dc98-fb5a-4842-8e88-92b7173a159e"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos", "uuid": "772492f7-1143-48c2-b270-5dad46e6d15c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_772492f7_1143_48c2_b270_5dad46e6d15c", "uuid": "c5b7466c-c856-403b-9cf6-7c9252720608"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "988791b3-2d48-4d41-83cb-3a9ac11d3a44"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "7e23eb76_deployment", "uuid": "a1b7a4e1-e920-4a52-aa66-8d4e03b2a6d7"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_a1b7a4e1_e920_4a52_aa66_8d4e03b2a6d7", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "63d98b71-90ab-476e-978d-f408272cb8c9"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "0fd632f7_deployment", "uuid": "a5d10ad4-3fb5-4553-a1c2-13996a86a6ae"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_a5d10ad4_3fb5_4553_a1c2_13996a86a6ae", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "4ce43eb6-038e-43f0-b1a6-06d7fce3fdf8"}], "description": "", "name": "SYS_GEN__Runbook_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_6b7aefbc_0cc7_40a7_879b_71e175dca4d2", "uuid": "ad24022b-6b66-4bb1-a819-8bb222082b25"}, "message_list": [], "variable_list": [], "uuid": "94a175de-87b4-4f91-baf8-b19ce8b82b5c"}, "message_list": [], "name": "action_soft_delete"}], "name": "Centos", "state": "ACTIVE", "message_list": [], "dependency_list": [{"getter_resource_kind": "PackageCfg", "setter_resource_attr": "address", "setter_resource_kind": "SubstrateCfg", "setter_resource_name": "K8SM_Centos", "action_name": "action_create", "action_resource_name": "Centos", "getter_resource_name": "K8SCP", "action_resource_kind": "ApplicationCfg"}, {"getter_resource_kind": "PackageCfg", "setter_resource_attr": "address", "setter_resource_kind": "SubstrateCfg", "setter_resource_name": "K8SC_Centos", "action_name": "action_create", "action_resource_name": "Centos", "getter_resource_name": "K8SMP", "action_resource_kind": "ApplicationCfg"}], "variable_list": [{"val_type": "STRING", "description": "", "name": "KUBELET_IMAGE_TAG", "type": "LOCAL", "value": "v1.7.10_coreos.0", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "f5cac64b-1bb9-48d7-a08a-b01e680ce719"}, {"val_type": "STRING", "description": "", "name": "CLUSTER_SUBNET", "type": "LOCAL", "value": "10.200.0.0/16", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "ec2807a1-0ae2-42a2-b33d-a8b6a84edd0a"}, {"val_type": "STRING", "description": "", "name": "SERVICE_SUBNET", "type": "LOCAL", "value": "10.32.0.0/24", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "240da046-3de6-41a7-adf1-d393b3c7dd82"}, {"val_type": "STRING", "description": "", "name": "KUBE_CLUSTER_DNS", "type": "LOCAL", "value": "10.32.0.10", "label": "", "state": "ACTIVE", "attrs": {}, "editables": {"value": true}, "message_list": [], "uuid": "e7bbf774-0466-4422-8bb2-9bcc97e36a04"}, {"val_type": "STRING", "description": "", "name": "PRISM_CLUSTER_IP", "type": "LOCAL", "value": "10.5.67.138", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "8e4d517e-edf5-4239-a6ba-8d0b54c28c43"}, {"val_type": "STRING", "description": "", "name": "PRISM_DATA_SERVICE_IP", "type": "LOCAL", "value": "10.5.67.143", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "f7fb920b-99f8-4e8d-89b3-105847ef738d"}, {"val_type": "STRING", "description": "", "name": "PRISM_USERNAME", "type": "LOCAL", "value": "admin", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "a54457bf-1679-4895-832c-86d3583fef59"}, {"val_type": "STRING", "description": "", "name": "PRISM_PASSWORD", "type": "SECRET", "value": "", "label": "", "state": "ACTIVE", "attrs": {"is_secret_modified": false, "secret_reference": {"uuid": "3d39d8b1-27f2-4bbe-9054-d68897f9acf3"}, "type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "88063a64-7507-49ac-b663-4522f93cbd3e"}, {"val_type": "STRING", "description": "", "name": "CONTAINER_NAME", "type": "LOCAL", "value": "default-container-43360047467620", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "d4ef499e-2a18-4e56-a808-7850cf37e4a6"}, {"val_type": "STRING", "description": "", "name": "INSTANCE_PUBLIC_KEY", "type": "LOCAL", "value": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS/K0Mb/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf/i9QMJ5/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "502d46e6-d7d3-45dd-a78c-18b6f5eb43a2"}], "uuid": "6b7aefbc-0cc7-40a7-879b-71e175dca4d2"}, {"deployment_create_list": [{"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "d642164d-ddd6-4040-b63a-060690ed2b44", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__DE_Provision_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "c83f10a3-d4e0-4700-85b4-64b8725234fc"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "05bd00b8-300b-4e6e-985f-078db813f710"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "cb9aea3f-255c-4639-8fa6-672e3cc3c479"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "eaa86b4e-2806-4edc-9bee-378f3629ba56"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9c7e5be4-0637-4567-934d-c109734bb7a7"}], "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "eaa86b4e-2806-4edc-9bee-378f3629ba56"}, "edge_type": "inherent", "type": "", "uuid": "ed46695d-ac83-4534-98f2-b66d540ac33d", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9c7e5be4-0637-4567-934d-c109734bb7a7"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "cb9aea3f-255c-4639-8fa6-672e3cc3c479"}, "edge_type": "inherent", "type": "", "uuid": "ea023391-fb74-45b7-af36-6cbf429d4ba3", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "eaa86b4e-2806-4edc-9bee-378f3629ba56"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "c83f10a3-d4e0-4700-85b4-64b8725234fc"}, "edge_type": "inherent", "type": "", "uuid": "de682d39-dca8-4a58-8280-d152a9eda66e", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "05bd00b8-300b-4e6e-985f-078db813f710"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "05bd00b8-300b-4e6e-985f-078db813f710"}, "edge_type": "inherent", "type": "", "uuid": "14aae2e3-351a-4c89-8cba-3c80a580d91e", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "cb9aea3f-255c-4639-8fa6-672e3cc3c479"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e8039232-f79b-49e9-8f6b-11aa00a1fa17"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "c83f10a3-d4e0-4700-85b4-64b8725234fc"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "164954b6-f172-454f-b438-88d39f52e998"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "05bd00b8-300b-4e6e-985f-078db813f710"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "3a91e88c-4019-4064-b80d-651c8c6d9d1a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "cb9aea3f-255c-4639-8fa6-672e3cc3c479"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "39d74fe7_runbook", "uuid": "d28a648a-b9fd-4a6f-a2af-d05db381ae3a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "eaa86b4e-2806-4edc-9bee-378f3629ba56"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "9c7e5be4-0637-4567-934d-c109734bb7a7"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "e8039232-f79b-49e9-8f6b-11aa00a1fa17"}, "message_list": [], "variable_list": [], "uuid": "7969dbda-c140-4f4c-902e-564df67fb453"}, "message_list": [], "name": "action_create"}, {"description": "System action for starting an application", "type": "system", "uuid": "098d940c-c5d8-476a-b63b-82013f49a51d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "c9412461-0c02-4566-a5ba-a548caf45078"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "205b13a5-6333-4b9b-9f80-2d5580bdd266"}], "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "c9412461-0c02-4566-a5ba-a548caf45078"}, "edge_type": "inherent", "type": "", "uuid": "657482e8-ce20-45f5-a7dc-70a6d7e644da", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "205b13a5-6333-4b9b-9f80-2d5580bdd266"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "0056e806-5c1a-45da-a63e-4b697621ece3"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "fda6dc44-6df2-4e0f-8cd5-483e317bb165"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "c9412461-0c02-4566-a5ba-a548caf45078"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "205b13a5-6333-4b9b-9f80-2d5580bdd266"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "0056e806-5c1a-45da-a63e-4b697621ece3"}, "message_list": [], "variable_list": [], "uuid": "3763a255-3502-41b4-919c-fd482e5cd10c"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "7b3c768a-567a-4441-8ad2-97fe523db1c8", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "083ac9a9-32db-4a0e-82ee-a2bfbf9559a5"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "d699acbf-bf21-43dc-b426-e87087a63d9b"}], "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "083ac9a9-32db-4a0e-82ee-a2bfbf9559a5"}, "edge_type": "inherent", "type": "", "uuid": "710b6aad-d14a-4997-9db9-9dd863d50676", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "d699acbf-bf21-43dc-b426-e87087a63d9b"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "6f984fb0-0dbc-4021-8200-d473dde3d116"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "083ac9a9-32db-4a0e-82ee-a2bfbf9559a5"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "3f997f3d-efc8-49e5-a2ac-5f3f3a8ca120"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d699acbf-bf21-43dc-b426-e87087a63d9b"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "6f984fb0-0dbc-4021-8200-d473dde3d116"}, "message_list": [], "variable_list": [], "uuid": "cb61a5ca-97b3-413a-8471-de6f32ca90d9"}, "message_list": [], "name": "action_stop"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "30141e58-69b3-4f27-b22e-3d8a2d2160bd", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "82dde5f3-915a-4d2d-b6d6-a2873e9e9af2"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "782ebbe3-92de-42b6-b2e6-048f580d0a8e"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "878ba5b0-1b41-4d81-8622-b568e21436f8"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "49cb4d70-a8d8-4d8d-a545-85d8311254cf"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "fc2e898d-7e08-4b19-b1ae-1e357dc2f364"}], "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "82dde5f3-915a-4d2d-b6d6-a2873e9e9af2"}, "edge_type": "inherent", "type": "", "uuid": "feccae05-8229-4143-8390-401b015bf5c1", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "782ebbe3-92de-42b6-b2e6-048f580d0a8e"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "782ebbe3-92de-42b6-b2e6-048f580d0a8e"}, "edge_type": "inherent", "type": "", "uuid": "3d59241e-5f52-4833-a363-d4d3370d73fd", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "878ba5b0-1b41-4d81-8622-b568e21436f8"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "878ba5b0-1b41-4d81-8622-b568e21436f8"}, "edge_type": "inherent", "type": "", "uuid": "455e3068-ffd0-4f8b-9b05-12f18c8e8ebd", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "49cb4d70-a8d8-4d8d-a545-85d8311254cf"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "49cb4d70-a8d8-4d8d-a545-85d8311254cf"}, "edge_type": "inherent", "type": "", "uuid": "dfa57f00-a8b9-407c-adb9-eb4ebec09234", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "fc2e898d-7e08-4b19-b1ae-1e357dc2f364"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "1963a32a-b396-469a-8655-a3c820817baa"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "82dde5f3-915a-4d2d-b6d6-a2873e9e9af2"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "b00241d6_runbook", "uuid": "a5999398-fee7-49e7-8af2-7c82fe537838"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "782ebbe3-92de-42b6-b2e6-048f580d0a8e"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "1d149726-7bc4-4e02-945e-660f990e1ed3"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "878ba5b0-1b41-4d81-8622-b568e21436f8"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "1db390cb-e26a-492c-94ff-f476e8f7466f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "49cb4d70-a8d8-4d8d-a545-85d8311254cf"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "fc2e898d-7e08-4b19-b1ae-1e357dc2f364"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "1963a32a-b396-469a-8655-a3c820817baa"}, "message_list": [], "variable_list": [], "uuid": "499e628d-2682-462b-bbff-b7e3685dcd73"}, "message_list": [], "name": "action_delete"}, {"description": "System action for scaleout", "type": "system", "uuid": "e575d68e-8b2e-4cbf-92be-b085b098f585", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scaleout_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "9927d003-14e6-4416-892b-c0caadac7617"}], "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "630771b8-73d4-48ac-9746-97b49c2e348b"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scaleout_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEOUT"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "9927d003-14e6-4416-892b-c0caadac7617"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "630771b8-73d4-48ac-9746-97b49c2e348b"}, "message_list": [], "variable_list": [], "uuid": "c7b05f9c-50fe-4599-9429-26244276a567"}, "message_list": [], "name": "action_scaleout"}, {"description": "System action for scalein", "type": "system", "uuid": "db4f1a44-52fa-46a2-a181-9c0ac3009730", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scalein_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "baf226e4-9f3c-4047-be1b-4ebc8c9abdeb"}], "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e7cd56be-6c14-4ded-ae63-c9318543c680"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scalein_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEIN"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "baf226e4-9f3c-4047-be1b-4ebc8c9abdeb"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "e7cd56be-6c14-4ded-ae63-c9318543c680"}, "message_list": [], "variable_list": [], "uuid": "25ab6d89-c5f4-463c-b656-968fbcd18119"}, "message_list": [], "name": "action_scalein"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "26078cb9-c4bb-4b6c-a35e-52bdda1dc008", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "1855f8ba-af3b-4995-97d0-b3188c994c82"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "10a5bafe-609a-477b-a678-51887c461fec"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "aa174293-eea2-4261-a959-0cab811b79a3"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "41cd192e-e2ab-41ee-9110-6ea987a0f37d"}], "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "1855f8ba-af3b-4995-97d0-b3188c994c82"}, "edge_type": "inherent", "type": "", "uuid": "c981b7fd-f305-4ac0-9922-f9bbfe227589", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "10a5bafe-609a-477b-a678-51887c461fec"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "aa174293-eea2-4261-a959-0cab811b79a3"}, "edge_type": "inherent", "type": "", "uuid": "71d2a914-dab4-4bf8-9743-3ab607be40cf", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "41cd192e-e2ab-41ee-9110-6ea987a0f37d"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "10a5bafe-609a-477b-a678-51887c461fec"}, "edge_type": "inherent", "type": "", "uuid": "c554b480-66f3-4538-887f-69dd7ee75e86", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "aa174293-eea2-4261-a959-0cab811b79a3"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "7b02a14a-aad3-453e-bf16-a21602b8a7bd"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "59a30bab-b0f4-4159-82ca-96708920121f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "1855f8ba-af3b-4995-97d0-b3188c994c82"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "10a5bafe-609a-477b-a678-51887c461fec"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "cd9ff04f-74f4-4942-ab25-1b4f982abaec"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "aa174293-eea2-4261-a959-0cab811b79a3"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "41cd192e-e2ab-41ee-9110-6ea987a0f37d"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "7b02a14a-aad3-453e-bf16-a21602b8a7bd"}, "message_list": [], "variable_list": [], "uuid": "989d8cab-fefa-4fd4-b29c-8dccc5443378"}, "message_list": [], "name": "action_soft_delete"}], "message_list": [], "editables": {"min_replicas": true}, "name": "8d3d1287_deployment", "state": "ACTIVE", "max_replicas": "3", "package_local_reference_list": [{"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}], "substrate_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "min_replicas": "3", "variable_list": [], "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, {"description": "", "action_list": [{"description": "System action for creating an application", "type": "system", "uuid": "1304a599-5d1f-48bf-b3a0-b312bcb078c3", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__DE_Provision_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "246498a9-ca8c-4c38-a6c8-39c5699f3cd4"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "3309894d-0072-47b5-b2bf-16408f83c22d"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "dc3484ce-acab-4fcf-8792-2925fe85348a"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6870925f-5d31-4b11-8bca-eab5545ced4f"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "3c04f6d1-4305-4569-b7f9-ac026738be55"}], "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6870925f-5d31-4b11-8bca-eab5545ced4f"}, "edge_type": "inherent", "type": "", "uuid": "ea97cc4b-40c2-4233-8cf2-f9b2681b8cc5", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "3c04f6d1-4305-4569-b7f9-ac026738be55"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "dc3484ce-acab-4fcf-8792-2925fe85348a"}, "edge_type": "inherent", "type": "", "uuid": "c1b97670-4c39-4e44-b5ed-a4448af5e83d", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6870925f-5d31-4b11-8bca-eab5545ced4f"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "246498a9-ca8c-4c38-a6c8-39c5699f3cd4"}, "edge_type": "inherent", "type": "", "uuid": "ee93dad2-b73e-49dd-9497-9269831d941b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "3309894d-0072-47b5-b2bf-16408f83c22d"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "3309894d-0072-47b5-b2bf-16408f83c22d"}, "edge_type": "inherent", "type": "", "uuid": "9d45957a-2ca0-4502-b7f3-1fa10447d986", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "dc3484ce-acab-4fcf-8792-2925fe85348a"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "17a7d389-d2ee-40c8-8326-4bbea8048b1a"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "246498a9-ca8c-4c38-a6c8-39c5699f3cd4"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "1529baa8-9f32-4055-b130-d28613358c89"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "3309894d-0072-47b5-b2bf-16408f83c22d"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "068deee7-3280-438b-9312-9df00bddd019"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "dc3484ce-acab-4fcf-8792-2925fe85348a"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "925ba7c0_runbook", "uuid": "ce426880-342a-4995-9d9c-c9dec8c586c4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "6870925f-5d31-4b11-8bca-eab5545ced4f"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "3c04f6d1-4305-4569-b7f9-ac026738be55"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "17a7d389-d2ee-40c8-8326-4bbea8048b1a"}, "message_list": [], "variable_list": [], "uuid": "fa491fff-0a84-4753-bc0b-9570644fccc2"}, "message_list": [], "name": "action_create"}, {"description": "System action for starting an application", "type": "system", "uuid": "0b528f87-7cb2-4b2e-96dd-b39805770ef6", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "82fe74dc-6a42-41ed-ae51-f3dfe33cc4d5"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "ca11ff20-ba27-45b4-8f32-87b58aa6bfb7"}], "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "82fe74dc-6a42-41ed-ae51-f3dfe33cc4d5"}, "edge_type": "inherent", "type": "", "uuid": "0b4bbbf2-2764-4a07-9ed1-36f6431a2c8d", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "ca11ff20-ba27-45b4-8f32-87b58aa6bfb7"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "32dc5963-27db-46cc-983c-1a52d5ea2965"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "dc8da279-ebd9-46c3-8bb9-8a76f6f3df1c"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "82fe74dc-6a42-41ed-ae51-f3dfe33cc4d5"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "ca11ff20-ba27-45b4-8f32-87b58aa6bfb7"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "32dc5963-27db-46cc-983c-1a52d5ea2965"}, "message_list": [], "variable_list": [], "uuid": "4f3cadcb-49bd-409e-bc5b-763529625984"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "534f0ca5-5348-495e-a3bc-8aeafcf5824f", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "2efcddae-22ba-4d38-a16d-4b10c6156824"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "d4ef6cb1-5637-495b-81a0-339db4ac89f5"}], "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "2efcddae-22ba-4d38-a16d-4b10c6156824"}, "edge_type": "inherent", "type": "", "uuid": "46979f98-1299-47c0-9c50-2d6cfc0eb495", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "d4ef6cb1-5637-495b-81a0-339db4ac89f5"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "b0b2ca55-a885-49ad-9cba-59630566306b"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "2efcddae-22ba-4d38-a16d-4b10c6156824"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "2dde39fa-2790-4436-b897-584ad08bb3ab"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d4ef6cb1-5637-495b-81a0-339db4ac89f5"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "b0b2ca55-a885-49ad-9cba-59630566306b"}, "message_list": [], "variable_list": [], "uuid": "ccbc7ec2-e6c6-4125-a4e6-3b1c5e374db3"}, "message_list": [], "name": "action_stop"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "6b7f9562-30de-4458-a5f0-886c965254f5", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "e1336089-0f9c-47f0-abb1-1f9fef258b4d"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "669f8bfc-7d65-463b-a6f4-6fcb243dc922"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "f8599045-1c9d-4e94-89ec-dd97bea55154"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "5846e015-03c5-41ab-b5a4-2b24794e4b44"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "3c41a942-7d5b-40c5-946b-502585a30bd5"}], "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "e1336089-0f9c-47f0-abb1-1f9fef258b4d"}, "edge_type": "inherent", "type": "", "uuid": "01ac3cd1-ec7d-4ae3-8b46-1c715feda7c9", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "669f8bfc-7d65-463b-a6f4-6fcb243dc922"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "669f8bfc-7d65-463b-a6f4-6fcb243dc922"}, "edge_type": "inherent", "type": "", "uuid": "00962e9e-990f-43a7-a312-f918c9cf15a2", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "f8599045-1c9d-4e94-89ec-dd97bea55154"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "5846e015-03c5-41ab-b5a4-2b24794e4b44"}, "edge_type": "inherent", "type": "", "uuid": "5913ffe0-77ab-4e55-b20c-12740a26ba35", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "3c41a942-7d5b-40c5-946b-502585a30bd5"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "f8599045-1c9d-4e94-89ec-dd97bea55154"}, "edge_type": "inherent", "type": "", "uuid": "f45282d1-27f2-4569-8ef0-d5ff85f9a1a8", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "5846e015-03c5-41ab-b5a4-2b24794e4b44"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "606aa632-be33-43da-9360-3709657f47a8"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "e1336089-0f9c-47f0-abb1-1f9fef258b4d"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "28e74b96_runbook", "uuid": "0ab86c44-ee03-4d60-ae33-3bc75165ee6a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "669f8bfc-7d65-463b-a6f4-6fcb243dc922"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "a0355c2c-8ce9-44eb-84c7-ec6b92061b15"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "f8599045-1c9d-4e94-89ec-dd97bea55154"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "cf4bb8ca-2d92-44a4-a11b-8945d5289200"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "5846e015-03c5-41ab-b5a4-2b24794e4b44"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "3c41a942-7d5b-40c5-946b-502585a30bd5"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "606aa632-be33-43da-9360-3709657f47a8"}, "message_list": [], "variable_list": [], "uuid": "416970aa-ac6d-4ee8-9713-ce3a48c69eab"}, "message_list": [], "name": "action_delete"}, {"description": "System action for scaleout", "type": "system", "uuid": "b1779625-79c6-4e36-a17a-cdd52dd88197", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scaleout_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "03a203f2-129d-4663-a6d4-ae3595fabdf2"}], "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "fabdfb9d-4150-4080-98b9-399bf041263a"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scaleout_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEOUT"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "03a203f2-129d-4663-a6d4-ae3595fabdf2"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "fabdfb9d-4150-4080-98b9-399bf041263a"}, "message_list": [], "variable_list": [], "uuid": "0cadf2bf-6457-4850-8a24-9daa13f1cb01"}, "message_list": [], "name": "action_scaleout"}, {"description": "System action for scalein", "type": "system", "uuid": "e4a11910-78b4-4fda-a967-66fd6a29133d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__Deployment_Scalein_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "fe35df82-0bed-4f2a-9608-106019a655db"}], "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "df930a34-e184-4c7b-a534-7bc1957a2066"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Deployment_Scalein_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"scaling_count": "@@{scaling_count}@@", "type": "", "scaling_type": "SCALEIN"}, "timeout_secs": "", "type": "SCALING", "variable_list": [], "uuid": "fe35df82-0bed-4f2a-9608-106019a655db"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "df930a34-e184-4c7b-a534-7bc1957a2066"}, "message_list": [], "variable_list": [], "uuid": "de075ae0-0aef-4d53-b612-408633653fe9"}, "message_list": [], "name": "action_scalein"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "817b71f0-5f4d-4b83-abfd-15b0bceb63b2", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "865c8ece-9832-4e75-960f-f9610c517293"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "e0445d25-57ec-4dff-b8d2-0cbe9cdd88a6"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "b43915e3-e63f-4173-af21-10a3bc5b3f46"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "1fe61e5e-0aaa-484e-969f-da38ddb64643"}], "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "865c8ece-9832-4e75-960f-f9610c517293"}, "edge_type": "inherent", "type": "", "uuid": "cb3c0f70-a402-4bb9-aa25-9b48b7a53ff5", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "e0445d25-57ec-4dff-b8d2-0cbe9cdd88a6"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "b43915e3-e63f-4173-af21-10a3bc5b3f46"}, "edge_type": "inherent", "type": "", "uuid": "aa3a23ed-4f2b-459c-acf5-33de0ebb6181", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "1fe61e5e-0aaa-484e-969f-da38ddb64643"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "e0445d25-57ec-4dff-b8d2-0cbe9cdd88a6"}, "edge_type": "inherent", "type": "", "uuid": "bcaba498-d58b-41ab-82bc-0a356fdfa489", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "b43915e3-e63f-4173-af21-10a3bc5b3f46"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "72e88a1f-1632-42fd-8177-b05d22eb3d9a"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8bf1f321-c96c-485d-bf06-13a230fc1e23"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "865c8ece-9832-4e75-960f-f9610c517293"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "e0445d25-57ec-4dff-b8d2-0cbe9cdd88a6"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "5549ebeb-99d4-4d05-8bbd-8532092f0db0"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "b43915e3-e63f-4173-af21-10a3bc5b3f46"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "1fe61e5e-0aaa-484e-969f-da38ddb64643"}], "description": "", "name": "SYS_GEN__Runbook_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Deployment_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "72e88a1f-1632-42fd-8177-b05d22eb3d9a"}, "message_list": [], "variable_list": [], "uuid": "4b20bb0f-be1d-4397-96f9-c34ef57c41aa"}, "message_list": [], "name": "action_soft_delete"}], "message_list": [], "editables": {"min_replicas": true}, "name": "37f2422f_deployment", "state": "ACTIVE", "max_replicas": "2", "package_local_reference_list": [{"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}], "substrate_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "min_replicas": "2", "variable_list": [], "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}], "description": "", "action_list": [{"description": "", "type": "user", "uuid": "c4fe10c2-6de5-46c6-ac82-d972c776b60b", "state": "ACTIVE", "critical": false, "attrs": {}, "runbook": {"task_definition_list": [{"description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Test", "uuid": "1b74879f-8d2e-45d9-a08b-6348aa68e71b"}], "name": "7a4e4568_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "43afc077-3c35-41d9-9a97-5c37544b0cb4"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "Test", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\n\nexport PATH=$PATH:/opt/bin\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nCONTROLLER_IP=\"@@{calm_array_address}@@\"\nWORKER_IP=\"@@{K8SM_Core.address}@@\"\nMASTER_IP=\"@@{address}@@\"\n\nfunction log_msg() {\n\tlocal logger=$(basename \"$0\")\n\tprintf \"[${logger}] $1\\n\"\n}\n\n\n# SSH to a node ($1), run command ($2)).\nfunction ssh_run_command() {\n\tlocal node=\"$1\"\n\tlocal command=\"$2\"\n\tssh  -oBatchMode=yes -oConnectTimeout=10 -o StrictHostKeyChecking=no \\\n\t\t-o UserKnownHostsFile=/dev/null -q ${node} ${command} 2>&1 | tr -d '\\r\\n'\n}\n\n\nfunction check_ssh_connectivity() {\n\tlog_msg \"  Checking SSH connectivity to each node (from this host)...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to master ${master}\"\n\t\t\tlog_msg \"  Only IPs in ${CONTROLLER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to worker ${worker}\"\n\t\t\tlog_msg \"  Only IPs in ${WORKER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n}\n\nfunction check_system_services() {\n\n\tlog_msg \"  Checking whether expected system services are running on each node...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-etcd service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kube-etcd 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kube-etcd service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\n\tdone\n\n}\n\nfunction check_k8s_healthz_through_lb() {\n\tlog_msg \"  Checking status of /healthz endpoint...\"\n\toutput=$(curl --insecure --max-time 30 https://${MASTER_IP}:443/healthz 2>/dev/null)\n\tif [[ $output != \"ok\" ]]; then\n\t\tlog_msg \"  [FAILED] Master node /healthz is not available\"\n\t\texit 1\n\tfi\n\n}\n\nfunction check_get_nodes() {\n\tlog_msg \"  Running 'kubectl get nodes' a number of times through the master...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 1)\n\tfor i in {1..20}; do\n\t\tcount=$(kubectl get nodes --no-headers 2>/dev/null | grep \"Ready\" | wc -l)\n\t\tlog_msg \"  Running 'kubectl get nodes' count is ${count} out of ${expected_nodes} expected...\"\n\t\tif [ \"$count\" -lt $expected_nodes ]; then\n\t\t\tlog_msg \"  [FAILED] kubectl get nodes reported less healthy nodes than expected\"\n\t\t\tkubectl get nodes\n\t\t\texit 1\n\t\tfi\n\tdone\n}\n\nfunction check_kube-dns() {\n\tlog_msg \"  Checking status of kube-dns pod...\"\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $3}')\n\tlog_msg \"  kube-dns pod status is ${output}\"\n\tif [[ $output != \"Running\" ]]; then\n\t\tlog_msg \"  [FAILED] kube-dns is not running in the cluster\"\n\t\texit 1\n\tfi\n\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $2}')\n\tlog_msg \"  expected kube-dns pod is ${output}\"\n\tif [[ $output != \"3/3\" ]]; then\n\t\tlog_msg \"  [FAILED] expected 3/3 kube-dns pods to be running in the cluster\"\n\t\texit 1\n\tfi\n}\n\nfunction check_nginx_deployment() {\n\tlog_msg \"  Checking an app deployment of nginx exposed as a service...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 2)\n\tkubectl run nginx --image=\"nginx\" --port=80 --replicas=${expected_nodes} 1>/dev/null\n\tkubectl expose deployment nginx --type NodePort 1>/dev/null\n\n\tnodePort=\"UNSET\"\n\tmax_tries=0\n\tuntil [ $nodePort != \"UNSET\" ] || [ $max_tries -eq 10 ]; do\n\t\tnodePort=$(kubectl get svc nginx --output=jsonpath='{range .spec.ports[0]}{.nodePort}')\n\t\tmax_tries=$((max_tries + 1))\n\tdone\n\n\tif [[ $nodePort == \"UNSET\" ]]; then\n\t\tlog_msg \"  [FAILED] could not retrieve the NodePort of the nginx service\"\n\t\texit 1\n\tfi\n\n\t# Avoid possible hang if port is not ready\n\tsleep 10\n    for i in {1..5}; do\n\t    for worker in $(echo ${CONTROLLER_IP},${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\t    output=$(curl --max-time 30 http://$worker:$nodePort 2>/dev/null)\n            if [[ -z \"$output\" ]]; then\n\t\t\t    log_msg \"   [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t\t    exit 1\n            fi\n\t\t    if [[ $output != *\"Welcome to nginx!\"* ]]; then\n\t\t\t    log_msg \"  [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t    \texit 1\n\t    \tfi\n    \tdone\n    done\n    kubectl delete deployment nginx 1>/dev/null\n}\n\nfunction print_success() {\n\tcat <<EOF\n\nThe Kubernetes cluster is up and appears to be healthy.\n$(kubectl cluster-info)\nEOF\n}\n\nlog_msg \"Running some basic checks on Kubernetes cluster....\"\ncheck_ssh_connectivity\ncheck_system_services\ncheck_k8s_healthz_through_lb\ncheck_get_nodes\ncheck_kube-dns\ncheck_nginx_deployment\n\nprint_success\n\nexit 0", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "1b74879f-8d2e-45d9-a08b-6348aa68e71b"}], "description": "", "name": "87e0163f_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "7a4e4568_dag", "uuid": "43afc077-3c35-41d9-9a97-5c37544b0cb4"}, "message_list": [], "variable_list": [], "uuid": "2338ea52-7442-448f-bf45-76c61e7efbbf"}, "message_list": [], "name": "Test"}, {"description": "System action for creating an application", "type": "system", "uuid": "3199de06-24a1-4d3c-a81e-bf02e9ac68bc", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Core", "uuid": "15076f45-1acd-4994-b8b8-e8f289c4c65a"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__DE_Provision_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "97f53f3b-6232-4e54-8ce0-e156a16d4682"}, {"kind": "app_task", "name": "SYS_GEN__DE_Provision_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "d9cc742e-2344-42ab-811d-45aa223e809f"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "525ae35d-07a5-4da9-b9ba-64d6fbe4d6b4"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "f87a00c8-738f-4a41-94d0-da2368e44db2"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "660c8083-c308-48d8-9d3d-d70182c1d80e"}, {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "1ae886dd-1c49-401e-a331-993d09f3caec"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "717ae8e8-0b00-455a-8203-35be5d4109c0"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "ff5b4d7c-1dab-4e67-a444-08dafe2bd6d3"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "87c75d71-099d-4273-8c37-b60073bdc5e9"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "a63e3add-3843-4fbf-a6b7-c20ed06174f7"}], "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "ff5b4d7c-1dab-4e67-a444-08dafe2bd6d3"}, "edge_type": "inherent", "type": "", "uuid": "4e1e7f19-7d8e-41c3-a334-90b771bc13be", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "a63e3add-3843-4fbf-a6b7-c20ed06174f7"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "660c8083-c308-48d8-9d3d-d70182c1d80e"}, "edge_type": "inherent", "type": "", "uuid": "7ef787a6-972a-467f-bee7-4c775ef01336", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "ff5b4d7c-1dab-4e67-a444-08dafe2bd6d3"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "d9cc742e-2344-42ab-811d-45aa223e809f"}, "edge_type": "inherent", "type": "", "uuid": "d3e60652-7894-4ca4-b6d0-b423dd6b2649", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "525ae35d-07a5-4da9-b9ba-64d6fbe4d6b4"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "525ae35d-07a5-4da9-b9ba-64d6fbe4d6b4"}, "edge_type": "inherent", "type": "", "uuid": "0156657e-5d8d-40cc-819f-122ada31bcdb", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "660c8083-c308-48d8-9d3d-d70182c1d80e"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "717ae8e8-0b00-455a-8203-35be5d4109c0"}, "edge_type": "inherent", "type": "", "uuid": "ad87c382-7b61-4eb5-a324-67fb42b0503a", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "87c75d71-099d-4273-8c37-b60073bdc5e9"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "1ae886dd-1c49-401e-a331-993d09f3caec"}, "edge_type": "inherent", "type": "", "uuid": "c59f2c38-9408-403a-909c-d0c60c32defd", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "717ae8e8-0b00-455a-8203-35be5d4109c0"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Provision_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "97f53f3b-6232-4e54-8ce0-e156a16d4682"}, "edge_type": "inherent", "type": "", "uuid": "8f7327c9-e30c-4c6c-96fb-70f5271bf9cd", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "f87a00c8-738f-4a41-94d0-da2368e44db2"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "f87a00c8-738f-4a41-94d0-da2368e44db2"}, "edge_type": "inherent", "type": "", "uuid": "d2862a95-535a-4c1c-98ae-e6cf70ef18d6", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "1ae886dd-1c49-401e-a331-993d09f3caec"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "f87a00c8-738f-4a41-94d0-da2368e44db2"}, "edge_type": "dependency", "type": "", "uuid": "93f3d9ca-b3cd-4084-a142-6ff418e56840", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "660c8083-c308-48d8-9d3d-d70182c1d80e"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "525ae35d-07a5-4da9-b9ba-64d6fbe4d6b4"}, "edge_type": "dependency", "type": "", "uuid": "7cbf7a30-d6dd-424f-a05d-5e36a4935dc2", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "1ae886dd-1c49-401e-a331-993d09f3caec"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "3305e48a-ad4a-4f0d-a50a-de8e8bd3dfde"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "97f53f3b-6232-4e54-8ce0-e156a16d4682"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Provision_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "CREATE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "d9cc742e-2344-42ab-811d-45aa223e809f"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "164954b6-f172-454f-b438-88d39f52e998"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "525ae35d-07a5-4da9-b9ba-64d6fbe4d6b4"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "1529baa8-9f32-4055-b130-d28613358c89"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "f87a00c8-738f-4a41-94d0-da2368e44db2"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "3a91e88c-4019-4064-b80d-651c8c6d9d1a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "660c8083-c308-48d8-9d3d-d70182c1d80e"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "068deee7-3280-438b-9312-9df00bddd019"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "1ae886dd-1c49-401e-a331-993d09f3caec"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "925ba7c0_runbook", "uuid": "ce426880-342a-4995-9d9c-c9dec8c586c4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "717ae8e8-0b00-455a-8203-35be5d4109c0"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "39d74fe7_runbook", "uuid": "d28a648a-b9fd-4a6f-a2af-d05db381ae3a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "ff5b4d7c-1dab-4e67-a444-08dafe2bd6d3"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "87c75d71-099d-4273-8c37-b60073bdc5e9"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "a63e3add-3843-4fbf-a6b7-c20ed06174f7"}], "description": "", "name": "SYS_GEN__Runbook_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "uuid": "3305e48a-ad4a-4f0d-a50a-de8e8bd3dfde"}, "message_list": [], "variable_list": [], "uuid": "b357cfcd-f44b-44a5-b332-dda7841e2226"}, "message_list": [], "name": "action_create"}, {"description": "System action for starting an application", "type": "system", "uuid": "8eb72fc7-1608-4af9-b96d-120a051ad10c", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Core", "uuid": "15076f45-1acd-4994-b8b8-e8f289c4c65a"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "5fefd6a9-c44b-4b7f-8b95-e3d71570dbe9"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "1b85b1a0-3c22-41f9-8bc7-e3f52ffe4c35"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6bad848e-3a7f-44ff-bf44-75fdb630b3c6"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "6bcfcc71-dc55-4dff-b3f0-f7114fa46892"}], "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "1b85b1a0-3c22-41f9-8bc7-e3f52ffe4c35"}, "edge_type": "inherent", "type": "", "uuid": "a9b67bef-b4f5-476b-84a9-efa7b9a57d6c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "6bcfcc71-dc55-4dff-b3f0-f7114fa46892"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "5fefd6a9-c44b-4b7f-8b95-e3d71570dbe9"}, "edge_type": "inherent", "type": "", "uuid": "987afc68-0e2f-4b74-a98c-54961f083e7e", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "6bad848e-3a7f-44ff-bf44-75fdb630b3c6"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "de23d2a2-500b-40ec-b3da-8cc02665c30b"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "dc8da279-ebd9-46c3-8bb9-8a76f6f3df1c"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "5fefd6a9-c44b-4b7f-8b95-e3d71570dbe9"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "fda6dc44-6df2-4e0f-8cd5-483e317bb165"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "1b85b1a0-3c22-41f9-8bc7-e3f52ffe4c35"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "6bad848e-3a7f-44ff-bf44-75fdb630b3c6"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "6bcfcc71-dc55-4dff-b3f0-f7114fa46892"}], "description": "", "name": "SYS_GEN__Runbook_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "uuid": "de23d2a2-500b-40ec-b3da-8cc02665c30b"}, "message_list": [], "variable_list": [], "uuid": "66ecaf2c-d902-4e78-85e1-8ae8cc2864ae"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "8310ed60-5d4c-4b39-b74e-d535a1b158b4", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Core", "uuid": "15076f45-1acd-4994-b8b8-e8f289c4c65a"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "14f5705f-da90-40ad-94b6-90fa40c52838"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "322483ed-f50e-4492-829f-a5e1f6081b3d"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "1b0c8d69-c1ce-4605-8383-706e9cc5fa60"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "106ec6e3-3a54-47e2-bb37-1111e7384ad7"}], "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "14f5705f-da90-40ad-94b6-90fa40c52838"}, "edge_type": "inherent", "type": "", "uuid": "741fc6d8-bea7-4f7f-839a-aa88f64e151b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "1b0c8d69-c1ce-4605-8383-706e9cc5fa60"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "322483ed-f50e-4492-829f-a5e1f6081b3d"}, "edge_type": "inherent", "type": "", "uuid": "385bfba8-5cca-42fb-bfac-f375b9ec8478", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "106ec6e3-3a54-47e2-bb37-1111e7384ad7"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "318802cc-04f5-4a0f-a1b2-970c3d321b66"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "14f5705f-da90-40ad-94b6-90fa40c52838"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "322483ed-f50e-4492-829f-a5e1f6081b3d"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "3f997f3d-efc8-49e5-a2ac-5f3f3a8ca120"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "1b0c8d69-c1ce-4605-8383-706e9cc5fa60"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "2dde39fa-2790-4436-b897-584ad08bb3ab"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "106ec6e3-3a54-47e2-bb37-1111e7384ad7"}], "description": "", "name": "SYS_GEN__Runbook_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "uuid": "318802cc-04f5-4a0f-a1b2-970c3d321b66"}, "message_list": [], "variable_list": [], "uuid": "c594e8fa-4dd7-4e27-8bc9-981549665190"}, "message_list": [], "name": "action_stop"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "10018deb-bce9-43b6-b274-5f3be58f6c2a", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Core", "uuid": "15076f45-1acd-4994-b8b8-e8f289c4c65a"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "a6307dc8-cd60-46c3-a600-0b49ee132cfe"}, {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8d75b3de-7f26-4776-8905-aa7fbbfb3aed"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "21f97098-757d-426f-bba1-318dd4a4f5ba"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "71eb39b6-e897-4e35-938d-f384b14840bd"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "02733410-29e9-49aa-8e72-72cd9ca62014"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "3758143d-61ed-40af-857a-fd5a004fd6f8"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "f2cfaded-2f36-4cde-8537-96d707dc5afd"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "64560ca0-2c25-40f1-ac2e-cbb551c0c1a8"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "990af18e-462e-45a8-a40b-478546b58c95"}, {"kind": "app_task", "name": "SYS_GEN__DE_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "6bbe152c-62eb-489f-bce4-275654d296bc"}], "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8d75b3de-7f26-4776-8905-aa7fbbfb3aed"}, "edge_type": "inherent", "type": "", "uuid": "a41b99c0-5666-4cc7-bdc3-80d78da0f32e", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "71eb39b6-e897-4e35-938d-f384b14840bd"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "71eb39b6-e897-4e35-938d-f384b14840bd"}, "edge_type": "inherent", "type": "", "uuid": "2d8a7f60-24c8-43c8-8194-044811021628", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "02733410-29e9-49aa-8e72-72cd9ca62014"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "02733410-29e9-49aa-8e72-72cd9ca62014"}, "edge_type": "inherent", "type": "", "uuid": "ef5a3507-6398-4c0b-a010-0b8152c511c5", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "f2cfaded-2f36-4cde-8537-96d707dc5afd"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "f2cfaded-2f36-4cde-8537-96d707dc5afd"}, "edge_type": "inherent", "type": "", "uuid": "ca8fad90-b3da-4eb7-a647-a4c74e6b2f72", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "6bbe152c-62eb-489f-bce4-275654d296bc"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "a6307dc8-cd60-46c3-a600-0b49ee132cfe"}, "edge_type": "inherent", "type": "", "uuid": "7387d1c6-9c37-4879-86a4-fccc8a9d2842", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "21f97098-757d-426f-bba1-318dd4a4f5ba"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "21f97098-757d-426f-bba1-318dd4a4f5ba"}, "edge_type": "inherent", "type": "", "uuid": "e614a778-9ad1-4d32-a87a-edc762330d94", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "3758143d-61ed-40af-857a-fd5a004fd6f8"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "64560ca0-2c25-40f1-ac2e-cbb551c0c1a8"}, "edge_type": "inherent", "type": "", "uuid": "ccae8a61-2fd3-480b-8cd7-2b24ca9d4165", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "990af18e-462e-45a8-a40b-478546b58c95"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "3758143d-61ed-40af-857a-fd5a004fd6f8"}, "edge_type": "inherent", "type": "", "uuid": "2b3ad814-5a58-4428-ad9f-a110546b4d0f", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "64560ca0-2c25-40f1-ac2e-cbb551c0c1a8"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "02733410-29e9-49aa-8e72-72cd9ca62014"}, "edge_type": "create_action_edge", "type": "", "uuid": "49f5846a-d428-455d-895d-3150e765f8c3", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "64560ca0-2c25-40f1-ac2e-cbb551c0c1a8"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "3758143d-61ed-40af-857a-fd5a004fd6f8"}, "edge_type": "create_action_edge", "type": "", "uuid": "a960c480-d762-4fa9-9b56-7055bc12c187", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "f2cfaded-2f36-4cde-8537-96d707dc5afd"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "12efb5d8-e959-4a34-9be6-81bb14e5c813"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "a6307dc8-cd60-46c3-a600-0b49ee132cfe"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "8d75b3de-7f26-4776-8905-aa7fbbfb3aed"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "28e74b96_runbook", "uuid": "0ab86c44-ee03-4d60-ae33-3bc75165ee6a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "21f97098-757d-426f-bba1-318dd4a4f5ba"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "b00241d6_runbook", "uuid": "a5999398-fee7-49e7-8af2-7c82fe537838"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "71eb39b6-e897-4e35-938d-f384b14840bd"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "1d149726-7bc4-4e02-945e-660f990e1ed3"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "02733410-29e9-49aa-8e72-72cd9ca62014"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "a0355c2c-8ce9-44eb-84c7-ec6b92061b15"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "3758143d-61ed-40af-857a-fd5a004fd6f8"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "1db390cb-e26a-492c-94ff-f476e8f7466f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "f2cfaded-2f36-4cde-8537-96d707dc5afd"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "cf4bb8ca-2d92-44a4-a11b-8945d5289200"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "64560ca0-2c25-40f1-ac2e-cbb551c0c1a8"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "990af18e-462e-45a8-a40b-478546b58c95"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "6bbe152c-62eb-489f-bce4-275654d296bc"}], "description": "", "name": "SYS_GEN__Runbook_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "uuid": "12efb5d8-e959-4a34-9be6-81bb14e5c813"}, "message_list": [], "variable_list": [], "uuid": "319a28dd-0d0a-4667-afc5-3a2e5b0ace44"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "8e174512-28b4-4149-8ea1-87c57459afd5", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_profile", "name": "Core", "uuid": "15076f45-1acd-4994-b8b8-e8f289c4c65a"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "46d7dde6-2b99-4220-aa1c-66fdd0fca03f"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "9cc95789-0388-440e-80c0-5ee93c610f95"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "160a1a4f-c1fd-4f6b-8b43-ab7fb9411c6c"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "5a091e69-149d-41d4-b203-5ab26aa3bb49"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "b0068cca-3022-490c-8e96-5ba23e9d816f"}, {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "421430d4-f1d0-4975-8cae-a96c17362b62"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "b2443d2e-b2a2-45ca-9489-e5388ccc2390"}, {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "f5f39d55-be4a-4b57-902f-2cd6d8c6c49c"}], "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "46d7dde6-2b99-4220-aa1c-66fdd0fca03f"}, "edge_type": "inherent", "type": "", "uuid": "620ebe09-9cad-48b1-a404-50c812922e9f", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "160a1a4f-c1fd-4f6b-8b43-ab7fb9411c6c"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "421430d4-f1d0-4975-8cae-a96c17362b62"}, "edge_type": "inherent", "type": "", "uuid": "bacf8d57-56a9-4e97-baf1-1c98ae28584c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "uuid": "b2443d2e-b2a2-45ca-9489-e5388ccc2390"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "160a1a4f-c1fd-4f6b-8b43-ab7fb9411c6c"}, "edge_type": "inherent", "type": "", "uuid": "f95f6955-f92e-4940-a072-dfbe0503b465", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "421430d4-f1d0-4975-8cae-a96c17362b62"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "9cc95789-0388-440e-80c0-5ee93c610f95"}, "edge_type": "inherent", "type": "", "uuid": "7d6597e6-19a1-4503-8001-9ea597928b71", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "5a091e69-149d-41d4-b203-5ab26aa3bb49"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "b0068cca-3022-490c-8e96-5ba23e9d816f"}, "edge_type": "inherent", "type": "", "uuid": "23eddb91-de0b-477e-818d-b56819bfd0a9", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__DE_Soft_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "uuid": "f5f39d55-be4a-4b57-902f-2cd6d8c6c49c"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "5a091e69-149d-41d4-b203-5ab26aa3bb49"}, "edge_type": "inherent", "type": "", "uuid": "7eb9b06d-ae5f-47ff-ac9b-fd44b9b6125c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "b0068cca-3022-490c-8e96-5ba23e9d816f"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "160a1a4f-c1fd-4f6b-8b43-ab7fb9411c6c"}, "edge_type": "create_action_edge", "type": "", "uuid": "7275b316-4501-4572-9d16-ef2126103ab4", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "b0068cca-3022-490c-8e96-5ba23e9d816f"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "5a091e69-149d-41d4-b203-5ab26aa3bb49"}, "edge_type": "create_action_edge", "type": "", "uuid": "25d0cae6-04a5-47bb-b1c2-3d34ad0a6016", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "421430d4-f1d0-4975-8cae-a96c17362b62"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "f3b6ff57-f0fa-4666-bf43-80df4609bbab"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "59a30bab-b0f4-4159-82ca-96708920121f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "46d7dde6-2b99-4220-aa1c-66fdd0fca03f"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "deployment_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8bf1f321-c96c-485d-bf06-13a230fc1e23"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "9cc95789-0388-440e-80c0-5ee93c610f95"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "160a1a4f-c1fd-4f6b-8b43-ab7fb9411c6c"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "5a091e69-149d-41d4-b203-5ab26aa3bb49"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SM_Core", "uuid": "f1ef3561-42e6-4e30-a8cd-58cc9c72237e"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_f1ef3561_42e6_4e30_a8cd_58cc9c72237e", "uuid": "5549ebeb-99d4-4d05-8bbd-8532092f0db0"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "b0068cca-3022-490c-8e96-5ba23e9d816f"}, {"target_any_local_reference": {"kind": "app_substrate", "name": "K8SC_Core", "uuid": "ef140991-1d1d-4d67-92fb-92b5022c9691"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Substrate_ef140991_1d1d_4d67_92fb_92b5022c9691", "uuid": "cd9ff04f-74f4-4942-ab25-1b4f982abaec"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "421430d4-f1d0-4975-8cae-a96c17362b62"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "8d3d1287_deployment", "uuid": "83337f41-0dc0-4a4f-b17c-41e40c1243e3"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_83337f41_0dc0_4a4f_b17c_41e40c1243e3", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "b2443d2e-b2a2-45ca-9489-e5388ccc2390"}, {"target_any_local_reference": {"kind": "app_blueprint_deployment", "name": "37f2422f_deployment", "uuid": "cf41c68f-1bc8-4bd2-a914-8af44ea97fe5"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__DE_Soft_Delete_cf41c68f_1bc8_4bd2_a914_8af44ea97fe5", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_DEPLOYMENT_ELEMENT", "variable_list": [], "uuid": "f5f39d55-be4a-4b57-902f-2cd6d8c6c49c"}], "description": "", "name": "SYS_GEN__Runbook_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Application_15076f45_1acd_4994_b8b8_e8f289c4c65a", "uuid": "f3b6ff57-f0fa-4666-bf43-80df4609bbab"}, "message_list": [], "variable_list": [], "uuid": "8aa47c3e-709b-45c3-a86c-81dfc7af2f10"}, "message_list": [], "name": "action_soft_delete"}], "name": "Core", "state": "ACTIVE", "message_list": [], "dependency_list": [{"getter_resource_kind": "PackageCfg", "setter_resource_attr": "address", "setter_resource_kind": "SubstrateCfg", "setter_resource_name": "K8SM_Core", "action_name": "action_create", "action_resource_name": "Core", "getter_resource_name": "K8SC_Core_Package", "action_resource_kind": "ApplicationCfg"}, {"getter_resource_kind": "PackageCfg", "setter_resource_attr": "address", "setter_resource_kind": "SubstrateCfg", "setter_resource_name": "K8SC_Core", "action_name": "action_create", "action_resource_name": "Core", "getter_resource_name": "K8SM_Core_Package", "action_resource_kind": "ApplicationCfg"}], "variable_list": [{"val_type": "STRING", "description": "", "name": "KUBELET_IMAGE_TAG", "type": "LOCAL", "value": "v1.7.10_coreos.0", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "3897c153-83af-4132-bfb2-8131be0cf1c9"}, {"val_type": "STRING", "description": "", "name": "CLUSTER_SUBNET", "type": "LOCAL", "value": "10.200.0.0/16", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "ec788716-ed78-480e-8ff5-ec08c9d005cf"}, {"val_type": "STRING", "description": "", "name": "SERVICE_SUBNET", "type": "LOCAL", "value": "10.32.0.0/24", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "fb0cd689-7679-4947-8e42-a240692a0c73"}, {"val_type": "STRING", "description": "", "name": "KUBE_CLUSTER_DNS", "type": "LOCAL", "value": "10.32.0.10", "label": "", "state": "ACTIVE", "attrs": {}, "editables": {"value": true}, "message_list": [], "uuid": "7c46d5ab-1b5d-4011-acc0-336e53567ba3"}, {"val_type": "STRING", "description": "", "name": "PRISM_CLUSTER_IP", "type": "LOCAL", "value": "10.5.67.138", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "56015fa9-437e-4127-a6a9-643dc4035cc7"}, {"val_type": "STRING", "description": "", "name": "PRISM_DATA_SERVICE_IP", "type": "LOCAL", "value": "10.5.67.143", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "1dbfa886-64b8-4745-bb94-7ec724334a7f"}, {"val_type": "STRING", "description": "", "name": "PRISM_USERNAME", "type": "LOCAL", "value": "admin", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "d7a8c5f2-f8be-40a6-977c-d23901c5bd45"}, {"val_type": "STRING", "description": "", "name": "PRISM_PASSWORD", "type": "SECRET", "value": "", "label": "", "state": "ACTIVE", "attrs": {"is_secret_modified": false, "secret_reference": {"uuid": "8070392b-71d9-43dc-bfb1-0f1e7f5c76af"}, "type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "73f005ba-8091-4bf3-b932-038ef49cb2db"}, {"val_type": "STRING", "description": "", "name": "CONTAINER_NAME", "type": "LOCAL", "value": "default-container-43360047467620", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "65edeafe-2cc9-410d-a3ca-2d1df0cedc61"}, {"val_type": "STRING", "description": "", "name": "INSTANCE_PUBLIC_KEY", "type": "LOCAL", "value": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS/K0Mb/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf/i9QMJ5/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com", "label": "", "state": "ACTIVE", "attrs": {"type": ""}, "editables": {"value": true}, "message_list": [], "uuid": "042e856f-a483-4354-b9c8-2f6a12728e09"}], "uuid": "15076f45-1acd-4994-b8b8-e8f289c4c65a"}], "default_credential_local_reference": {"kind": "app_credential", "name": "KUBE", "uuid": "95632617-86a6-4eec-9df7-e731de24225e"}, "package_definition_list": [{"description": "", "action_list": [{"description": "System action for installing an application", "type": "system", "uuid": "a5eb0733-7b48-4786-9f32-37c07246fd9b", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Install_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "6607570d-412c-4dc1-a0f4-75b3b47fc1eb"}], "name": "SYS_GEN__DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "b20666aa-067c-4ac5-99a7-a2a69a873acc"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Install_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "4ae7ca6d-c212-4f76-b9ee-db7e8d8d8006"}], "name": "1941c1cf_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c68d8bc1-6aeb-43d0-8a2e-bbb61c35f1b6"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nsudo easy_install netaddr\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Centos.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')    \n    \nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\n# -*- Bootstrapping a H/A etcd cluster.\ntar -xvf etcd-v3.2.6-linux-amd64.tar.gz\nsudo mv etcd-v3.2.6-linux-amd64/etcd* /usr/bin/\nrm -rf etcd-v3.2.6-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https://github.com/coreos\n\n[Service]\nExecStart=/usr/bin/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /usr/local/bin/cfssl\nsudo mv cfssljson_linux-amd64 /usr/local/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /usr/local/bin/\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone\n\n", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "4ae7ca6d-c212-4f76-b9ee-db7e8d8d8006"}], "description": "", "name": "9c8e1cff_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "1941c1cf_dag", "uuid": "c68d8bc1-6aeb-43d0-8a2e-bbb61c35f1b6"}, "message_list": [], "variable_list": [], "uuid": "b9007161-2ea3-4ac9-bd52-b28f021b6265"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "2574e274_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "b147bae7-5de9-4ce6-bffa-3186044684c9"}], "description": "", "name": "926289ee_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "2574e274_dag", "uuid": "b147bae7-5de9-4ce6-bffa-3186044684c9"}, "message_list": [], "variable_list": [], "uuid": "c4afdc50-82f6-4516-b919-64d0b24bb2bd"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_INSTALL", "variable_list": [], "uuid": "6607570d-412c-4dc1-a0f4-75b3b47fc1eb"}], "description": "", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "b20666aa-067c-4ac5-99a7-a2a69a873acc"}, "message_list": [], "variable_list": [], "uuid": "836f40c0-e00c-4e5a-ab61-6e8c8554c54b"}, "message_list": [], "name": "action_install"}, {"description": "System action for creating an application", "type": "system", "uuid": "823685ae-c047-4f66-9de2-4f9685afa9f3", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "12581b3f-3bbf-49c6-9cac-3a44d2a8c7fa"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "5f298c88-c09c-4ea1-afa9-1b9e9522d0da"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "0fc9835a-8d57-4733-a313-afd77dc6ceed"}], "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "5f298c88-c09c-4ea1-afa9-1b9e9522d0da"}, "edge_type": "inherent", "type": "", "uuid": "6741d617-2754-42cd-81bf-268c0b0e40fd", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "0fc9835a-8d57-4733-a313-afd77dc6ceed"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "12581b3f-3bbf-49c6-9cac-3a44d2a8c7fa"}, "edge_type": "inherent", "type": "", "uuid": "e6704d7d-846d-4ba4-9377-950f275185ed", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "5f298c88-c09c-4ea1-afa9-1b9e9522d0da"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "9464573d-b5e9-422d-b9ca-4e7ada1c0c70"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "836f40c0-e00c-4e5a-ab61-6e8c8554c54b"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "12581b3f-3bbf-49c6-9cac-3a44d2a8c7fa"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "39d74fe7_runbook", "uuid": "d28a648a-b9fd-4a6f-a2af-d05db381ae3a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "5f298c88-c09c-4ea1-afa9-1b9e9522d0da"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "0fc9835a-8d57-4733-a313-afd77dc6ceed"}], "description": "", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "9464573d-b5e9-422d-b9ca-4e7ada1c0c70"}, "message_list": [], "variable_list": [], "uuid": "51e574ab-4b70-4183-be96-5b6c4d6e548a"}, "message_list": [], "name": "action_create"}, {"description": "System action for uninstalling an application", "type": "system", "uuid": "73964ad6-f929-4486-8bc2-976e729b985c", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Uninstall_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "c434e172-5aca-4f3f-9d3b-848ee72497df"}], "name": "SYS_GEN__DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "b7c5d869-73d3-4daa-8d53-155545894088"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Uninstall_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "4ae7ca6d-c212-4f76-b9ee-db7e8d8d8006"}], "name": "1941c1cf_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c68d8bc1-6aeb-43d0-8a2e-bbb61c35f1b6"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nsudo easy_install netaddr\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Centos.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')    \n    \nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\n# -*- Bootstrapping a H/A etcd cluster.\ntar -xvf etcd-v3.2.6-linux-amd64.tar.gz\nsudo mv etcd-v3.2.6-linux-amd64/etcd* /usr/bin/\nrm -rf etcd-v3.2.6-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https://github.com/coreos\n\n[Service]\nExecStart=/usr/bin/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /usr/local/bin/cfssl\nsudo mv cfssljson_linux-amd64 /usr/local/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /usr/local/bin/\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone\n\n", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "4ae7ca6d-c212-4f76-b9ee-db7e8d8d8006"}], "description": "", "name": "9c8e1cff_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "1941c1cf_dag", "uuid": "c68d8bc1-6aeb-43d0-8a2e-bbb61c35f1b6"}, "message_list": [], "variable_list": [], "uuid": "b9007161-2ea3-4ac9-bd52-b28f021b6265"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "2574e274_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "b147bae7-5de9-4ce6-bffa-3186044684c9"}], "description": "", "name": "926289ee_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "2574e274_dag", "uuid": "b147bae7-5de9-4ce6-bffa-3186044684c9"}, "message_list": [], "variable_list": [], "uuid": "c4afdc50-82f6-4516-b919-64d0b24bb2bd"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_UNINSTALL", "variable_list": [], "uuid": "c434e172-5aca-4f3f-9d3b-848ee72497df"}], "description": "", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "b7c5d869-73d3-4daa-8d53-155545894088"}, "message_list": [], "variable_list": [], "uuid": "54a21e6d-8912-4e49-a0b8-31a11f87ca0f"}, "message_list": [], "name": "action_uninstall"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "169a251c-2b4b-44c9-baf1-65c8473e2526", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8e656595-4000-4e0c-a8e6-171c83a45f6d"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9d86390b-bc03-4635-b302-1a23c5e1c8d5"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "b2a0e1e8-a677-4644-9bfa-a06e02a08ee7"}], "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "8e656595-4000-4e0c-a8e6-171c83a45f6d"}, "edge_type": "inherent", "type": "", "uuid": "3a1e0cf3-d46a-4424-b626-43c53eec2bcd", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9d86390b-bc03-4635-b302-1a23c5e1c8d5"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "9d86390b-bc03-4635-b302-1a23c5e1c8d5"}, "edge_type": "inherent", "type": "", "uuid": "2d08ae0a-4a6d-4c2c-b952-cbe622adaaab", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "b2a0e1e8-a677-4644-9bfa-a06e02a08ee7"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "9535287a-5b04-4895-a719-83e30abbeb51"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "8e656595-4000-4e0c-a8e6-171c83a45f6d"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "b00241d6_runbook", "uuid": "a5999398-fee7-49e7-8af2-7c82fe537838"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "9d86390b-bc03-4635-b302-1a23c5e1c8d5"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "54a21e6d-8912-4e49-a0b8-31a11f87ca0f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "b2a0e1e8-a677-4644-9bfa-a06e02a08ee7"}], "description": "", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "9535287a-5b04-4895-a719-83e30abbeb51"}, "message_list": [], "variable_list": [], "uuid": "a7181037-8c74-4354-ba6e-02b436e01c1f"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "a3f72fc3-d2bc-43bc-8394-6abe8005646e", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "a9b5144c-aaad-4647-a952-b5b0d9f8e22b"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "9fa915ca-868e-4f55-9dec-0f3dd22b58ff"}], "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "a9b5144c-aaad-4647-a952-b5b0d9f8e22b"}, "edge_type": "inherent", "type": "", "uuid": "cf2c15d1-c22a-4f98-b635-5762d4ea3ec8", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "9fa915ca-868e-4f55-9dec-0f3dd22b58ff"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "f4d7acf2-c828-4ac1-b9d2-ad180c2f0cb9"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "59a30bab-b0f4-4159-82ca-96708920121f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "a9b5144c-aaad-4647-a952-b5b0d9f8e22b"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "9fa915ca-868e-4f55-9dec-0f3dd22b58ff"}], "description": "", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "f4d7acf2-c828-4ac1-b9d2-ad180c2f0cb9"}, "message_list": [], "variable_list": [], "uuid": "08ab0a97-305e-4a50-966b-a7574c70f1c8"}, "message_list": [], "name": "action_soft_delete"}, {"description": "System action for starting an application", "type": "system", "uuid": "514baa64-f822-43c5-b5cb-9a71debfbaca", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "5407c6db-d74c-40a8-be0f-a0d21435b21d"}], "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "702828c1-0839-44d7-9b18-c30b5861c248"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "5407c6db-d74c-40a8-be0f-a0d21435b21d"}], "description": "", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "702828c1-0839-44d7-9b18-c30b5861c248"}, "message_list": [], "variable_list": [], "uuid": "c8dbc802-73e4-4107-b4d9-0a82d876294a"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "e7e1346f-b99b-45cf-927c-0425019dacd3", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "19094b22-952a-4730-b8c3-eb19b9f41bfe"}], "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c329621b-8716-4552-a863-306bb909a4de"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "19094b22-952a-4730-b8c3-eb19b9f41bfe"}], "description": "", "name": "SYS_GEN__Runbook_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_2727784b_ac29_41dd_9aa7_476c317319ba", "uuid": "c329621b-8716-4552-a863-306bb909a4de"}, "message_list": [], "variable_list": [], "uuid": "6be62246-ac28-4782-86dd-4da99341cb45"}, "message_list": [], "name": "action_stop"}], "type": "DEB", "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}], "name": "K8SCP", "state": "ACTIVE", "version": "", "editables": {}, "message_list": [], "options": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "4ae7ca6d-c212-4f76-b9ee-db7e8d8d8006"}], "name": "1941c1cf_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c68d8bc1-6aeb-43d0-8a2e-bbb61c35f1b6"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nsudo easy_install netaddr\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Centos.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')    \n    \nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\n# -*- Bootstrapping a H/A etcd cluster.\ntar -xvf etcd-v3.2.6-linux-amd64.tar.gz\nsudo mv etcd-v3.2.6-linux-amd64/etcd* /usr/bin/\nrm -rf etcd-v3.2.6-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https://github.com/coreos\n\n[Service]\nExecStart=/usr/bin/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /usr/local/bin/cfssl\nsudo mv cfssljson_linux-amd64 /usr/local/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /usr/local/bin/\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone\n\n", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "4ae7ca6d-c212-4f76-b9ee-db7e8d8d8006"}], "description": "", "name": "9c8e1cff_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "1941c1cf_dag", "uuid": "c68d8bc1-6aeb-43d0-8a2e-bbb61c35f1b6"}, "message_list": [], "variable_list": [], "uuid": "b9007161-2ea3-4ac9-bd52-b28f021b6265"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP", "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "2574e274_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "b147bae7-5de9-4ce6-bffa-3186044684c9"}], "description": "", "name": "926289ee_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "2574e274_dag", "uuid": "b147bae7-5de9-4ce6-bffa-3186044684c9"}, "message_list": [], "variable_list": [], "uuid": "c4afdc50-82f6-4516-b919-64d0b24bb2bd"}}, "variable_list": [], "uuid": "2727784b-ac29-41dd-9aa7-476c317319ba"}, {"description": "", "action_list": [{"description": "System action for installing an application", "type": "system", "uuid": "f3d1974b-00f3-4320-8eb0-fbbe257d3ab9", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Install_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "a7ec65eb-ad83-42a5-88ed-883cc7400213"}], "name": "SYS_GEN__DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "41c7c29f-83dd-43e0-8bf4-568127884b82"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Install_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "7be0a8e3-aeeb-4330-aec7-b59e718cd8f6"}], "name": "70add069_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "23a948e9-083e-463f-b0de-6b8453f97157"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Centos.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${NODE_NAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "7be0a8e3-aeeb-4330-aec7-b59e718cd8f6"}], "description": "", "name": "bcb096c9_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "70add069_dag", "uuid": "23a948e9-083e-463f-b0de-6b8453f97157"}, "message_list": [], "variable_list": [], "uuid": "68a0f1b1-0187-4b4c-af2e-9862fa8c2bf7"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "9f3d46b7_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "efd5a8e6-b03e-42df-a1fa-2b098c7943ca"}], "description": "", "name": "6fc961e1_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "9f3d46b7_dag", "uuid": "efd5a8e6-b03e-42df-a1fa-2b098c7943ca"}, "message_list": [], "variable_list": [], "uuid": "36a954b6-7b60-436c-a3ed-166377e90455"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_INSTALL", "variable_list": [], "uuid": "a7ec65eb-ad83-42a5-88ed-883cc7400213"}], "description": "", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "41c7c29f-83dd-43e0-8bf4-568127884b82"}, "message_list": [], "variable_list": [], "uuid": "c191cff3-2e12-4449-afde-c4e2872b9d47"}, "message_list": [], "name": "action_install"}, {"description": "System action for creating an application", "type": "system", "uuid": "46d9b000-760c-4bef-a932-84ccb8a715f3", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "ca544b10-88c6-4023-99f4-2922028f3680"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "d72b4fb0-f9ce-4305-ab9e-7288ac9e8927"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "07a4b3fb-19cc-4d0b-ba74-61ea7f9bad4a"}], "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "d72b4fb0-f9ce-4305-ab9e-7288ac9e8927"}, "edge_type": "inherent", "type": "", "uuid": "872742ad-f68a-4efc-9084-8cab90df06cf", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "07a4b3fb-19cc-4d0b-ba74-61ea7f9bad4a"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "ca544b10-88c6-4023-99f4-2922028f3680"}, "edge_type": "inherent", "type": "", "uuid": "bdede78a-3ce9-46fe-a23c-2c97e39115b6", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "d72b4fb0-f9ce-4305-ab9e-7288ac9e8927"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "e6ba6409-384b-4df2-bd81-5421d9fd5548"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "c191cff3-2e12-4449-afde-c4e2872b9d47"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "ca544b10-88c6-4023-99f4-2922028f3680"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "925ba7c0_runbook", "uuid": "ce426880-342a-4995-9d9c-c9dec8c586c4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "d72b4fb0-f9ce-4305-ab9e-7288ac9e8927"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "07a4b3fb-19cc-4d0b-ba74-61ea7f9bad4a"}], "description": "", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "e6ba6409-384b-4df2-bd81-5421d9fd5548"}, "message_list": [], "variable_list": [], "uuid": "f32ae60e-d6d4-4610-bb19-99d518f9085d"}, "message_list": [], "name": "action_create"}, {"description": "System action for uninstalling an application", "type": "system", "uuid": "09bdedbc-fd52-4868-9737-a5f07b3e1e79", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Uninstall_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "3990dfe5-ec6e-403d-b9d5-c7e3be838938"}], "name": "SYS_GEN__DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "dbcd3029-e516-490f-a7dc-34abd8a8f763"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Uninstall_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "7be0a8e3-aeeb-4330-aec7-b59e718cd8f6"}], "name": "70add069_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "23a948e9-083e-463f-b0de-6b8453f97157"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Centos.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${NODE_NAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "7be0a8e3-aeeb-4330-aec7-b59e718cd8f6"}], "description": "", "name": "bcb096c9_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "70add069_dag", "uuid": "23a948e9-083e-463f-b0de-6b8453f97157"}, "message_list": [], "variable_list": [], "uuid": "68a0f1b1-0187-4b4c-af2e-9862fa8c2bf7"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "9f3d46b7_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "efd5a8e6-b03e-42df-a1fa-2b098c7943ca"}], "description": "", "name": "6fc961e1_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "9f3d46b7_dag", "uuid": "efd5a8e6-b03e-42df-a1fa-2b098c7943ca"}, "message_list": [], "variable_list": [], "uuid": "36a954b6-7b60-436c-a3ed-166377e90455"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_UNINSTALL", "variable_list": [], "uuid": "3990dfe5-ec6e-403d-b9d5-c7e3be838938"}], "description": "", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "dbcd3029-e516-490f-a7dc-34abd8a8f763"}, "message_list": [], "variable_list": [], "uuid": "04b54e48-af42-449f-8530-e718b7d0f383"}, "message_list": [], "name": "action_uninstall"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "f350af74-de44-4783-abb0-cc23b17a418d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f9c0ca79-9d7d-42ef-9a4c-f37720d82d8c"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "63091c86-aa60-4060-9116-5a5b0f70ce1b"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "78171f18-335c-4c25-8d11-9c40547dddcc"}], "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f9c0ca79-9d7d-42ef-9a4c-f37720d82d8c"}, "edge_type": "inherent", "type": "", "uuid": "f75a6a0d-7ef1-48d1-90c5-98d927e6a34d", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "63091c86-aa60-4060-9116-5a5b0f70ce1b"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "63091c86-aa60-4060-9116-5a5b0f70ce1b"}, "edge_type": "inherent", "type": "", "uuid": "c7b55a8b-ca37-46f6-8bdd-ad88d7443f4c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "78171f18-335c-4c25-8d11-9c40547dddcc"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "649e0120-1d59-46e1-94f9-9c39fadea360"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "f9c0ca79-9d7d-42ef-9a4c-f37720d82d8c"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "28e74b96_runbook", "uuid": "0ab86c44-ee03-4d60-ae33-3bc75165ee6a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "63091c86-aa60-4060-9116-5a5b0f70ce1b"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "04b54e48-af42-449f-8530-e718b7d0f383"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "78171f18-335c-4c25-8d11-9c40547dddcc"}], "description": "", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "649e0120-1d59-46e1-94f9-9c39fadea360"}, "message_list": [], "variable_list": [], "uuid": "0e81b3b4-d574-40e1-a0aa-ca9c5d764533"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "500c737b-e7d0-461c-834a-eb26ce5f5231", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "0bfebda5-3f13-42b0-966b-f06b5073a46a"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "1c1cc59a-fe88-4ae3-a91b-4864c012161b"}], "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "0bfebda5-3f13-42b0-966b-f06b5073a46a"}, "edge_type": "inherent", "type": "", "uuid": "3ff8ed64-13b6-4656-97ac-729f3f119380", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "1c1cc59a-fe88-4ae3-a91b-4864c012161b"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "3e0f67c0-6c99-4aaf-a72d-ecf92720d52d"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8bf1f321-c96c-485d-bf06-13a230fc1e23"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "0bfebda5-3f13-42b0-966b-f06b5073a46a"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "1c1cc59a-fe88-4ae3-a91b-4864c012161b"}], "description": "", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "3e0f67c0-6c99-4aaf-a72d-ecf92720d52d"}, "message_list": [], "variable_list": [], "uuid": "0650dcc0-96bf-4b39-a0fc-5e68f9f25857"}, "message_list": [], "name": "action_soft_delete"}, {"description": "System action for starting an application", "type": "system", "uuid": "b20c1dcd-3f70-4ef7-bdf3-78eb96f52865", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "604c5628-8c9e-4230-92cf-a4e58e347487"}], "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "be9d7819-4174-428a-9c59-aefe7f1256a5"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "604c5628-8c9e-4230-92cf-a4e58e347487"}], "description": "", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "be9d7819-4174-428a-9c59-aefe7f1256a5"}, "message_list": [], "variable_list": [], "uuid": "cf6fe2eb-f117-480d-b574-f449b45421a1"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "d8c95efa-3945-4b5c-8265-e82063b0acfa", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "e50375e0-7624-48ba-b83b-78f63f0076dc"}], "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "9ec2e225-2e5b-4e01-a238-278f18c0fc79"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "e50375e0-7624-48ba-b83b-78f63f0076dc"}], "description": "", "name": "SYS_GEN__Runbook_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_13c723c6_cc4b_4f28_869c_ba6ef727e263", "uuid": "9ec2e225-2e5b-4e01-a238-278f18c0fc79"}, "message_list": [], "variable_list": [], "uuid": "f7ac9c8e-e4c0-47fb-9b6f-311c67d67357"}, "message_list": [], "name": "action_stop"}], "type": "DEB", "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}], "name": "K8SMP", "state": "ACTIVE", "version": "", "editables": {}, "message_list": [], "options": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "7be0a8e3-aeeb-4330-aec7-b59e718cd8f6"}], "name": "70add069_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "23a948e9-083e-463f-b0de-6b8453f97157"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Centos.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${NODE_NAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "7be0a8e3-aeeb-4330-aec7-b59e718cd8f6"}], "description": "", "name": "bcb096c9_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "70add069_dag", "uuid": "23a948e9-083e-463f-b0de-6b8453f97157"}, "message_list": [], "variable_list": [], "uuid": "68a0f1b1-0187-4b4c-af2e-9862fa8c2bf7"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP", "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "9f3d46b7_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "efd5a8e6-b03e-42df-a1fa-2b098c7943ca"}], "description": "", "name": "6fc961e1_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "9f3d46b7_dag", "uuid": "efd5a8e6-b03e-42df-a1fa-2b098c7943ca"}, "message_list": [], "variable_list": [], "uuid": "36a954b6-7b60-436c-a3ed-166377e90455"}}, "variable_list": [], "uuid": "13c723c6-cc4b-4f28-869c-ba6ef727e263"}, {"description": "", "action_list": [{"description": "System action for installing an application", "type": "system", "uuid": "04d6f36a-3826-4d76-8e97-86c11eae5692", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Install_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "5b231759-a009-4931-8058-ff74c3538841"}], "name": "SYS_GEN__DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "88ae7aec-67eb-4f9d-aea5-8ef2d6afa935"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Install_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "99412ec9-6fa4-4d13-af1c-a3842840d99a"}], "name": "4c247e43_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "d8dd4a1f-011b-4d00-95f7-29246753c272"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Core.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /opt/bin ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')\n\necho \"[Unit]\nDescription=etcd (System Application Container)\nDocumentation=https://github.com/coreos/etcd\nWants=network-online.target network.target\nAfter=network-online.target\nConflicts=etcd.service\nConflicts=etcd2.service\n\n[Service]\nEnvironment='ETCD_IMAGE_TAG=v3.2.6'\nEnvironment='ETCD_DATA_DIR=/var/lib/etcd'\nEnvironment='ETCD_USER=etcd'\nExecStart=/usr/lib/coreos/etcd-wrapper \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q \"https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\" \"https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\"\nwget -q \"https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\"\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /opt/bin/cfssl\nsudo mv cfssljson_linux-amd64 /opt/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /opt/bin\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\nexport PATH=$PATH:/opt/bin\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},10.15.195.1,127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "99412ec9-6fa4-4d13-af1c-a3842840d99a"}], "description": "", "name": "0ac56c8c_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "4c247e43_dag", "uuid": "d8dd4a1f-011b-4d00-95f7-29246753c272"}, "message_list": [], "variable_list": [], "uuid": "545ac17b-e7fc-415f-9701-ea80144594ef"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "762da324_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "dde7cde1-2514-47e1-8bd4-a48d69838957"}], "description": "", "name": "a0877e37_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "762da324_dag", "uuid": "dde7cde1-2514-47e1-8bd4-a48d69838957"}, "message_list": [], "variable_list": [], "uuid": "bf2ae6c8-698b-4eac-9581-f34d4f8d6ff0"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_INSTALL", "variable_list": [], "uuid": "5b231759-a009-4931-8058-ff74c3538841"}], "description": "", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "88ae7aec-67eb-4f9d-aea5-8ef2d6afa935"}, "message_list": [], "variable_list": [], "uuid": "3a91e88c-4019-4064-b80d-651c8c6d9d1a"}, "message_list": [], "name": "action_install"}, {"description": "System action for creating an application", "type": "system", "uuid": "fdc1f861-8d44-4be5-8ed7-164749675636", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "4c9c58ac-44f2-489f-b475-02741fd1a8c7"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "898fbc3d-2bbd-4756-a96d-6b7fcfe2dc6c"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "cad53dff-9455-4268-942b-ad92b79042be"}], "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "898fbc3d-2bbd-4756-a96d-6b7fcfe2dc6c"}, "edge_type": "inherent", "type": "", "uuid": "7a06476c-59fe-4e12-a394-97114ad3b968", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "cad53dff-9455-4268-942b-ad92b79042be"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "4c9c58ac-44f2-489f-b475-02741fd1a8c7"}, "edge_type": "inherent", "type": "", "uuid": "963a4350-72c6-46f5-98cf-d71b01aa1884", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "898fbc3d-2bbd-4756-a96d-6b7fcfe2dc6c"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "7e6236ce-bf87-4ee9-aeb8-e35868512d46"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "3a91e88c-4019-4064-b80d-651c8c6d9d1a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "4c9c58ac-44f2-489f-b475-02741fd1a8c7"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "39d74fe7_runbook", "uuid": "d28a648a-b9fd-4a6f-a2af-d05db381ae3a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "898fbc3d-2bbd-4756-a96d-6b7fcfe2dc6c"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "cad53dff-9455-4268-942b-ad92b79042be"}], "description": "", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "7e6236ce-bf87-4ee9-aeb8-e35868512d46"}, "message_list": [], "variable_list": [], "uuid": "8c115e67-5246-428c-a979-d308b863ecd8"}, "message_list": [], "name": "action_create"}, {"description": "System action for uninstalling an application", "type": "system", "uuid": "ee008acf-2796-456a-b103-aa5470a8f80f", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Uninstall_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "5a3656db-24a2-4b77-b401-5428f764aa3d"}], "name": "SYS_GEN__DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "6c0544ac-bb4d-4d03-a988-00fd35bb1558"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Uninstall_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "99412ec9-6fa4-4d13-af1c-a3842840d99a"}], "name": "4c247e43_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "d8dd4a1f-011b-4d00-95f7-29246753c272"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Core.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /opt/bin ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')\n\necho \"[Unit]\nDescription=etcd (System Application Container)\nDocumentation=https://github.com/coreos/etcd\nWants=network-online.target network.target\nAfter=network-online.target\nConflicts=etcd.service\nConflicts=etcd2.service\n\n[Service]\nEnvironment='ETCD_IMAGE_TAG=v3.2.6'\nEnvironment='ETCD_DATA_DIR=/var/lib/etcd'\nEnvironment='ETCD_USER=etcd'\nExecStart=/usr/lib/coreos/etcd-wrapper \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q \"https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\" \"https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\"\nwget -q \"https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\"\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /opt/bin/cfssl\nsudo mv cfssljson_linux-amd64 /opt/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /opt/bin\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\nexport PATH=$PATH:/opt/bin\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},10.15.195.1,127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "99412ec9-6fa4-4d13-af1c-a3842840d99a"}], "description": "", "name": "0ac56c8c_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "4c247e43_dag", "uuid": "d8dd4a1f-011b-4d00-95f7-29246753c272"}, "message_list": [], "variable_list": [], "uuid": "545ac17b-e7fc-415f-9701-ea80144594ef"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "762da324_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "dde7cde1-2514-47e1-8bd4-a48d69838957"}], "description": "", "name": "a0877e37_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "762da324_dag", "uuid": "dde7cde1-2514-47e1-8bd4-a48d69838957"}, "message_list": [], "variable_list": [], "uuid": "bf2ae6c8-698b-4eac-9581-f34d4f8d6ff0"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_UNINSTALL", "variable_list": [], "uuid": "5a3656db-24a2-4b77-b401-5428f764aa3d"}], "description": "", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "6c0544ac-bb4d-4d03-a988-00fd35bb1558"}, "message_list": [], "variable_list": [], "uuid": "1d149726-7bc4-4e02-945e-660f990e1ed3"}, "message_list": [], "name": "action_uninstall"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "79335110-0395-4328-ba7a-866ed7047b95", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "1125e5ac-436b-4ba8-ba74-e5eabc839bf7"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "7d11c31b-2eaf-48a3-a21e-7986d910d6a5"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "218abd46-b969-4e7c-a0d6-9afce03466be"}], "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "1125e5ac-436b-4ba8-ba74-e5eabc839bf7"}, "edge_type": "inherent", "type": "", "uuid": "258fca80-2f34-4291-a4ed-9a87028dbbde", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "7d11c31b-2eaf-48a3-a21e-7986d910d6a5"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "7d11c31b-2eaf-48a3-a21e-7986d910d6a5"}, "edge_type": "inherent", "type": "", "uuid": "26f4d790-2a95-44ce-a83f-80d20057ad0b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "218abd46-b969-4e7c-a0d6-9afce03466be"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a5b32b0e-ee2f-41ad-a44d-9bccb1c9fe33"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "1125e5ac-436b-4ba8-ba74-e5eabc839bf7"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "b00241d6_runbook", "uuid": "a5999398-fee7-49e7-8af2-7c82fe537838"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "7d11c31b-2eaf-48a3-a21e-7986d910d6a5"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "1d149726-7bc4-4e02-945e-660f990e1ed3"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "218abd46-b969-4e7c-a0d6-9afce03466be"}], "description": "", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "a5b32b0e-ee2f-41ad-a44d-9bccb1c9fe33"}, "message_list": [], "variable_list": [], "uuid": "62a3ca4a-e5b2-47eb-9404-ba3ba0270f3a"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "9d480cec-36a0-4a3e-8751-15fd003c67fa", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "411f1d4d-e36e-4996-a452-f14a4e500a46"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "b812e024-aa8b-4e56-93ee-82cd3f654381"}], "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "411f1d4d-e36e-4996-a452-f14a4e500a46"}, "edge_type": "inherent", "type": "", "uuid": "416b4deb-cac0-4fc5-8443-316bc53cf1f0", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "b812e024-aa8b-4e56-93ee-82cd3f654381"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "924af431-f2b3-447f-87ae-1c9e6a14e285"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "59a30bab-b0f4-4159-82ca-96708920121f"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "411f1d4d-e36e-4996-a452-f14a4e500a46"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "b812e024-aa8b-4e56-93ee-82cd3f654381"}], "description": "", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "924af431-f2b3-447f-87ae-1c9e6a14e285"}, "message_list": [], "variable_list": [], "uuid": "351a36db-e2ee-4470-ac16-c9ae31bb7f30"}, "message_list": [], "name": "action_soft_delete"}, {"description": "System action for starting an application", "type": "system", "uuid": "cfeeb673-5e91-4b76-ae6c-12c4391cd417", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "cc7c0a2b-bfd5-4671-8b17-d803ba164627"}], "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "39d3e61d-9a09-4301-901c-0d92e63bac3c"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "05c2f01a_runbook", "uuid": "2e57e8be-f771-44ad-865d-e29b728392f2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "cc7c0a2b-bfd5-4671-8b17-d803ba164627"}], "description": "", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "39d3e61d-9a09-4301-901c-0d92e63bac3c"}, "message_list": [], "variable_list": [], "uuid": "5270e504-db3e-4264-b2d9-7124e624f135"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "68bc26b0-b6f3-41b3-9c26-99777809a715", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "uuid": "53a994d3-37ff-4174-9d27-a25b88dfb42c"}], "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "3c79bc5c-4064-46a1-b150-8b9d9c5bee48"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_17f60d9c_61fa_46ef_9779_3913be1343d8", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "49e3a785_runbook", "uuid": "5b8a6c63-398b-41eb-ba14-c57b7675c3c2"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "53a994d3-37ff-4174-9d27-a25b88dfb42c"}], "description": "", "name": "SYS_GEN__Runbook_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_5039f070_78d4_4c36_b8ac_6be1b882eb1c", "uuid": "3c79bc5c-4064-46a1-b150-8b9d9c5bee48"}, "message_list": [], "variable_list": [], "uuid": "f70a893e-5ac5-49c5-ab61-06956b251f5f"}, "message_list": [], "name": "action_stop"}], "type": "DEB", "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Master", "uuid": "17f60d9c-61fa-46ef-9779-3913be1343d8"}], "name": "K8SC_Core_Package", "state": "ACTIVE", "version": "", "editables": {}, "message_list": [], "options": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "99412ec9-6fa4-4d13-af1c-a3842840d99a"}], "name": "4c247e43_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "d8dd4a1f-011b-4d00-95f7-29246753c272"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Core.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /opt/bin ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')\n\necho \"[Unit]\nDescription=etcd (System Application Container)\nDocumentation=https://github.com/coreos/etcd\nWants=network-online.target network.target\nAfter=network-online.target\nConflicts=etcd.service\nConflicts=etcd2.service\n\n[Service]\nEnvironment='ETCD_IMAGE_TAG=v3.2.6'\nEnvironment='ETCD_DATA_DIR=/var/lib/etcd'\nEnvironment='ETCD_USER=etcd'\nExecStart=/usr/lib/coreos/etcd-wrapper \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q \"https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\" \"https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\"\nwget -q \"https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\"\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /opt/bin/cfssl\nsudo mv cfssljson_linux-amd64 /opt/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /opt/bin\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\nexport PATH=$PATH:/opt/bin\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},10.15.195.1,127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "99412ec9-6fa4-4d13-af1c-a3842840d99a"}], "description": "", "name": "0ac56c8c_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "4c247e43_dag", "uuid": "d8dd4a1f-011b-4d00-95f7-29246753c272"}, "message_list": [], "variable_list": [], "uuid": "545ac17b-e7fc-415f-9701-ea80144594ef"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package", "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "762da324_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "dde7cde1-2514-47e1-8bd4-a48d69838957"}], "description": "", "name": "a0877e37_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "762da324_dag", "uuid": "dde7cde1-2514-47e1-8bd4-a48d69838957"}, "message_list": [], "variable_list": [], "uuid": "bf2ae6c8-698b-4eac-9581-f34d4f8d6ff0"}}, "variable_list": [], "uuid": "5039f070-78d4-4c36-b8ac-6be1b882eb1c"}, {"description": "", "action_list": [{"description": "System action for installing an application", "type": "system", "uuid": "4c9bfa79-0e19-4d41-ac31-8b05db8d752a", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Install_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "3cbcdf3f-6ff5-476f-9393-584ec0286d24"}], "name": "SYS_GEN__DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "9f34a944-3d5a-4092-b146-3e999d6146ed"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Install_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "37008ccd-0fa6-431f-89e7-85d9d3b09f17"}], "name": "7833276a_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "40d2953d-623a-44ce-8f2c-80ee42ddd830"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Core.address}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /etc/flannel ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${HOSTNAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:@@{KUBELET_IMAGE_TAG}@@\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${HOSTNAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "37008ccd-0fa6-431f-89e7-85d9d3b09f17"}], "description": "", "name": "fc5e88e3_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "7833276a_dag", "uuid": "40d2953d-623a-44ce-8f2c-80ee42ddd830"}, "message_list": [], "variable_list": [], "uuid": "2eb92b6f-e3a7-4b75-a73c-75e9fe171348"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "f2d65c78_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "57cac108-81fb-4220-8313-23000fc24405"}], "description": "", "name": "7323a05b_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "f2d65c78_dag", "uuid": "57cac108-81fb-4220-8313-23000fc24405"}, "message_list": [], "variable_list": [], "uuid": "44b153e2-d39d-435c-ac85-178508081973"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_INSTALL", "variable_list": [], "uuid": "3cbcdf3f-6ff5-476f-9393-584ec0286d24"}], "description": "", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "9f34a944-3d5a-4092-b146-3e999d6146ed"}, "message_list": [], "variable_list": [], "uuid": "068deee7-3280-438b-9312-9df00bddd019"}, "message_list": [], "name": "action_install"}, {"description": "System action for creating an application", "type": "system", "uuid": "4be8b92c-7a69-4a14-8bc6-0177015a93e6", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "6d82b87b-335f-42d5-9ab2-10c3ea6d68bf"}, {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f50034a2-2643-43a0-9875-52cab3567fec"}, {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "3690775f-cf1e-41b0-b3da-76f6c2e0fe52"}], "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f50034a2-2643-43a0-9875-52cab3567fec"}, "edge_type": "inherent", "type": "", "uuid": "7d71eba6-172a-432c-a8b9-2049f0a6cc3c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "3690775f-cf1e-41b0-b3da-76f6c2e0fe52"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "6d82b87b-335f-42d5-9ab2-10c3ea6d68bf"}, "edge_type": "inherent", "type": "", "uuid": "291949e4-a176-48e1-bb7e-d0a289c93d5b", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f50034a2-2643-43a0-9875-52cab3567fec"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "c5a2ee67-25e6-4125-a5bf-6fa33192a675"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__install_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "068deee7-3280-438b-9312-9df00bddd019"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "6d82b87b-335f-42d5-9ab2-10c3ea6d68bf"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__create_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "925ba7c0_runbook", "uuid": "ce426880-342a-4995-9d9c-c9dec8c586c4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "f50034a2-2643-43a0-9875-52cab3567fec"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "3690775f-cf1e-41b0-b3da-76f6c2e0fe52"}], "description": "", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "c5a2ee67-25e6-4125-a5bf-6fa33192a675"}, "message_list": [], "variable_list": [], "uuid": "28464e78-fd12-4a4f-9403-9656f6050776"}, "message_list": [], "name": "action_create"}, {"description": "System action for uninstalling an application", "type": "system", "uuid": "29ea0988-f48e-4ab9-9784-1fa07851a375", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PE_Uninstall_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "7a1c6a99-6b1f-49e4-8f5c-8ba2fd0f8b3f"}], "name": "SYS_GEN__DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a093cc8a-8043-477b-9313-e13de40de32d"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PE_Uninstall_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "37008ccd-0fa6-431f-89e7-85d9d3b09f17"}], "name": "7833276a_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "40d2953d-623a-44ce-8f2c-80ee42ddd830"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Core.address}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /etc/flannel ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${HOSTNAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:@@{KUBELET_IMAGE_TAG}@@\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${HOSTNAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "37008ccd-0fa6-431f-89e7-85d9d3b09f17"}], "description": "", "name": "fc5e88e3_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "7833276a_dag", "uuid": "40d2953d-623a-44ce-8f2c-80ee42ddd830"}, "message_list": [], "variable_list": [], "uuid": "2eb92b6f-e3a7-4b75-a73c-75e9fe171348"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "f2d65c78_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "57cac108-81fb-4220-8313-23000fc24405"}], "description": "", "name": "7323a05b_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "f2d65c78_dag", "uuid": "57cac108-81fb-4220-8313-23000fc24405"}, "message_list": [], "variable_list": [], "uuid": "44b153e2-d39d-435c-ac85-178508081973"}}, "timeout_secs": "", "type": "CUSTOM_PACKAGE_UNINSTALL", "variable_list": [], "uuid": "7a1c6a99-6b1f-49e4-8f5c-8ba2fd0f8b3f"}], "description": "", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "a093cc8a-8043-477b-9313-e13de40de32d"}, "message_list": [], "variable_list": [], "uuid": "a0355c2c-8ce9-44eb-84c7-ec6b92061b15"}, "message_list": [], "name": "action_uninstall"}, {"description": "System action for deleting an application. Deletes physical machines as well", "type": "system", "uuid": "1cc29a5b-f45e-4a56-a80e-6f1ca383036d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "ad9e6361-81e1-4fae-8fce-c8bfcb63c186"}, {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f72d92b5-5b68-4d49-a1f7-fba8e3c02190"}, {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "6ebf0e25-de3a-4b40-9518-1909aba2b43a"}], "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "ad9e6361-81e1-4fae-8fce-c8bfcb63c186"}, "edge_type": "inherent", "type": "", "uuid": "2cca23ba-56d3-4a4b-bdad-3d1cc38c4b7c", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f72d92b5-5b68-4d49-a1f7-fba8e3c02190"}}, {"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "f72d92b5-5b68-4d49-a1f7-fba8e3c02190"}, "edge_type": "inherent", "type": "", "uuid": "258d5370-9ccb-49e4-b739-ff608de470e0", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "6ebf0e25-de3a-4b40-9518-1909aba2b43a"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "56ac01bf-144c-4d36-9c3e-aed0bdb4a155"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "ad9e6361-81e1-4fae-8fce-c8bfcb63c186"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "28e74b96_runbook", "uuid": "0ab86c44-ee03-4d60-ae33-3bc75165ee6a"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "f72d92b5-5b68-4d49-a1f7-fba8e3c02190"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__uninstall_CRb_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "a0355c2c-8ce9-44eb-84c7-ec6b92061b15"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "6ebf0e25-de3a-4b40-9518-1909aba2b43a"}], "description": "", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "56ac01bf-144c-4d36-9c3e-aed0bdb4a155"}, "message_list": [], "variable_list": [], "uuid": "f6dba9d2-5ce8-45a7-abb8-ba8e6d71949f"}, "message_list": [], "name": "action_delete"}, {"description": "System action for deleting an application. Does not delete physical machines", "type": "system", "uuid": "4b309d57-f34b-414a-bd03-1084f14a139d", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "53d30134-8281-4fdd-993b-58260f18e3bd"}, {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "c7884b0d-374a-4b01-810a-3b8e0c14dc56"}], "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "53d30134-8281-4fdd-993b-58260f18e3bd"}, "edge_type": "inherent", "type": "", "uuid": "c305fbaf-f486-47f2-a578-03edfbb53e4d", "to_task_reference": {"kind": "app_task", "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "c7884b0d-374a-4b01-810a-3b8e0c14dc56"}}], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "a4b81325-82ad-4978-b5ad-e29056236e17"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__soft_delete_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "SYS_GEN__Runbook_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "8bf1f321-c96c-485d-bf06-13a230fc1e23"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "53d30134-8281-4fdd-993b-58260f18e3bd"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__Package_Element_Delete_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"type": ""}, "timeout_secs": "", "type": "SOFT_DELETE_ELEMENT", "variable_list": [], "uuid": "c7884b0d-374a-4b01-810a-3b8e0c14dc56"}], "description": "", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "a4b81325-82ad-4978-b5ad-e29056236e17"}, "message_list": [], "variable_list": [], "uuid": "b572f564-2110-481c-a87b-64aebd2fcf2c"}, "message_list": [], "name": "action_soft_delete"}, {"description": "System action for starting an application", "type": "system", "uuid": "2be3dca5-3717-4899-8880-f7ba64d7f303", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "4bafd894-47a7-4060-b61d-007bf1c2ecb2"}], "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "2ea20769-737a-436c-9b49-f889d9a5b4c0"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__start_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "af446214_runbook", "uuid": "30c32db7-a3ae-499d-9881-763dee970665"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "4bafd894-47a7-4060-b61d-007bf1c2ecb2"}], "description": "", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "2ea20769-737a-436c-9b49-f889d9a5b4c0"}, "message_list": [], "variable_list": [], "uuid": "123201b0-4f69-4d6a-a5c0-5da866a07cf8"}, "message_list": [], "name": "action_start"}, {"description": "System action for stopping an application", "type": "system", "uuid": "d14046b1-7348-47eb-b471-e440c0c63f71", "state": "ACTIVE", "critical": true, "attrs": {}, "runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "uuid": "02675818-70a7-4064-b2cf-27fc6825f026"}], "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "attrs": {"edges": [], "type": "DAG"}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "15fb359c-8e70-4147-b2a7-b5ac1c0f5876"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "SYS_GEN__stop_CRb_Service_ed198317_51d3_491a_85cf_34968aaedbee", "state": "ACTIVE", "attrs": {"type": "CALL_RUNBOOK", "inarg_list": [], "runbook_reference": {"kind": "app_runbook", "name": "bbfee442_runbook", "uuid": "1b9045f8-eb7e-455f-a6a4-1ecbba9abeb4"}}, "timeout_secs": "", "type": "CALL_RUNBOOK", "variable_list": [], "uuid": "02675818-70a7-4064-b2cf-27fc6825f026"}], "description": "", "name": "SYS_GEN__Runbook_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "SYS_GEN__Composite_DAG_Package_4162fb74_3c52_4542_8a04_3f1c912bd992", "uuid": "15fb359c-8e70-4147-b2a7-b5ac1c0f5876"}, "message_list": [], "variable_list": [], "uuid": "7beebfa4-b7e6-4d08-9334-eb0ae3bf7b2a"}, "message_list": [], "name": "action_stop"}], "type": "DEB", "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Minion", "uuid": "ed198317-51d3-491a-85cf-34968aaedbee"}], "name": "K8SM_Core_Package", "state": "ACTIVE", "version": "", "editables": {}, "message_list": [], "options": {"install_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask", "uuid": "37008ccd-0fa6-431f-89e7-85d9d3b09f17"}], "name": "7833276a_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "40d2953d-623a-44ce-8f2c-80ee42ddd830"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "PackageInstallTask", "state": "ACTIVE", "attrs": {"script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Core.address}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /etc/flannel ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${HOSTNAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:@@{KUBELET_IMAGE_TAG}@@\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${HOSTNAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a", "type": "", "command_line_args": "", "exit_status": [], "script_type": "sh"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "uuid": "37008ccd-0fa6-431f-89e7-85d9d3b09f17"}], "description": "", "name": "fc5e88e3_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "7833276a_dag", "uuid": "40d2953d-623a-44ce-8f2c-80ee42ddd830"}, "message_list": [], "variable_list": [], "uuid": "2eb92b6f-e3a7-4b75-a73c-75e9fe171348"}, "type": "", "uninstall_runbook": {"task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package", "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}, "description": "", "message_list": [], "child_tasks_local_reference_list": [], "name": "f2d65c78_dag", "state": "ACTIVE", "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "uuid": "57cac108-81fb-4220-8313-23000fc24405"}], "description": "", "name": "7323a05b_runbook", "state": "ACTIVE", "main_task_local_reference": {"kind": "app_task", "name": "f2d65c78_dag", "uuid": "57cac108-81fb-4220-8313-23000fc24405"}, "message_list": [], "variable_list": [], "uuid": "44b153e2-d39d-435c-ac85-178508081973"}}, "variable_list": [], "uuid": "4162fb74-3c52-4542-8a04-3f1c912bd992"}]}, "name": "Kubernetes"}, "spec": {"description": "", "resources": {"service_definition_list": [{"singleton": false, "name": "Kubernetes_Master", "action_list": [{"critical": false, "type": "system", "description": "System action for creating an application", "name": "action_create", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Configure"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "7de8078e_dag"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}/\nsudo chmod +r ${ETCD_CERT_PATH}/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - apiserver\n    - --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=true\n    - --insecure-port=0\n    - --secure-port=443\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=3\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=/var/lib/audit.log\n    - --authorization-mode=RBAC\n    - --bind-address=0.0.0.0\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --runtime-config=rbac.authorization.k8s.io/v1alpha1\n    - --etcd-cafile=${ETCD_CERT_PATH}/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}/encryption-config.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}/kubernetes-key.pem\n    - --kubelet-https=true\n    - --service-account-key-file=${KUBE_CERT_PATH}/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}/ca.pem\n    - --v=2\n    ports:\n    - containerPort: 443\n      hostPort: 443\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /etc/ssl/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true  \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: /healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: /healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-scheduler.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Configure"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "7de8078e_dag"}, "name": "39d74fe7_runbook"}}, {"critical": false, "type": "system", "description": "System action for deleting an application. Deletes physical machines as well", "name": "action_delete", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "04a99dae_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "04a99dae_dag"}, "name": "b00241d6_runbook"}}, {"critical": false, "type": "system", "description": "System action for starting an application", "name": "action_start", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Start"}, {"kind": "app_task", "name": "StartFlanneld"}, {"kind": "app_task", "name": "KubeDns"}, {"kind": "app_task", "name": "VolumePlugin"}, {"kind": "app_task", "name": "Dashboard"}, {"kind": "app_task", "name": "Helm"}, {"kind": "app_task", "name": "Calico"}], "attrs": {"edges": [{"from_task_reference": {"kind": "app_task", "name": "VolumePlugin"}, "edge_type": "user_defined", "type": "", "to_task_reference": {"kind": "app_task", "name": "Dashboard"}}, {"from_task_reference": {"kind": "app_task", "name": "Dashboard"}, "edge_type": "user_defined", "type": "", "to_task_reference": {"kind": "app_task", "name": "Helm"}}, {"from_task_reference": {"kind": "app_task", "name": "Helm"}, "edge_type": "user_defined", "type": "", "to_task_reference": {"kind": "app_task", "name": "Calico"}}, {"from_task_reference": {"kind": "app_task", "name": "Start"}, "edge_type": "user_defined", "type": "", "to_task_reference": {"kind": "app_task", "name": "StartFlanneld"}}, {"from_task_reference": {"kind": "app_task", "name": "StartFlanneld"}, "edge_type": "user_defined", "type": "", "to_task_reference": {"kind": "app_task", "name": "KubeDns"}}, {"from_task_reference": {"kind": "app_task", "name": "KubeDns"}, "edge_type": "user_defined", "type": "", "to_task_reference": {"kind": "app_task", "name": "VolumePlugin"}}], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "40001146_dag"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\nsudo systemctl start kube-etcd docker kubelet iscsid\nsudo systemctl enable kube-etcd docker kubelet iscsid\nexport PATH=$PATH:/opt/bin\n\nmkdir CA\nmv ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\ncp /opt/kube-ssl/admin*.pem CA/\nwhile [[ $(curl --key CA/admin-key.pem --cert CA/admin.pem --cacert CA/ca.pem https://@@{address}@@/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n\tsleep 5\ndone\n\nkubectl config set-cluster kubernetes-the-hard-way  --certificate-authority=$HOME/CA/ca.pem  --embed-certs=true --server=https://@@{address}@@\nkubectl config set-credentials admin  --client-certificate=$HOME/CA/admin.pem  --client-key=$HOME/CA/admin-key.pem\nkubectl config set-context kubernetes-the-hard-way  --cluster=kubernetes-the-hard-way  --user=admin\nkubectl config use-context kubernetes-the-hard-way"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Start"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nsleep 10\nexport PATH=$PATH:/opt/bin\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"10.200.0.0/16\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: extensions/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io/coreos/flannel:v0.9.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: quay.io/coreos/flannel:v0.9.0-amd64\n        command: [ \"/opt/bin/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n        - name: run\n          hostPath:\n            path: /run\n        - name: cni\n          hostPath:\n            path: /etc/cni/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | tee kube-flannel.yml\nkubectl create -f kube-flannel.yml\nsleep 30"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "StartFlanneld"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nmkdir kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io/cluster-service: \"true\"\n    addonmanager.kubernetes.io/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io/cluster-service: \"true\"\n    kubernetes.io/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_CLUSTER_DNS}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io/cluster-service: \"true\"\n    addonmanager.kubernetes.io/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io/critical-pod:\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.4\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: /healthcheck/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: /readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: /kube-dns-config\n      - name: dnsmasq\n        image: gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.4\n        livenessProbe:\n          httpGet:\n            path: /healthcheck/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=/etc/k8s/dns/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=/cluster.local./127.0.0.1#10053\n        - --server=/in-addr.arpa/127.0.0.1#10053\n        - --server=/ip6.arpa/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: /etc/k8s/dns/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.4\n        livenessProbe:\n          httpGet:\n            path: /metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | tee kubedns/kube-dns.yaml\n      \nkubectl create -f kubedns/kube-dns.yaml"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "KubeDns"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nmkdir volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PRISM_USERNAME}@@:@@{PRISM_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: silver \n  namespace: kube-system\nprovisioner: nutanix/abs\nparameters:\n     prismEndPoint: @@{PRISM_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PRISM_DATA_SERVICE_IP}@@:3260\n     user: @@{PRISM_USERNAME}@@\n     password: @@{PRISM_PASSWORD}@@\n     secretName: ntnx-secret\n     storageContainer: @@{CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | tee volume_plugin/nutanix-provisioner.yaml\n\nsed -i \"s/<SECRET>/${NTNX_SECRET}/\" volume_plugin/nutanix-provisioner.yaml\nkubectl create -f volume_plugin/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix/abs\" | tee -a volume_plugin/ntnx-secret.yaml\nsed -i \"s/<SECRET>/${NTNX_SECRET}/\" volume_plugin/ntnx-secret.yaml\nkubectl create -f volume_plugin/ntnx-secret.yaml"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "VolumePlugin"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nmkdir Dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: extensions/v1beta1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      initContainers:\n      - name: kubernetes-dashboard-init\n        image: gcr.io/google_containers/kubernetes-dashboard-init-amd64:v1.0.1\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: /certs\n      containers:\n      - name: kubernetes-dashboard\n        image: gcr.io/google_containers/kubernetes-dashboard-amd64:v1.7.1\n        ports:\n        - containerPort: 9090\n          protocol: TCP\n        args:\n          - --tls-key-file=/certs/dashboard.key\n          - --tls-cert-file=/certs/dashboard.crt\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http://my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: /certs\n          readOnly: true\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: /\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | tee Dashboard/kubernetes-dashboard.yaml\nkubectl create -f Dashboard/kubernetes-dashboard.yaml"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Dashboard"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | tee helm.yaml\n  \nkubectl create -f helm.yaml\nhelm init --service-account helm"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Helm"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:/opt/bin\n\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nETCD_SERVER_PORT=2379\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\nkubectl apply -f https://docs.projectcalico.org/v2.6/getting-started/kubernetes/installation/rbac.yaml\n\n#ETCD_KEY=$(python -c 'import base64; import sys; print base64.b64encode(sys.argv[1])' \"$(cat /etc/kubernetes/ssl/kubernetes-key.pem)\")\n#ETCD_CERT=$(python -c 'import base64; import sys; print base64.b64encode(sys.argv[1])' \"$(cat /etc/kubernetes/ssl/kubernetes.pem)\")\n#ETCD_CA=$(python -c 'import base64; import sys; print base64.b64encode(sys.argv[1])' \"$(cat /etc/kubernetes/ssl/ca.pem)\")\n\necho '# Calico Version v2.6.2\n\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  etcd_endpoints: \"<ETCD_SERVERS>\"\n  calico_backend: \"none\"\n  cni_network_config: |-\n    {\n        \"name\": \"k8s-pod-network\",\n        \"cniVersion\": \"0.1.0\",\n        \"type\": \"flannel\",\n         \"delegate\": {\n            \"type\": \"calico\",\n            \"etcd_endpoints\": \"__ETCD_ENDPOINTS__\",\n            \"etcd_key_file\": \"__ETCD_KEY_FILE__\",\n            \"etcd_cert_file\": \"__ETCD_CERT_FILE__\",\n            \"etcd_ca_cert_file\": \"__ETCD_CA_CERT_FILE__\",\n            \"log_level\": \"info\",\n            \"mtu\": 1500,\n            \"policy\": {\n               \"type\": \"k8s\",\n               \"k8s_api_root\": \"https://__KUBERNETES_SERVICE_HOST__:__KUBERNETES_SERVICE_PORT__\",\n               \"k8s_auth_token\": \"__SERVICEACCOUNT_TOKEN__\"\n           },\n           \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n           }\n        }\n    }\n  etcd_ca: \"/calico-secrets/etcd-ca\"\n  etcd_cert: \"/calico-secrets/etcd-cert\"\n  etcd_key: \"/calico-secrets/etcd-key\"\n\n---\n\napiVersion: v1\nkind: Secret\ntype: Opaque\nmetadata:\n  name: calico-etcd-secrets\n  namespace: kube-system\ndata:\n  etcd-key: \"<ETCD_KEY>\"\n  etcd-cert: \"<ETCD_CERT>\"\n  etcd-ca: \"<ETCD_CA>\"\n---\n\nkind: DaemonSet\napiVersion: extensions/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io/critical-pod: \"\"\n        scheduler.alpha.kubernetes.io/tolerations: |\n          [{\"key\": \"dedicated\", \"value\": \"master\", \"effect\": \"NoSchedule\" },\n           {\"key\":\"CriticalAddonsOnly\", \"operator\":\"Exists\"}]\n    spec:\n      hostNetwork: true\n      serviceAccountName: calico-node\n\n      terminationGracePeriodSeconds: 0\n      containers:\n\n        - name: calico-node\n          image: quay.io/calico/node:v2.6.2\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: ETCD_CA_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_ca\n            - name: ETCD_KEY_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_key\n            - name: ETCD_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_cert\n            - name: IP\n              value: \"\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: /liveness\n              port: 9099\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: /readiness\n              port: 9099\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: /lib/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: /var/run/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: /calico-secrets\n              name: etcd-certs\n        - name: install-cni\n          image: quay.io/calico/cni:v1.11.0\n          command: [\"/install-cni.sh\"]\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n          volumeMounts:\n            - mountPath: /host/opt/cni/bin\n              name: cni-bin-dir\n            - mountPath: /host/etc/cni/net.d\n              name: cni-net-dir\n            - mountPath: /calico-secrets\n              name: etcd-certs\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: /lib/modules\n        - name: var-run-calico\n          hostPath:\n            path: /var/run/calico\n        - name: cni-bin-dir\n          hostPath:\n            path: /opt/cni/bin\n        - name: cni-net-dir\n          hostPath:\n            path: /etc/cni/net.d\n        - name: etcd-certs\n          secret:\n            secretName: calico-etcd-secrets\n\n---\n\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: calico-kube-controllers\n  namespace: kube-system\n  labels:\n    k8s-app: calico-kube-controllers\n  annotations:\n    scheduler.alpha.kubernetes.io/critical-pod: \"\"\n    scheduler.alpha.kubernetes.io/tolerations: |\n      [{\"key\": \"dedicated\", \"value\": \"master\", \"effect\": \"NoSchedule\" },\n       {\"key\":\"CriticalAddonsOnly\", \"operator\":\"Exists\"}]\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      name: calico-kube-controllers\n      namespace: kube-system\n      labels:\n        k8s-app: calico-kube-controllers\n    spec:\n      hostNetwork: true\n      serviceAccountName: calico-kube-controllers\n      containers:\n        - name: calico-kube-controllers\n          image: quay.io/calico/kube-controllers:v1.0.0\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n            - name: ETCD_CA_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_ca\n            - name: ETCD_KEY_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_key\n            - name: ETCD_CERT_FILE\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_cert\n          volumeMounts:\n            - mountPath: /calico-secrets\n              name: etcd-certs\n      volumes:\n        - name: etcd-certs\n          secret:\n            secretName: calico-etcd-secrets\n\n---\n\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: calico-policy-controller\n  namespace: kube-system\n  labels:\n    k8s-app: calico-policy\nspec:\n  replicas: 0\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      name: calico-policy-controller\n      namespace: kube-system\n      labels:\n        k8s-app: calico-policy\n    spec:\n      hostNetwork: true\n      serviceAccountName: calico-kube-controllers\n      containers:\n        - name: calico-policy-controller\n          image: quay.io/calico/kube-controllers:v1.0.0\n          env:\n            - name: ETCD_ENDPOINTS\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: etcd_endpoints\n\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-kube-controllers\n  namespace: kube-system\n\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system' | tee calico.yaml\n  \nsed -i \"s#<ETCD_SERVERS>#${ETCD_SERVERS}#\" calico.yaml\nsed -i \"s/<ETCD_KEY>/${ETCD_KEY}/\" calico.yaml\nsed -i \"s/<ETCD_CERT>/${ETCD_CERT}/\" calico.yaml\nsed -i \"s/<ETCD_CA>/${ETCD_CA}/\" calico.yaml\n"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Calico"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "40001146_dag"}, "name": "05c2f01a_runbook"}}, {"critical": false, "type": "system", "description": "System action for stopping an application", "name": "action_stop", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "68e6d6cf_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "68e6d6cf_dag"}, "name": "49e3a785_runbook"}}, {"critical": false, "type": "system", "description": "System action for restarting an application", "name": "action_restart", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "928d779e_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "928d779e_dag"}, "name": "9bfe1a06_runbook"}}], "description": "", "port_list": [], "tier": "", "variable_list": [], "depends_on_list": []}, {"singleton": false, "name": "Kubernetes_Minion", "action_list": [{"critical": false, "type": "system", "description": "System action for creating an application", "name": "action_create", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "9dfbf446_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "9dfbf446_dag"}, "name": "925ba7c0_runbook"}}, {"critical": false, "type": "system", "description": "System action for deleting an application. Deletes physical machines as well", "name": "action_delete", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "141edbbe_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "141edbbe_dag"}, "name": "28e74b96_runbook"}}, {"critical": false, "type": "system", "description": "System action for starting an application", "name": "action_start", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion"}, "description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Start"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "c4ac1e52_dag"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nsudo systemctl start kubelet iscsid\nsudo systemctl enable kubelet iscsid"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Start"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "c4ac1e52_dag"}, "name": "af446214_runbook"}}, {"critical": false, "type": "system", "description": "System action for stopping an application", "name": "action_stop", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "35667c90_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "35667c90_dag"}, "name": "bbfee442_runbook"}}, {"critical": false, "type": "system", "description": "System action for restarting an application", "name": "action_restart", "runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Minion"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "78a2de6b_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "78a2de6b_dag"}, "name": "4db0601a_runbook"}}], "description": "", "port_list": [], "tier": "", "variable_list": [], "depends_on_list": []}], "substrate_definition_list": [{"description": "", "action_list": [], "readiness_probe": {"connection_type": "SSH", "disable_readiness_probe": false, "timeout_secs": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@", "connection_port": 22, "login_credential_local_reference": {"kind": "app_credential", "name": "KUBE"}}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"disk_address": {"adapter_type": true}, "device_type": true}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "type": "AHV_VM", "create_spec": {"backup_policy": null, "type": "", "name": "Centos-K8SC@@{calm_array_index}@@", "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "cbc0c43a-5b92-49b2-9851-5a10041b6d1b"}, "type": ""}], "parent_reference": null, "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "power_state": "ON", "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "#cloud-config\nusers:\n  - name: kube\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CentOS-7-x86_64-GenericCloud-1801-01", "uuid": "2be2cb61-1220-4b9a-a8ad-1893565f00d4"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 1, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 2, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 3, "type": ""}}}]}, "availability_zone_reference": null}, "variable_list": [], "name": "K8SC_Centos"}, {"description": "", "action_list": [], "readiness_probe": {"connection_type": "SSH", "disable_readiness_probe": false, "timeout_secs": "120", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@", "connection_port": 22, "login_credential_local_reference": {"kind": "app_credential", "name": "KUBE"}}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"disk_address": {"adapter_type": true}, "device_type": true}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "type": "AHV_VM", "create_spec": {"backup_policy": null, "type": "", "name": "Centos-K8SM@@{calm_array_index}@@", "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "cbc0c43a-5b92-49b2-9851-5a10041b6d1b"}, "type": ""}], "parent_reference": null, "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "power_state": "ON", "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "#cloud-config\nusers:\n  - name: kube\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CentOS-7-x86_64-GenericCloud-1801-01", "uuid": "2be2cb61-1220-4b9a-a8ad-1893565f00d4"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 1, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 2, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 3, "type": ""}}}]}, "availability_zone_reference": null}, "variable_list": [], "name": "K8SM_Centos"}, {"description": "", "action_list": [], "readiness_probe": {"connection_type": "SSH", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@", "disable_readiness_probe": false, "timeout_secs": "60", "connection_port": 22}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"device_type": true, "disk_address": {"adapter_type": true}}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "type": "AHV_VM", "create_spec": {"backup_policy": null, "type": "", "name": "Core-K8SC@@{calm_array_index}@@", "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "1d7c2d16-d673-4837-a5ea-42295392e1d4"}, "type": ""}], "parent_reference": null, "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "power_state": "ON", "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "{\n  \"ignition\": {\n    \"version\": \"2.0.0\"\n  },\n  \"passwd\": {\n    \"users\": [{\n      \"name\": \"kube\",\n      \"sshAuthorizedKeys\": [\n        \"@@{INSTANCE_PUBLIC_KEY}@@\"\n      ],\n      \"create\": {\n        \"groups\": [\n          \"sudo\",\n          \"docker\"\n        ]\n      }\n    }]\n  },\n  \"storage\": {\n    \"files\": [{\n      \"contents\": {\n        \"source\": \"data:,controller@@{calm_array_index}@@\"\n      },\n      \"filesystem\": \"root\",\n      \"mode\": 420,\n      \"path\": \"/etc/hostname\"\n    }]\n  }\n}"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CoreOs", "uuid": "a00950f0-7d75-4044-a9f5-646d665fe704"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 1, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 2, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 3, "type": ""}}}]}, "availability_zone_reference": null}, "variable_list": [], "name": "K8SC_Core"}, {"description": "", "action_list": [], "readiness_probe": {"connection_type": "SSH", "address": "@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@", "disable_readiness_probe": false, "timeout_secs": "60", "connection_port": 22}, "editables": {"readiness_probe": {"connection_type": true, "connection_port": true, "timeout_secs": true}, "create_spec": {"name": true, "resources": {"nic_list": {"0": {"subnet_reference": true}}, "num_vcpus_per_socket": true, "num_sockets": true, "memory_size_mib": true, "guest_customization": true, "disk_list": {"1": {"disk_size_mib": true}, "0": {"data_source_reference": true, "device_properties": {"device_type": true, "disk_address": {"adapter_type": true}}}, "3": {"disk_size_mib": true}, "2": {"disk_size_mib": true}}}}}, "os_type": "Linux", "type": "AHV_VM", "create_spec": {"backup_policy": null, "type": "", "name": "Core-K8SM@@{calm_array_index}@@", "resources": {"nic_list": [{"nic_type": "NORMAL_NIC", "ip_endpoint_list": [], "network_function_chain_reference": null, "network_function_nic_type": "INGRESS", "mac_address": "", "subnet_reference": {"kind": "subnet", "type": "", "name": "", "uuid": "1d7c2d16-d673-4837-a5ea-42295392e1d4"}, "type": ""}], "parent_reference": null, "guest_tools": null, "num_vcpus_per_socket": 1, "num_sockets": 2, "gpu_list": [], "memory_size_mib": 2048, "power_state": "ON", "hardware_clock_timezone": "", "guest_customization": {"cloud_init": {"meta_data": "", "type": "", "user_data": "{\n  \"ignition\": {\n    \"version\": \"2.0.0\"\n  },\n  \"passwd\": {\n    \"users\": [{\n      \"name\": \"kube\",\n      \"sshAuthorizedKeys\": [\n        \"@@{INSTANCE_PUBLIC_KEY}@@\"\n      ],\n      \"create\": {\n        \"groups\": [\n          \"sudo\",\n          \"docker\"\n        ]\n      }\n    }]\n  },\n  \"storage\": {\n    \"files\": [{\n      \"contents\": {\n        \"source\": \"data:,minion@@{calm_array_index}@@\"\n      },\n      \"filesystem\": \"root\",\n      \"mode\": 420,\n      \"path\": \"/etc/hostname\"\n    }]\n  }\n}"}, "type": "", "sysprep": null}, "type": "", "boot_config": {"boot_device": {"type": "", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}, "type": "", "mac_address": ""}, "disk_list": [{"data_source_reference": {"kind": "image", "type": "", "name": "CoreOs", "uuid": "a00950f0-7d75-4044-a9f5-646d665fe704"}, "type": "", "disk_size_mib": 0, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 0, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 1, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 2, "type": ""}}}, {"data_source_reference": null, "type": "", "disk_size_mib": 8192, "device_properties": {"type": "", "device_type": "DISK", "disk_address": {"adapter_type": "SCSI", "device_index": 3, "type": ""}}}]}, "availability_zone_reference": null}, "variable_list": [], "name": "K8SM_Core"}], "credential_definition_list": [{"username": "kube", "description": "", "secret": {"attrs": {"is_secret_modified": false, "secret_reference": {}}}, "editables": {"username": true, "secret": true}, "type": "KEY", "name": "KUBE"}], "package_definition_list": [{"description": "", "action_list": [], "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Master"}], "version": "", "type": "DEB", "options": {"install_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP"}, "description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "1941c1cf_dag"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SCP"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nsudo easy_install netaddr\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Centos.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')    \n    \nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\n# -*- Bootstrapping a H/A etcd cluster.\ntar -xvf etcd-v3.2.6-linux-amd64.tar.gz\nsudo mv etcd-v3.2.6-linux-amd64/etcd* /usr/bin/\nrm -rf etcd-v3.2.6-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https://github.com/coreos\n\n[Service]\nExecStart=/usr/bin/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /usr/local/bin/cfssl\nsudo mv cfssljson_linux-amd64 /usr/local/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /usr/local/bin/\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone\n\n"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "PackageInstallTask"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "1941c1cf_dag"}, "name": "9c8e1cff_runbook"}, "type": "", "uninstall_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SCP"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "2574e274_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "2574e274_dag"}, "name": "926289ee_runbook"}}, "variable_list": [], "name": "K8SCP"}, {"description": "", "action_list": [], "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Minion"}], "version": "", "type": "DEB", "options": {"install_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP"}, "description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "70add069_dag"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SMP"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Centos.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y \nsudo yum install -y wget iscsi-initiator-utils socat\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\nwget -q \"https://github.com/coreos/etcd/releases/download/v3.2.6/etcd-v3.2.6-linux-amd64.tar.gz\"\nwget -q https://get.docker.com/builds/Linux/x86_64/docker-1.12.6.tgz\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\nwget -q https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubelet\nchmod +x kubelet\nsudo mv kubelet /usr/bin/kubelet\n\ntar -xvf docker-1.12.6.tgz\nsudo cp docker/docker* /usr/bin/\nrm -rf docker*\necho \"[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\n\n[Service]\nExecStart=/usr/bin/docker daemon \\\\\n  --iptables=false \\\\\n  --ip-masq=false \\\\\n  --host=unix:///var/run/docker.sock \\\\\n  --log-level=error \\\\\n  --storage-driver=overlay\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/docker.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=/usr/bin/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${NODE_NAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo yum install -y lvm2\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "PackageInstallTask"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "70add069_dag"}, "name": "bcb096c9_runbook"}, "type": "", "uninstall_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SMP"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "9f3d46b7_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "9f3d46b7_dag"}, "name": "6fc961e1_runbook"}}, "variable_list": [], "name": "K8SMP"}, {"description": "", "action_list": [], "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Master"}], "version": "", "type": "DEB", "options": {"install_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package"}, "description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "4c247e43_dag"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{K8SM_Core.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nETCD_CERT_PATH=\"/etc/ssl/certs/etcd\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\n\nsudo mkdir -p /opt/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /opt/bin ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a /etc/hosts\n  CON+=\"controller${count}=https://${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's/,$//')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's/,$//')\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a /etc/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's/,$//')\n\necho \"[Unit]\nDescription=etcd (System Application Container)\nDocumentation=https://github.com/coreos/etcd\nWants=network-online.target network.target\nAfter=network-online.target\nConflicts=etcd.service\nConflicts=etcd2.service\n\n[Service]\nEnvironment='ETCD_IMAGE_TAG=v3.2.6'\nEnvironment='ETCD_DATA_DIR=/var/lib/etcd'\nEnvironment='ETCD_USER=etcd'\nExecStart=/usr/lib/coreos/etcd-wrapper \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https://${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT},http://127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https://${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=/var/lib/etcd \\\\\n  --wal-dir=/var/lib/etcd/wal \\\\\n  --max-wals=0\nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kube-etcd.service\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo chown -R $USER:$USER /opt/kube-ssl && cd /opt/kube-ssl\nwget -q \"https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\" \"https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\"\nwget -q \"https://storage.googleapis.com/kubernetes-release/release/${VERSION}/bin/linux/amd64/kubectl\"\nwget -q \"https://github.com/projectcalico/calicoctl/releases/download/v1.6.2/calicoctl\"\nwget -q \"https://storage.googleapis.com/kubernetes-helm/helm-v2.6.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.6.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64/helm calicoctl\nsudo mv cfssl_linux-amd64 /opt/bin/cfssl\nsudo mv cfssljson_linux-amd64 /opt/bin/cfssljson\nsudo mv kubectl linux-amd64/helm calicoctl /opt/bin\nrm -rf helm-v2.6.2-linux-amd64.tar.gz linux-amd64\n\nexport PATH=$PATH:/opt/bin\n\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},10.15.195.1,127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\ninstance=\"minion${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone\n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=minion${count}.kubeconfig\nkubectl config set-credentials system:node:minion${count} --client-certificate=minion${count}.pem --client-key=minion${count}-key.pem --embed-certs=true --kubeconfig=minion${count}.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=system:node:minion${count} --kubeconfig=minion${count}.kubeconfig\nkubectl config use-context default --kubeconfig=minion${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster kubernetes-prod-cluster --certificate-authority=ca.pem --embed-certs=true --server=https://${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=kubernetes-prod-cluster --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 /dev/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{KUBE.secret}@@\" | tee ~/.ssh/id_rsa\nchmod 400 ~/.ssh/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  instance=\"minion${count}\"\n  scp -o stricthostkeychecking=no ca*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig ${instance}:\ncount=$((count+1))\ndone"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "PackageInstallTask"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "4c247e43_dag"}, "name": "0ac56c8c_runbook"}, "type": "", "uninstall_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SC_Core_Package"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "762da324_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "762da324_dag"}, "name": "a0877e37_runbook"}}, "variable_list": [], "name": "K8SC_Core_Package"}, {"description": "", "action_list": [], "service_local_reference_list": [{"kind": "app_service", "name": "Kubernetes_Minion"}], "version": "", "type": "DEB", "options": {"install_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package"}, "description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "PackageInstallTask"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "7833276a_dag"}, {"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{K8SC_Core.address}@@\"\nCLUSTER_SUBNET=\"@@{CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_CLUSTER_DNS}@@\"\nKUBELET_IMAGE_TAG=\"@@{KUBELET_IMAGE_TAG}@@\"\nKUBE_CERT_PATH=\"/etc/kubernetes/ssl\"\nKUBE_MANIFEST_PATH=\"/etc/kubernetes/manifests\"\nKUBE_CNI_BIN_PATH=\"/opt/cni/bin\"\nKUBE_CNI_CONF_PATH=\"/etc/cni/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} /etc/flannel ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\nwget -q https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz\n\ncount=0\nfor i in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  ETCD+=\"https://${i}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's/,$//')\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nEnvironment=KUBELET_IMAGE_TAG=${KUBELET_IMAGE_TAG}\nEnvironment='RKT_RUN_ARGS=--volume iscsiadm,kind=host,source=/usr/sbin/iscsiadm \\\n  --mount volume=iscsiadm,target=/usr/sbin/iscsiadm \\\n  --volume cni-bin,kind=host,source=${KUBE_CNI_BIN_PATH} \\\n  --mount volume=cni-bin,target=${KUBE_CNI_BIN_PATH} \\\n  --volume etc-cni,kind=host,source=${KUBE_CNI_CONF_PATH} \\\n  --mount volume=etc-cni,target=${KUBE_CNI_CONF_PATH} \\\n  --uuid-file-save=/var/run/kubelet-pod.uuid'\nExecStart=/usr/lib/coreos/kubelet-wrapper \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=true \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}/${HOSTNAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --require-kubeconfig \\\\\n  --runtime-request-timeout=10m \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}/kubernetes.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}/kubernetes-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --v=2\nExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid  \nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee /etc/systemd/system/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io/coreos/hyperkube:@@{KUBELET_IMAGE_TAG}@@\n    command:\n    - /hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: /etc/ssl/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: /usr/share/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee /etc/iscsi/initiatorname.iscsi\n\nwhile [ ! -f ${HOSTNAME}.kubeconfig ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}/\nsudo chmod +r ${KUBE_CERT_PATH}/*\n\nsudo mkdir -p /var/lib/docker\nsudo pvcreate /dev/sd{b,c,d}\nsudo vgcreate docker /dev/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs /dev/docker/docker_lvm\n\necho -e \"/dev/docker/docker_lvm \\t /var/lib/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee /etc/fstab\nsudo mount -a"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "PackageInstallTask"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "7833276a_dag"}, "name": "fc5e88e3_runbook"}, "type": "", "uninstall_runbook": {"variable_list": [], "task_definition_list": [{"target_any_local_reference": {"kind": "app_package", "name": "K8SM_Core_Package"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "f2d65c78_dag"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "f2d65c78_dag"}, "name": "7323a05b_runbook"}}, "variable_list": [], "name": "K8SM_Core_Package"}], "app_profile_list": [{"deployment_create_list": [{"name": "7e23eb76_deployment", "action_list": [], "package_local_reference_list": [{"kind": "app_package", "name": "K8SCP"}], "editables": {"min_replicas": true}, "max_replicas": "3", "substrate_local_reference": {"kind": "app_substrate", "name": "K8SC_Centos"}, "min_replicas": "3", "variable_list": [], "description": ""}, {"name": "0fd632f7_deployment", "action_list": [], "package_local_reference_list": [{"kind": "app_package", "name": "K8SMP"}], "editables": {"min_replicas": true}, "max_replicas": "2", "substrate_local_reference": {"kind": "app_substrate", "name": "K8SM_Centos"}, "min_replicas": "2", "variable_list": [], "description": ""}], "variable_list": [{"val_type": "STRING", "description": "", "value": "v1.7.10_coreos.0", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "KUBELET_IMAGE_TAG"}, {"val_type": "STRING", "description": "", "value": "10.200.0.0/16", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "CLUSTER_SUBNET"}, {"val_type": "STRING", "description": "", "value": "10.32.0.0/24", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "SERVICE_SUBNET"}, {"val_type": "STRING", "description": "", "value": "10.32.0.10", "label": "", "editables": {"value": true}, "type": "LOCAL", "name": "KUBE_CLUSTER_DNS"}, {"val_type": "STRING", "description": "", "value": "10.5.67.138", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "PRISM_CLUSTER_IP"}, {"val_type": "STRING", "description": "", "value": "10.5.67.143", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "PRISM_DATA_SERVICE_IP"}, {"val_type": "STRING", "description": "", "value": "admin", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "PRISM_USERNAME"}, {"val_type": "STRING", "description": "", "value": "", "label": "", "attrs": {"is_secret_modified": false, "secret_reference": {}, "type": ""}, "editables": {"value": true}, "type": "SECRET", "name": "PRISM_PASSWORD"}, {"val_type": "STRING", "description": "", "value": "default-container-43360047467620", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "CONTAINER_NAME"}, {"val_type": "STRING", "description": "", "value": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS/K0Mb/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf/i9QMJ5/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "INSTANCE_PUBLIC_KEY"}], "description": "", "action_list": [{"critical": false, "type": "user", "description": "", "name": "Test", "runbook": {"variable_list": [], "task_definition_list": [{"description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Test"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "fc93ef5a_dag"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\n\nexport PATH=$PATH:/opt/bin\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nCONTROLLER_IP=\"@@{calm_array_address}@@\"\nWORKER_IP=\"@@{K8SM_Centos.address}@@\"\nMASTER_IP=\"@@{address}@@\"\n\nfunction log_msg() {\n\tlocal logger=$(basename \"$0\")\n\tprintf \"[${logger}] $1\\n\"\n}\n\n\n# SSH to a node ($1), run command ($2)).\nfunction ssh_run_command() {\n\tlocal node=\"$1\"\n\tlocal command=\"$2\"\n\tssh  -oBatchMode=yes -oConnectTimeout=10 -o StrictHostKeyChecking=no \\\n\t\t-o UserKnownHostsFile=/dev/null -q ${node} ${command} 2>&1 | tr -d '\\r\\n'\n}\n\n\nfunction check_ssh_connectivity() {\n\tlog_msg \"  Checking SSH connectivity to each node (from this host)...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to master ${master}\"\n\t\t\tlog_msg \"  Only IPs in ${CONTROLLER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to worker ${worker}\"\n\t\t\tlog_msg \"  Only IPs in ${WORKER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n}\n\nfunction check_system_services() {\n\n\tlog_msg \"  Checking whether expected system services are running on each node...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-etcd service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kube-etcd 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kube-etcd service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\n\tdone\n\n}\n\nfunction check_k8s_healthz_through_lb() {\n\tlog_msg \"  Checking status of /healthz endpoint...\"\n\toutput=$(curl --insecure --max-time 30 https://${MASTER_IP}:443/healthz 2>/dev/null)\n\tif [[ $output != \"ok\" ]]; then\n\t\tlog_msg \"  [FAILED] Master node /healthz is not available\"\n\t\texit 1\n\tfi\n\n}\n\nfunction check_get_nodes() {\n\tlog_msg \"  Running 'kubectl get nodes' a number of times through the master...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 1)\n\tfor i in {1..20}; do\n\t\tcount=$(kubectl get nodes --no-headers 2>/dev/null | grep \"Ready\" | wc -l)\n\t\tlog_msg \"  Running 'kubectl get nodes' count is ${count} out of ${expected_nodes} expected...\"\n\t\tif [ \"$count\" -lt $expected_nodes ]; then\n\t\t\tlog_msg \"  [FAILED] kubectl get nodes reported less healthy nodes than expected\"\n\t\t\tkubectl get nodes\n\t\t\texit 1\n\t\tfi\n\tdone\n}\n\nfunction check_kube-dns() {\n\tlog_msg \"  Checking status of kube-dns pod...\"\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $3}')\n\tlog_msg \"  kube-dns pod status is ${output}\"\n\tif [[ $output != \"Running\" ]]; then\n\t\tlog_msg \"  [FAILED] kube-dns is not running in the cluster\"\n\t\texit 1\n\tfi\n\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $2}')\n\tlog_msg \"  expected kube-dns pod is ${output}\"\n\tif [[ $output != \"3/3\" ]]; then\n\t\tlog_msg \"  [FAILED] expected 3/3 kube-dns pods to be running in the cluster\"\n\t\texit 1\n\tfi\n}\n\nfunction check_nginx_deployment() {\n\tlog_msg \"  Checking an app deployment of nginx exposed as a service...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 2)\n\tkubectl run nginx --image=\"nginx\" --port=80 --replicas=${expected_nodes} 1>/dev/null\n\tkubectl expose deployment nginx --type NodePort 1>/dev/null\n\n\tnodePort=\"UNSET\"\n\tmax_tries=0\n\tuntil [ $nodePort != \"UNSET\" ] || [ $max_tries -eq 10 ]; do\n\t\tnodePort=$(kubectl get svc nginx --output=jsonpath='{range .spec.ports[0]}{.nodePort}')\n\t\tmax_tries=$((max_tries + 1))\n\tdone\n\n\tif [[ $nodePort == \"UNSET\" ]]; then\n\t\tlog_msg \"  [FAILED] could not retrieve the NodePort of the nginx service\"\n\t\texit 1\n\tfi\n\n\t# Avoid possible hang if port is not ready\n\tsleep 10\n    for i in {1..5}; do\n\t    for worker in $(echo ${CONTROLLER_IP},${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\t    output=$(curl --max-time 30 http://$worker:$nodePort 2>/dev/null)\n            if [[ -z \"$output\" ]]; then\n\t\t\t    log_msg \"   [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t\t    exit 1\n            fi\n\t\t    if [[ $output != *\"Welcome to nginx!\"* ]]; then\n\t\t\t    log_msg \"  [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t    \texit 1\n\t    \tfi\n    \tdone\n    done\n    kubectl delete deployment nginx 1>/dev/null\n}\n\nfunction print_success() {\n\tcat <<EOF\n\nThe Kubernetes cluster is up and appears to be healthy.\n$(kubectl cluster-info)\nEOF\n}\n\nlog_msg \"Running some basic checks on Kubernetes cluster....\"\ncheck_ssh_connectivity\ncheck_system_services\ncheck_k8s_healthz_through_lb\ncheck_get_nodes\ncheck_kube-dns\ncheck_nginx_deployment\n\nprint_success\n\nexit 0"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Test"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "fc93ef5a_dag"}, "name": "ed66499a_runbook"}}], "name": "Centos"}, {"deployment_create_list": [{"name": "8d3d1287_deployment", "action_list": [], "package_local_reference_list": [{"kind": "app_package", "name": "K8SC_Core_Package"}], "editables": {"min_replicas": true}, "max_replicas": "3", "substrate_local_reference": {"kind": "app_substrate", "name": "K8SC_Core"}, "min_replicas": "3", "variable_list": [], "description": ""}, {"name": "37f2422f_deployment", "action_list": [], "package_local_reference_list": [{"kind": "app_package", "name": "K8SM_Core_Package"}], "editables": {"min_replicas": true}, "max_replicas": "2", "substrate_local_reference": {"kind": "app_substrate", "name": "K8SM_Core"}, "min_replicas": "2", "variable_list": [], "description": ""}], "variable_list": [{"val_type": "STRING", "description": "", "value": "v1.7.10_coreos.0", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "KUBELET_IMAGE_TAG"}, {"val_type": "STRING", "description": "", "value": "10.200.0.0/16", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "CLUSTER_SUBNET"}, {"val_type": "STRING", "description": "", "value": "10.32.0.0/24", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "SERVICE_SUBNET"}, {"val_type": "STRING", "description": "", "value": "10.32.0.10", "label": "", "editables": {"value": true}, "type": "LOCAL", "name": "KUBE_CLUSTER_DNS"}, {"val_type": "STRING", "description": "", "value": "10.5.67.138", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "PRISM_CLUSTER_IP"}, {"val_type": "STRING", "description": "", "value": "10.5.67.143", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "PRISM_DATA_SERVICE_IP"}, {"val_type": "STRING", "description": "", "value": "admin", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "PRISM_USERNAME"}, {"val_type": "STRING", "description": "", "value": "", "label": "", "attrs": {"is_secret_modified": false, "secret_reference": {}, "type": ""}, "editables": {"value": true}, "type": "SECRET", "name": "PRISM_PASSWORD"}, {"val_type": "STRING", "description": "", "value": "default-container-43360047467620", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "CONTAINER_NAME"}, {"val_type": "STRING", "description": "", "value": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS/K0Mb/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf/i9QMJ5/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com", "label": "", "attrs": {"type": ""}, "editables": {"value": true}, "type": "LOCAL", "name": "INSTANCE_PUBLIC_KEY"}], "description": "", "action_list": [{"critical": false, "type": "user", "description": "", "name": "Test", "runbook": {"variable_list": [], "task_definition_list": [{"description": "", "child_tasks_local_reference_list": [{"kind": "app_task", "name": "Test"}], "attrs": {"edges": [], "type": ""}, "timeout_secs": "", "type": "DAG", "variable_list": [], "name": "7a4e4568_dag"}, {"target_any_local_reference": {"kind": "app_service", "name": "Kubernetes_Master"}, "description": "", "child_tasks_local_reference_list": [], "attrs": {"script_type": "sh", "type": "", "command_line_args": "", "exit_status": [], "script": "#!/bin/bash\n\nexport PATH=$PATH:/opt/bin\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nCONTROLLER_IP=\"@@{calm_array_address}@@\"\nWORKER_IP=\"@@{K8SM_Core.address}@@\"\nMASTER_IP=\"@@{address}@@\"\n\nfunction log_msg() {\n\tlocal logger=$(basename \"$0\")\n\tprintf \"[${logger}] $1\\n\"\n}\n\n\n# SSH to a node ($1), run command ($2)).\nfunction ssh_run_command() {\n\tlocal node=\"$1\"\n\tlocal command=\"$2\"\n\tssh  -oBatchMode=yes -oConnectTimeout=10 -o StrictHostKeyChecking=no \\\n\t\t-o UserKnownHostsFile=/dev/null -q ${node} ${command} 2>&1 | tr -d '\\r\\n'\n}\n\n\nfunction check_ssh_connectivity() {\n\tlog_msg \"  Checking SSH connectivity to each node (from this host)...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to master ${master}\"\n\t\t\tlog_msg \"  Only IPs in ${CONTROLLER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking SSH connectivity to ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"echo connected\")\n\t\tif [[ $ret != \"connected\" ]]; then\n\t\t\tlog_msg \"  [FAILED] Could not ssh to worker ${worker}\"\n\t\t\tlog_msg \"  Only IPs in ${WORKER_IP} are allowed to SSH to this node\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n}\n\nfunction check_system_services() {\n\n\tlog_msg \"  Checking whether expected system services are running on each node...\"\n\tfor master in $(echo ${CONTROLLER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-etcd service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo systemctl status kube-etcd 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kube-etcd service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${master}\"\n\t\tret=$(ssh_run_command \"${master}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on master $master\"\n\t\t\texit 1\n\t\tfi\n\tdone\n\n\tfor worker in $(echo ${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\tlog_msg \"  Checking docker service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status docker 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected docker service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kubelet service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo systemctl status kubelet 2>&1 | grep --only-matching 'Active: active' | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"Active: active\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected kubelet service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\t\tlog_msg \"  Checking kube-proxy service on ${worker}\"\n\t\tret=$(ssh_run_command \"${worker}\" \"sudo docker ps | grep --only-matching \\\"hyperkube proxy\\\" | tr -d '\\r\\n'\")\n\t\tif [[ $ret != \"hyperkube proxy\" ]]; then\n\t\t\tlog_msg \"  [FAILED] expected hyperkube proxy service is not running on worker $worker\"\n\t\t\texit 1\n\t\tfi\n\n\tdone\n\n}\n\nfunction check_k8s_healthz_through_lb() {\n\tlog_msg \"  Checking status of /healthz endpoint...\"\n\toutput=$(curl --insecure --max-time 30 https://${MASTER_IP}:443/healthz 2>/dev/null)\n\tif [[ $output != \"ok\" ]]; then\n\t\tlog_msg \"  [FAILED] Master node /healthz is not available\"\n\t\texit 1\n\tfi\n\n}\n\nfunction check_get_nodes() {\n\tlog_msg \"  Running 'kubectl get nodes' a number of times through the master...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 1)\n\tfor i in {1..20}; do\n\t\tcount=$(kubectl get nodes --no-headers 2>/dev/null | grep \"Ready\" | wc -l)\n\t\tlog_msg \"  Running 'kubectl get nodes' count is ${count} out of ${expected_nodes} expected...\"\n\t\tif [ \"$count\" -lt $expected_nodes ]; then\n\t\t\tlog_msg \"  [FAILED] kubectl get nodes reported less healthy nodes than expected\"\n\t\t\tkubectl get nodes\n\t\t\texit 1\n\t\tfi\n\tdone\n}\n\nfunction check_kube-dns() {\n\tlog_msg \"  Checking status of kube-dns pod...\"\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $3}')\n\tlog_msg \"  kube-dns pod status is ${output}\"\n\tif [[ $output != \"Running\" ]]; then\n\t\tlog_msg \"  [FAILED] kube-dns is not running in the cluster\"\n\t\texit 1\n\tfi\n\n\toutput=$(kubectl get pods --namespace=kube-system -l k8s-app=kube-dns 2>&1 | grep kube-dns | awk '{print $2}')\n\tlog_msg \"  expected kube-dns pod is ${output}\"\n\tif [[ $output != \"3/3\" ]]; then\n\t\tlog_msg \"  [FAILED] expected 3/3 kube-dns pods to be running in the cluster\"\n\t\texit 1\n\tfi\n}\n\nfunction check_nginx_deployment() {\n\tlog_msg \"  Checking an app deployment of nginx exposed as a service...\"\n\texpected_nodes=$(expr $(echo ${CONTROLLER_IP},${WORKER_IP} | tr -cd , | wc -c) + 2)\n\tkubectl run nginx --image=\"nginx\" --port=80 --replicas=${expected_nodes} 1>/dev/null\n\tkubectl expose deployment nginx --type NodePort 1>/dev/null\n\n\tnodePort=\"UNSET\"\n\tmax_tries=0\n\tuntil [ $nodePort != \"UNSET\" ] || [ $max_tries -eq 10 ]; do\n\t\tnodePort=$(kubectl get svc nginx --output=jsonpath='{range .spec.ports[0]}{.nodePort}')\n\t\tmax_tries=$((max_tries + 1))\n\tdone\n\n\tif [[ $nodePort == \"UNSET\" ]]; then\n\t\tlog_msg \"  [FAILED] could not retrieve the NodePort of the nginx service\"\n\t\texit 1\n\tfi\n\n\t# Avoid possible hang if port is not ready\n\tsleep 10\n    for i in {1..5}; do\n\t    for worker in $(echo ${CONTROLLER_IP},${WORKER_IP} | sed \"s/,/ /g\"); do\n\t\t    output=$(curl --max-time 30 http://$worker:$nodePort 2>/dev/null)\n            if [[ -z \"$output\" ]]; then\n\t\t\t    log_msg \"   [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t\t    exit 1\n            fi\n\t\t    if [[ $output != *\"Welcome to nginx!\"* ]]; then\n\t\t\t    log_msg \"  [FAILED] nginx deployment service is not accessible on http://$worker:$nodePort\"\n\t\t    \texit 1\n\t    \tfi\n    \tdone\n    done\n    kubectl delete deployment nginx 1>/dev/null\n}\n\nfunction print_success() {\n\tcat <<EOF\n\nThe Kubernetes cluster is up and appears to be healthy.\n$(kubectl cluster-info)\nEOF\n}\n\nlog_msg \"Running some basic checks on Kubernetes cluster....\"\ncheck_ssh_connectivity\ncheck_system_services\ncheck_k8s_healthz_through_lb\ncheck_get_nodes\ncheck_kube-dns\ncheck_nginx_deployment\n\nprint_success\n\nexit 0"}, "timeout_secs": "", "type": "EXEC", "variable_list": [], "name": "Test"}], "description": "", "main_task_local_reference": {"kind": "app_task", "name": "7a4e4568_dag"}, "name": "87e0163f_runbook"}}], "name": "Core"}], "default_credential_local_reference": {"kind": "app_credential", "name": "KUBE"}, "client_attrs": {"Kubernetes_Minion": {"y": 380, "x": 580}, "Kubernetes_Master": {"y": 60, "x": 400}}}, "name": "Kubernetes"}, "api_version": "3.0", "metadata": {"last_update_time": "1516868141718122", "creation_time": "1516616982305599", "kind": "blueprint", "spec_version": 8, "name": "Kubernetes"}}